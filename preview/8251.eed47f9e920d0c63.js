/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["8251"],{41686:function(e,r,t){t.d(r,{An:()=>C,Ku:()=>x,PM:()=>B,aK:()=>A,wz:()=>y,xd:()=>O});var n=t(52630),s=t(5380),o=t(46348),i=t(13070),a=t(50242),l=t(31621),c=t(90435),d=t(41345),f=t(75061),u=t(9139),g=t(88173);let p=/defined\s*?\((.+?)\)/g,h=/defined\s*?\[(.+?)\]/g,L=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,S=/__decl__/,_=/light\{X\}.(\w*)/g,E=/\{X\}/g,m=[],w=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function C(e,r,t,n){r.processor?.preProcessShaderCode&&(e=r.processor.preProcessShaderCode(e,r.isFragment)),O(e,r,e=>{r.processCodeAfterIncludes&&(e=r.processCodeAfterIncludes(r.isFragment?"fragment":"vertex",e,r.defines)),t(function(e,r,t){let n=function(e,r){if(r.processor?.noPrecision)return e;let t=r.shouldUseHighPrecisionShader;return -1===e.indexOf("precision highp float")?e=t?"precision highp float;\n"+e:"precision mediump float;\n"+e:t||(e=e.replace("precision highp float","precision mediump float")),e}(e,r);if(!r.processor||0===r.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!r.processor.parseGLES3))return n;let s=r.defines,o=G(r,t);r.processor.preProcessor&&(n=r.processor.preProcessor(n,s,o,r.isFragment,r.processingContext));let i={};return n=v(n,o,r,i),r.processor.postProcessor&&(n=r.processor.postProcessor(n,s,r.isFragment,r.processingContext,t?{drawBuffersExtensionDisabled:!t.getCaps().drawBuffersExtension}:{},o,i)),t?._features.needShaderCodeInlining&&(n=t.inlineShaderCode(n)),n}(e,r,n),e)})}function A(e,r,t,n){r.processor?.preProcessShaderCode&&(e=r.processor.preProcessShaderCode(e,r.isFragment)),O(e,r,e=>{r.processCodeAfterIncludes&&(e=r.processCodeAfterIncludes(r.isFragment?"fragment":"vertex",e,r.defines)),t(function(e,r,t){let n=e,s=r.defines,o=G(r,t);r.processor?.preProcessor&&(n=r.processor.preProcessor(n,s,o,r.isFragment,r.processingContext));let i={};return n=v(n,o,r,i),r.processor?.postProcessor&&(n=r.processor.postProcessor(n,s,r.isFragment,r.processingContext,t?{drawBuffersExtensionDisabled:!t.getCaps().drawBuffersExtension}:{},o,i)),t._features.needShaderCodeInlining&&(n=t.inlineShaderCode(n)),n}(e,r,n),e)})}function x(e,r,t){return t.processor&&t.processor.finalizeShaders?t.processor.finalizeShaders(e,r,t.processingContext):{vertexCode:e,fragmentCode:r}}function I(e){let r=/defined\((.+)\)/.exec(e);if(r&&r.length)return new a.G(r[1].trim(),"!"===e[0]);let t="",n=0;for(t of["==","!=",">=","<=","<",">"])if((n=e.indexOf(t))>-1)break;if(-1===n)return new a.G(e);let s=e.substring(0,n).trim(),o=e.substring(n+t.length).trim();return new f.h(s,t,o)}function b(e,r){let t=new i.o,n=e.substring(0,r),s=e.substring(r);return s=s.substring(0,(s.indexOf("//")+1||s.length+1)-1).trim(),"#ifdef"===n?t.testExpression=new a.G(s):"#ifndef"===n?t.testExpression=new a.G(s,!0):t.testExpression=function(e){e=e.replace(p,"defined[$1]");let r=d.m.infixToPostfix(e),t=[];for(let e of r)if("||"!==e&&"&&"!==e)t.push(e);else if(t.length>=2){let r=t[t.length-1],n=t[t.length-2];t.length-=2;let s="&&"==e?new c.J:new l.J;"string"==typeof r&&(r=r.replace(h,"defined($1)")),"string"==typeof n&&(n=n.replace(h,"defined($1)")),s.leftOperand="string"==typeof n?I(n):n,s.rightOperand="string"==typeof r?I(r):r,t.push(s)}let n=t[t.length-1];return"string"==typeof n&&(n=n.replace(h,"defined($1)")),"string"==typeof n?I(n):n}(s),t}function F(e,r,t,s){let o=e.currentLine;for(;R(e,t,s);){let i=(o=e.currentLine).substring(0,5).toLowerCase();if("#else"===i){let t=new n.I;r.children.push(t),R(e,t,s);return}if("#elif"===i){let e=b(o,5);r.children.push(e),t=e}}}function R(e,r,t){for(;e.canRead;){e.lineIndex++;let s=e.currentLine;if(s.indexOf("#")>=0){let n=w.exec(s);if(n&&n.length){switch(n[0]){case"#ifdef":{let n=new o.d;r.children.push(n);let i=b(s,6);n.children.push(i),F(e,n,i,t);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{let n=new o.d;r.children.push(n);let i=b(s,7);n.children.push(i),F(e,n,i,t);break}case"#if":{let n=new o.d,i=b(s,3);r.children.push(n),n.children.push(i),F(e,n,i,t)}}continue}}let i=new n.I;if(i.line=s,r.children.push(i),"#"===s[0]&&"d"===s[1]){let e=s.replace(";","").split(" ");i.additionalDefineKey=e[1],3===e.length&&(i.additionalDefineValue=e[2])}}return!1}function v(e,r,t,o){let i=new n.I,a=new s.t;return a.lineIndex=-1,a.lines=e.split("\n"),R(a,i,o),i.process(r,t,o)}function G(e,r){let t=e.defines,n={};for(let e of t){let r=e.replace("#define","").replace(";","").trim().split(" ");n[r[0]]=r.length>1?r[1]:""}return e.processor?.shaderLanguage===0&&(n.GL_ES="true"),n.__VERSION__=e.version,n[e.platformName]="true",(0,g.sk)(n,r?.isNDCHalfZRange,r?.useReverseDepthBuffer,r?.useExactSrgbConversions),n}function O(e,r,t){let n;for(m.length=0;null!==(n=L.exec(e));)m.push(n);let s=String(e),o=[e],i=!1;for(let e of m){let n=e[1];if(-1!==n.indexOf("__decl__")&&(n=n.replace(S,""),r.supportsUniformBuffers&&(n=n.replace("Vertex","Ubo").replace("Fragment","Ubo")),n+="Declaration"),r.includesShadersStore[n]){let t=r.includesShadersStore[n];if(e[2]){let r=e[3].split(",");for(let e=0;e<r.length;e+=2){let n=RegExp(r[e],"g"),s=r[e+1];t=t.replace(n,s)}}if(e[4]){let n=e[5];if(-1!==n.indexOf("..")){let e=n.split(".."),s=parseInt(e[0]),o=parseInt(e[1]),i=t.slice(0);t="",isNaN(o)&&(o=r.indexParameters[e[1]]);for(let e=s;e<o;e++)r.supportsUniformBuffers||(i=i.replace(_,(e,r)=>r+"{X}")),t+=i.replace(E,e.toString())+"\n"}else r.supportsUniformBuffers||(t=t.replace(_,(e,r)=>r+"{X}")),t=t.replace(E,n)}let s=[];for(let r of o){let n=r.split(e[0]);for(let e=0;e<n.length-1;e++)s.push(n[e]),s.push(t);s.push(n[n.length-1])}o=s,i=i||t.indexOf("#include<")>=0||t.indexOf("#include <")>=0}else{let e=r.shadersRepository+"ShadersInclude/"+n+".fx";B.loadFile(e,e=>{r.includesShadersStore[n]=e,O(o.join(""),r,t)});return}}m.length=0,s=o.join(""),i?O(s.toString(),r,t):t(s)}let B={loadFile:(e,r,t,n,s,o)=>{throw(0,u.S)("FileTools")}}},88173:function(e,r,t){t.d(r,{A8:()=>l,Gb:()=>o,an:()=>s,sk:()=>a,wv:()=>i});var n=t(9139);t(82090);let s={};function o(e,r,t=""){return t+(r?r+"\n":"")+e}function i(e,r,t,o,i,a,l){let c=l||s.loadFile;if(c)return c(e,r,t,o,i,a);throw(0,n.S)("FileTools")}function a(e,r,t,n){if(e){r?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,t?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,n?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return r&&(e+="#define IS_NDC_HALF_ZRANGE"),t&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),n&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function l(e,r,t=!1,n){switch(e){case 3:{let e=(r instanceof ArrayBuffer,new Int8Array(r));return n&&e.set(new Int8Array(n)),e}case 0:{let e=(r instanceof ArrayBuffer,new Uint8Array(r));return n&&e.set(new Uint8Array(n)),e}case 4:{let e=new Int16Array(r instanceof ArrayBuffer?r:t?r/2:r);return n&&e.set(new Int16Array(n)),e}case 5:case 8:case 9:case 10:case 2:{let e=new Uint16Array(r instanceof ArrayBuffer?r:t?r/2:r);return n&&e.set(new Uint16Array(n)),e}case 6:{let e=new Int32Array(r instanceof ArrayBuffer?r:t?r/4:r);return n&&e.set(new Int32Array(n)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=new Uint32Array(r instanceof ArrayBuffer?r:t?r/4:r);return n&&e.set(new Uint32Array(n)),e}case 1:{let e=new Float32Array(r instanceof ArrayBuffer?r:t?r/4:r);return n&&e.set(new Float32Array(n)),e}}let s=(r instanceof ArrayBuffer,new Uint8Array(r));return n&&s.set(new Uint8Array(n)),s}},80709:function(e,r,t){t.d(r,{v:()=>n});class n{static GetShadersRepository(e=0){return 0===e?n.ShadersRepository:n.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?n.ShadersStore:n.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?n.IncludesShadersStore:n.IncludesShadersStoreWGSL}}n.ShadersRepository="src/Shaders/",n.ShadersStore={},n.IncludesShadersStore={},n.ShadersRepositoryWGSL="src/ShadersWGSL/",n.ShadersStoreWGSL={},n.IncludesShadersStoreWGSL={}},92550:function(e,r,t){t.d(r,{Y:()=>n});class n{static _CheckLimit(e,r){let t=n._LogLimitOutputs[e];return t?t.current++:(t={limit:r,current:1},n._LogLimitOutputs[e]=t),t.current<=t.limit}static _GenerateLimitMessage(e,r=1){let t=n._LogLimitOutputs[e];if(!t||!n.MessageLimitReached)return;let s=this._Levels[r];t.current===t.limit&&n[s.name](n.MessageLimitReached.replace(/%LIMIT%/g,""+t.limit).replace(/%TYPE%/g,s.name??""))}static _AddLogEntry(e){n._LogCache=e+n._LogCache,n.OnNewCacheEntry&&n.OnNewCacheEntry(e)}static _FormatMessage(e){let r=e=>e<10?"0"+e:""+e,t=new Date;return"["+r(t.getHours())+":"+r(t.getMinutes())+":"+r(t.getSeconds())+"]: "+e}static _LogDisabled(e,r){}static _LogEnabled(e=1,r,t){let s=Array.isArray(r)?r[0]:r;if(void 0!==t&&!n._CheckLimit(s,t))return;let o=n._FormatMessage(s),i=this._Levels[e],a=Array.isArray(r)?r.slice(1):[];i.logFunc&&i.logFunc("BJS - "+o,...a);let l=`<div style='color:${i.color}'>${o}</div><br>`;n._AddLogEntry(l),n._GenerateLimitMessage(s,e)}static get LogCache(){return n._LogCache}static ClearLogCache(){n._LogCache="",n._LogLimitOutputs={},n.errorsCount=0}static set LogLevels(e){for(let r of(n.Log=n._LogDisabled,n.Warn=n._LogDisabled,n.Error=n._LogDisabled,[n.MessageLogLevel,n.WarningLogLevel,n.ErrorLogLevel]))(e&r)===r&&(n[this._Levels[r].name]=n._LogEnabled.bind(n,r))}}n.NoneLogLevel=0,n.MessageLogLevel=1,n.WarningLogLevel=2,n.ErrorLogLevel=4,n.AllLogLevel=7,n.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",n._LogCache="",n._LogLimitOutputs={},n._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],n.errorsCount=0,n.Log=n._LogEnabled.bind(n,n.MessageLogLevel),n.Warn=n._LogEnabled.bind(n,n.WarningLogLevel),n.Error=n._LogEnabled.bind(n,n.ErrorLogLevel)}}]);