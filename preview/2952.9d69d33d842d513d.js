/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["2952"],{10284:function(e,t,r){r.d(t,{AM:()=>c,H6:()=>u,HN:()=>h,KG:()=>p,PR:()=>v,Q:()=>K,gt:()=>g,iU:()=>a,s5:()=>d,tQ:()=>f,tY:()=>l});var o=r(88431),i=r(56877);let n=new WeakMap,s={_webGLVersion:2,cachedPipelines:{}};function a(e){let t=n.get(e);if(!t){if(!e)return s;t={_webGLVersion:e.TEXTURE_BINDING_3D?2:1,_context:e,parallelShaderCompile:e.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},n.set(e,t)}return t}function l(e){n.delete(e)}function c(e,t,r,o,i,n){let s=a(o);return n||(n=s._createShaderProgramInjection??d),n(e,P(t,"vertex",o,s._contextWasLost),P(r,"fragment",o,s._contextWasLost),o,i,s.validateShaderPrograms)}function f(e,t,r,o,i,n=null,s){let l=a(i);s||(s=l._createShaderProgramInjection??d);let c=l._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return s(e,m(t,"vertex",o,c,i,l._contextWasLost),m(r,"fragment",o,c,i,l._contextWasLost),i,n,l.validateShaderPrograms)}function u(e,t){let r=new o.y,i=a(e);return i.parallelShaderCompile&&!i.disableParallelShaderCompile&&(r.isParallelCompiled=!0),r.context=i._context,r}function d(e,t,r,o,i=null,n){let s=o.createProgram();if(e.program=s,!s)throw Error("Unable to create program");return o.attachShader(s,t),o.attachShader(s,r),o.linkProgram(s),e.context=o,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||h(e,o,n),s}function g(e,t,r){if(e._isDisposed)return!1;let o=a(t);return!!(o&&o.parallelShaderCompile&&o.parallelShaderCompile.COMPLETION_STATUS_KHR&&e.program&&t.getProgramParameter(e.program,o.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(h(e,t,r),!0)}function h(e,t,r){let o=e.context,i=e.vertexShader,n=e.fragmentShader,s=e.program;if(!o.getProgramParameter(s,o.LINK_STATUS)){if(!t.getShaderParameter(i,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(i);if(r)throw e.vertexCompilationError=r,Error("VERTEX SHADER "+r)}if(!t.getShaderParameter(n,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(n);if(r)throw e.fragmentCompilationError=r,Error("FRAGMENT SHADER "+r)}let r=o.getProgramInfoLog(s);if(r)throw e.programLinkError=r,Error(r)}if(r&&(o.validateProgram(s),!o.getProgramParameter(s,o.VALIDATE_STATUS))){let t=o.getProgramInfoLog(s);if(t)throw e.programValidationError=t,Error(t)}o.deleteShader(i),o.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)}function p(e,t,r,o,i,n,s,l,u,d="",g,h,m){let P=a(e.context);h||(h=P.createRawShaderProgramInjection??c),m||(m=P.createShaderProgramInjection??f),o?e.program=h(e,t,r,e.context,u):e.program=m(e,t,r,l,e.context,u),e.program.__SPECTOR_rebuildProgram=s,g()}function m(e,t,r,o,n,s){return P((0,i.Gb)(e,r,o),t,n,s)}function P(e,t,r,o){let i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i){let e=r.NO_ERROR,i=r.NO_ERROR;for(;(i=r.getError())!==r.NO_ERROR;)e=i;throw Error(`Something went wrong while creating a gl ${t} shader object. gl error=${e}, gl isContextLost=${r.isContextLost()}, _contextWasLost=${o}`)}return r.shaderSource(i,e),r.compileShader(i),i}function K(e,t){t.useProgram(e)}function v(e,t){if(!e.isParallelCompiled)return void t(e);let r=e.onCompiled;e.onCompiled=()=>{r?.(),t(e)}}},21381:function(e,t,r){let o;r.d(t,{$K:()=>w,$M:()=>A,A2:()=>R,FV:()=>y,Ip:()=>x,L7:()=>S,RC:()=>C,TU:()=>B,Uh:()=>E,VL:()=>T,W5:()=>_,e0:()=>o,eh:()=>K,kK:()=>v,qC:()=>L,r6:()=>b,rN:()=>U,vP:()=>F});var i=r(20034),n=r(25146),s=r(85791),a=r(89094),l=r(79607),c=r(39208),f=r(42462),u=r(94294),d=r(65098),g=r(88280),h=r(67109),p=r(56877),m=r(74913);let P=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class K extends c.LH{constructor(e,t){super(e,c.SM.LoadFileError),this.name="LoadFileError",c.GU._setPrototypeOf(this,K.prototype),t instanceof i.g?this.request=t:this.file=t}}class v extends c.LH{constructor(e,t){super(e,c.SM.RequestFileError),this.request=t,this.name="RequestFileError",c.GU._setPrototypeOf(this,v.prototype)}}class C extends c.LH{constructor(e,t){super(e,c.SM.ReadFileError),this.file=t,this.name="ReadFileError",c.GU._setPrototypeOf(this,C.prototype)}}let U={DefaultRetryStrategy:l.b.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:e=>e=e.replace(/#/gm,"%23")},A=(e,t)=>{if((!e||0!==e.indexOf("data:"))&&U.CorsBehavior)if("string"==typeof U.CorsBehavior||U.CorsBehavior instanceof String)t.crossOrigin=U.CorsBehavior;else{let r=U.CorsBehavior(e);r&&(t.crossOrigin=r)}},S={getRequiredSize:null},b=(e,t,r,o,n="",s,l=d.l.LastCreatedEngine)=>{let c;if("undefined"==typeof HTMLImageElement&&!l?._features.forceBitmapOverHTMLImageElement)return r("LoadImage is only supported in web or BabylonNative environments."),null;let u=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(c=URL.createObjectURL(new Blob([e],{type:n})),u=!0):c=`data:${n};base64,`+(0,f.Gh)(e):e instanceof Blob?(c=URL.createObjectURL(e),u=!0):(c=U.CleanUrl(e),c=U.PreprocessUrl(c));let g=t=>{if(r){let o=c||e.toString();r(`Error while trying to load image: ${0===o.indexOf("http")||o.length<=128?o:o.slice(0,128)+"..."}`,t)}};if(l?._features.forceBitmapOverHTMLImageElement)return F(c,o=>{l.createImageBitmap(new Blob([o],{type:n}),{premultiplyAlpha:"none",...s}).then(e=>{t(e),u&&URL.revokeObjectURL(c)}).catch(t=>{r&&r("Error while trying to load image: "+e,t)})},void 0,o||void 0,!0,(e,t)=>{g(t)}),null;let h=new Image;if(S.getRequiredSize){let t=S.getRequiredSize(e);t.width&&(h.width=t.width),t.height&&(h.height=t.height)}A(c,h);let p=[],m=()=>{for(let e of p)e.target.removeEventListener(e.name,e.handler);p.length=0};for(let e of(p.push({target:h,name:"load",handler:()=>{m(),t(h),u&&h.src&&URL.revokeObjectURL(h.src)}}),p.push({target:h,name:"error",handler:e=>{m(),g(e),u&&h.src&&URL.revokeObjectURL(h.src)}}),p.push({target:document,name:"securitypolicyviolation",handler:e=>{if(e.blockedURI!==h.src||"report"===e.disposition)return;m();let t=Error(`CSP violation of policy ${e.effectiveDirective} ${e.blockedURI}. Current policy is ${e.originalPolicy}`);d.l.UseFallbackTexture=!1,g(t),u&&h.src&&URL.revokeObjectURL(h.src),h.src=""}}),p))e.target.addEventListener(e.name,e.handler);let P="blob:"===c.substring(0,5),K="data:"===c.substring(0,5),v=()=>{P||K||!i.g.IsCustomRequestAvailable?h.src=c:F(c,(e,t,r)=>{let o=new Blob([e],{type:!n&&r?r:n}),i=URL.createObjectURL(o);u=!0,h.src=i},void 0,o||void 0,!0,(e,t)=>{g(t)})};if(!P&&!K&&o&&o.enableTexturesOffline)o.open(()=>{o&&o.loadImage(c,h)},v);else{if(-1!==c.indexOf("file:")){let e=decodeURIComponent(c.substring(5).toLowerCase());if(a.X.FilesToLoad[e]&&"undefined"!=typeof URL){try{let t;try{t=URL.createObjectURL(a.X.FilesToLoad[e])}catch(r){t=URL.createObjectURL(a.X.FilesToLoad[e])}h.src=t,u=!0}catch(e){h.src=""}return h}}v()}return h},x=(e,t,r,o,i)=>{let n=new FileReader,a={onCompleteObservable:new s.y$,abort:()=>n.abort()};return n.onloadend=()=>a.onCompleteObservable.notifyObservers(a),i&&(n.onerror=()=>{i(new C(`Unable to read ${e.name}`,e))}),n.onload=e=>{t(e.target.result)},r&&(n.onprogress=r),o?n.readAsArrayBuffer(e):n.readAsText(e),a},F=(e,t,r,o,i,n,l)=>{if(e.name)return x(e,t,r,i,n?e=>{n(void 0,e)}:void 0);if(-1!==e.indexOf("file:")){let o=decodeURIComponent(e.substring(5).toLowerCase());0===o.indexOf("./")&&(o=o.substring(2));let s=a.X.FilesToLoad[o];if(s)return x(s,t,r,i,n?e=>n(void 0,new K(e.message,e.file)):void 0)}let{match:c,type:f}=L(e);if(c){let r={onCompleteObservable:new s.y$,abort:()=>()=>{}};try{let r=i?w(e):R(e);t(r,void 0,f)}catch(e){n?n(void 0,e):g.Y.Error(e.message||"Failed to parse the Data URL")}return h.Q.SetImmediate(()=>{r.onCompleteObservable.notifyObservers(r)}),r}return y(e,(e,r)=>{t(e,r?.responseURL,r?.getResponseHeader("content-type"))},r,o,i,n?e=>{n(e.request,new K(e.message,e.request))}:void 0,l)},y=(e,t,r,o,a,l,c)=>{e=U.CleanUrl(e),e=U.PreprocessUrl(e);let f=U.BaseUrl+e,u=!1,d={onCompleteObservable:new s.y$,abort:()=>u=!0},h=()=>{let e,o=new i.g,s=null,h=()=>{o&&(r&&o.removeEventListener("progress",r),e&&o.removeEventListener("readystatechange",e),o.removeEventListener("loadend",p))},p=()=>{h(),d.onCompleteObservable.notifyObservers(d),d.onCompleteObservable.clear(),r=void 0,e=null,p=null,l=void 0,c=void 0,t=void 0};d.abort=()=>{u=!0,p&&p(),o&&o.readyState!==(XMLHttpRequest.DONE||4)&&o.abort(),null!==s&&(clearTimeout(s),s=null),o=null};let m=e=>{let t=e.message||"Unknown error";l&&o?l(new v(t,o)):g.Y.Error(t)},P=d=>{if(o){if(o.open("GET",f),c)try{c(o)}catch(e){m(e);return}a&&(o.responseType="arraybuffer"),r&&o.addEventListener("progress",r),p&&o.addEventListener("loadend",p),e=()=>{if(!u&&o&&o.readyState===(XMLHttpRequest.DONE||4)){if(e&&o.removeEventListener("readystatechange",e),o.status>=200&&o.status<300||0===o.status&&(!(0,n.CG)()||E())){let e=a?o.response:o.responseText;if(null!==e){try{t&&t(e,o)}catch(e){m(e)}return}}let r=U.DefaultRetryStrategy;if(r){let e=r(f,o,d);if(-1!==e){h(),o=new i.g,s=setTimeout(()=>P(d+1),e);return}}let c=new v("Error status: "+o.status+" "+o.statusText+" - Unable to load "+f,o);l&&l(c)}},o.addEventListener("readystatechange",e),o.send()}};P(0)};if(o&&o.enableSceneOffline){let i=e=>{e&&e.status>400?l&&l(e):h()};o.open(()=>{o&&o.loadFile(U.BaseUrl+e,e=>{!u&&t&&t(e),d.onCompleteObservable.notifyObservers(d)},r?e=>{!u&&r&&r(e)}:void 0,i,a)},i)}else h();return d},B=e=>{let{match:t,type:r}=L(e);if(t)return r||void 0;let o=e.lastIndexOf(".");switch(e.substring(o+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"gltf":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},E=()=>"undefined"!=typeof location&&"file:"===location.protocol,T=e=>P.test(e),L=e=>{let t=P.exec(e);return null===t||0===t.length?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function w(e){return(0,f.HQ)(e.split(",")[1])}let R=e=>(0,f.rP)(e.split(",")[1]);m.a._FileToolsLoadImage=b,p.an.loadFile=F,u.k2.loadFile=F;let _=(e,t,r,i,n,s,a,l,c,f)=>{Object.defineProperty(o={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:r.DefaultRetryStrategy,BaseUrl:r.BaseUrl,CorsBehavior:r.CorsBehavior,PreprocessUrl:r.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:n,LoadFile:s,LoadImage:a,ReadFile:l,RequestFile:c,SetCorsBehavior:f},"DefaultRetryStrategy",{get:function(){return r.DefaultRetryStrategy},set:function(e){r.DefaultRetryStrategy=e}}),Object.defineProperty(o,"BaseUrl",{get:function(){return r.BaseUrl},set:function(e){r.BaseUrl=e}}),Object.defineProperty(o,"PreprocessUrl",{get:function(){return r.PreprocessUrl},set:function(e){r.PreprocessUrl=e}}),Object.defineProperty(o,"CorsBehavior",{get:function(){return r.CorsBehavior},set:function(e){r.CorsBehavior=e}})};_(w,R,U,T,E,F,b,x,y,A)},25146:function(e,t,r){function o(){return"undefined"!=typeof window}function i(){return"undefined"!=typeof navigator}function n(){return"undefined"!=typeof document}function s(e){let t="",r=e.firstChild;for(;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t}r.d(t,{CG:()=>o,MZ:()=>a,n5:()=>n,up:()=>i,v:()=>s});let a={IsWindowObjectExist:o,IsNavigatorAvailable:i,IsDocumentAvailable:n,GetDOMTextContent:s}},56877:function(e,t,r){r.d(t,{A8:()=>l,Gb:()=>n,LE:()=>a,an:()=>i,o_:()=>s});var o=r(53864);r(25146);let i={};function n(e,t,r=""){return r+(t?t+"\n":"")+e}function s(e,t,r,n,s,a,l){let c=l||i.loadFile;if(c)return c(e,t,r,n,s,a);throw(0,o.S)("FileTools")}function a(e,t,r,o){if(e){t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,r?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,o?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),r&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),o&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function l(e,t,r=!1,o){switch(e){case 3:{let e=(t instanceof ArrayBuffer,new Int8Array(t));return o&&e.set(new Int8Array(o)),e}case 0:{let e=(t instanceof ArrayBuffer,new Uint8Array(t));return o&&e.set(new Uint8Array(o)),e}case 4:{let e=new Int16Array(t instanceof ArrayBuffer?t:r?t/2:t);return o&&e.set(new Int16Array(o)),e}case 5:case 8:case 9:case 10:case 2:{let e=new Uint16Array(t instanceof ArrayBuffer?t:r?t/2:t);return o&&e.set(new Uint16Array(o)),e}case 6:{let e=new Int32Array(t instanceof ArrayBuffer?t:r?t/4:t);return o&&e.set(new Int32Array(o)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=new Uint32Array(t instanceof ArrayBuffer?t:r?t/4:t);return o&&e.set(new Uint32Array(o)),e}case 1:{let e=new Float32Array(t instanceof ArrayBuffer?t:r?t/4:t);return o&&e.set(new Float32Array(o)),e}}let i=(t instanceof ArrayBuffer,new Uint8Array(t));return o&&i.set(new Uint8Array(o)),i}},66319:function(e,t,r){r.d(t,{LP:()=>u,ZI:()=>f,dR:()=>c,sp:()=>g});var o=r(25146),i=r(10284),n=r(66755),s=r(88280),a=r(94294),l=r(56877);function c(e,t){return(0,i.iU)(t).cachedPipelines[e]}function f(e){let t=e._name,r=e.context;if(t&&r){let e=(0,i.iU)(r),o=e.cachedPipelines[t];o?.dispose(),delete e.cachedPipelines[t]}}function u(e,t,r,i,n,s,l){let c,f,u=(0,o.CG)()?s?.getHostDocument():null;c="string"==typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?u?.getElementById(t.vertexElement)||t.vertexElement:t.vertex||t,f="string"==typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?u?.getElementById(t.fragmentElement)||t.fragmentElement:t.fragment||t;let g=[void 0,void 0],h=()=>{if(g[0]&&g[1]){e.isFragment=!0;let[o,c]=g;(0,a.An)(c,e,(s,c)=>{var f,u,d,g;l&&(l._fragmentSourceCodeBeforeMigration=c),r&&(s=r("fragment",s));let h=(0,a.Ku)(o,s,e);e=null;let p=(f=h.vertexCode,u=h.fragmentCode,d=t,g=n,d?{vertexSourceCode:(1===g?"//":"")+"#define SHADER_NAME vertex:"+(d.vertexElement||d.vertex||d.spectorName||d)+"\n"+f,fragmentSourceCode:(1===g?"//":"")+"#define SHADER_NAME fragment:"+(d.fragmentElement||d.fragment||d.spectorName||d)+"\n"+u}:{vertexSourceCode:f,fragmentSourceCode:u});i?.(p.vertexSourceCode,p.fragmentSourceCode)},s)}};d(c,"Vertex","",t=>{(0,a.wz)(e),(0,a.An)(t,e,(e,o)=>{l&&(l._rawVertexSourceCode=t,l._vertexSourceCodeBeforeMigration=o),r&&(e=r("vertex",e)),g[0]=e,h()},s)},n),d(f,"Fragment","Pixel",e=>{l&&(l._rawFragmentSourceCode=e),g[1]=e,h()},n)}function d(e,t,r,i,s,a){let c;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void i((0,o.v)(e));if("source:"===e.substring(0,7))return void i(e.substring(7));if("base64:"===e.substring(0,7))return void i(window.atob(e.substring(7)));let f=n.v.GetShadersStore(s);if(f[e+t+"Shader"])return void i(f[e+t+"Shader"]);if(r&&f[e+r+"Shader"])return void i(f[e+r+"Shader"]);if(c="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:n.v.GetShadersRepository(s)+e,!(a=a||l.o_))throw Error("loadFileInjection is not defined");a(c+"."+t.toLowerCase()+".fx",i)}let g=(e,t,r,o)=>{try{let n=e.context?(0,i.iU)(e.context):null;n&&(n.disableParallelShaderCompile=e.disableParallelCompilation);let s=e.existingPipelineContext||t(e.shaderProcessingContext);return s._name=e.name,e.name&&n&&(n.cachedPipelines[e.name]=s),r(s,e.vertex,e.fragment,!!e.createAsRaw,"","",e.rebuildRebind,e.defines,e.transformFeedbackVaryings,"",()=>{o(s,()=>{e.onRenderingStateCompiled?.(s)})}),s}catch(e){throw s.Y.Error("Error compiling effect"),e}}},6838:function(e,t,r){function o(e){let t=1;do t*=2;while(t<e);return t===e}function i(e,t,r){return e*(1-r)+t*r}function n(e){let t=s(e),r=a(e);return t-e>e-r?r:t}function s(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function a(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)}function l(e,t,r=2){let o;switch(r){case 1:o=a(e);break;case 2:o=n(e);break;default:o=s(e)}return Math.min(o,t)}r.d(t,{Av:()=>a,Tr:()=>n,V2:()=>i,lP:()=>o,p7:()=>l})},70541:function(e,t,r){r.d(t,{$g:()=>K,ok:()=>P,w1:()=>m});var o=r(85791),i=r(25146),n=r(88280),s=r(40761),a=r(65698),l=r(53864),c=r(20034),f=r(65098),u=r(21381),d=r(67109),g=r(84137),h=r(53986),p=r(6838);class m{static get BaseUrl(){return u.rN.BaseUrl}static set BaseUrl(e){u.rN.BaseUrl=e}static get CleanUrl(){return u.rN.CleanUrl}static set CleanUrl(e){u.rN.CleanUrl=e}static IsAbsoluteUrl(e){return 0===e.indexOf("//")||!(-1===e.indexOf("://")||-1===e.indexOf(".")||-1===e.indexOf("/")||e.indexOf(":")>e.indexOf("/"))&&(!!(e.indexOf("://")<e.indexOf("."))||0===e.indexOf("data:")||0===e.indexOf("blob:"))}static set ScriptBaseUrl(e){u.rN.ScriptBaseUrl=e}static get ScriptBaseUrl(){return u.rN.ScriptBaseUrl}static set CDNBaseUrl(e){m.ScriptBaseUrl=e,m.AssetBaseUrl=e}static set ScriptPreprocessUrl(e){u.rN.ScriptPreprocessUrl=e}static get ScriptPreprocessUrl(){return u.rN.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.rN.DefaultRetryStrategy}static set DefaultRetryStrategy(e){u.rN.DefaultRetryStrategy=e}static get CorsBehavior(){return u.rN.CorsBehavior}static set CorsBehavior(e){u.rN.CorsBehavior=e}static get UseFallbackTexture(){return f.l.UseFallbackTexture}static set UseFallbackTexture(e){f.l.UseFallbackTexture=e}static get RegisteredExternalClasses(){return g.K.RegisteredExternalClasses}static set RegisteredExternalClasses(e){g.K.RegisteredExternalClasses=e}static get fallbackTexture(){return f.l.FallbackTexture}static set fallbackTexture(e){f.l.FallbackTexture=e}static FetchToRef(e,t,r,o,i,n){let s=((Math.abs(e)*r%r|0)+(Math.abs(t)*o%o|0)*r)*4;n.r=i[s]/255,n.g=i[s+1]/255,n.b=i[s+2]/255,n.a=i[s+3]/255}static Mix(e,t,r){return 0}static Instantiate(e){return g.K.Instantiate(e)}static SetImmediate(e){d.Q.SetImmediate(e)}static IsExponentOfTwo(e){return!0}static FloatRound(e){return Math.fround(e)}static GetFilename(e){let t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)}static GetFolderPath(e,t=!1){let r=e.lastIndexOf("/");return r<0?t?e:"":e.substring(0,r+1)}static ToDegrees(e){return 180*e/Math.PI}static ToRadians(e){return e*Math.PI/180}static SmoothAngleChange(e,t,r=.9){let o=this.ToRadians(e),i=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-r)*Math.sin(i)+r*Math.sin(o),(1-r)*Math.cos(i)+r*Math.cos(o)))}static MakeArray(e,t){return!0!==t&&(void 0===e||null==e)?null:Array.isArray(e)?e:[e]}static GetPointerPrefix(e){return(0,i.CG)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(e,t){(0,u.$M)(e,t)}static SetReferrerPolicyBehavior(e,t){t.referrerPolicy=e}static get PreprocessUrl(){return u.rN.PreprocessUrl}static set PreprocessUrl(e){u.rN.PreprocessUrl=e}static LoadImage(e,t,r,o,i,n){return(0,u.r6)(e,t,r,o,i,n)}static LoadFile(e,t,r,o,i,n){return(0,u.vP)(e,t,r,o,i,n)}static async LoadFileAsync(e,t=!0){return await new Promise((r,o)=>{(0,u.vP)(e,e=>{r(e)},void 0,void 0,t,(e,t)=>{o(t)})})}static GetAssetUrl(e){if(!e)return"";if(m.AssetBaseUrl&&e.startsWith(m._DefaultAssetsUrl)){let t="/"===m.AssetBaseUrl[m.AssetBaseUrl.length-1]?m.AssetBaseUrl.substring(0,m.AssetBaseUrl.length-1):m.AssetBaseUrl;return e.replace(m._DefaultAssetsUrl,t)}return e}static GetBabylonScriptURL(e,t){if(!e)return"";if(m.ScriptBaseUrl&&e.startsWith(m._DefaultCdnUrl)){let t="/"===m.ScriptBaseUrl[m.ScriptBaseUrl.length-1]?m.ScriptBaseUrl.substring(0,m.ScriptBaseUrl.length-1):m.ScriptBaseUrl;e=e.replace(m._DefaultCdnUrl,t)}return e=m.ScriptPreprocessUrl(e),t&&(e=m.GetAbsoluteUrl(e)),e}static LoadBabylonScript(e,t,r,o){e=m.GetBabylonScriptURL(e),m.LoadScript(e,t,r)}static async LoadBabylonScriptAsync(e){return e=m.GetBabylonScriptURL(e),await m.LoadScriptAsync(e)}static LoadScript(e,t,r,o,n=!1){if("function"==typeof importScripts){try{importScripts(e),t&&t()}catch(t){r?.(`Unable to load script '${e}' in worker`,t)}return}if(!(0,i.CG)())return void r?.(`Cannot load script '${e}' outside of a window or a worker`);let s=document.getElementsByTagName("head")[0],a=document.createElement("script");n?(a.setAttribute("type","module"),a.innerText=e):(a.setAttribute("type","text/javascript"),a.setAttribute("src",e)),o&&(a.id=o),a.onload=()=>{t&&t()},a.onerror=t=>{r&&r(`Unable to load script '${e}'`,t)},s.appendChild(a)}static async LoadScriptAsync(e,t){return await new Promise((r,o)=>{this.LoadScript(e,()=>{r()},(e,t)=>{o(t||Error(e))},t)})}static ReadFileAsDataURL(e,t,r){let i=new FileReader,n={onCompleteObservable:new o.y$,abort:()=>i.abort()};return i.onloadend=()=>{n.onCompleteObservable.notifyObservers(n)},i.onload=e=>{t(e.target.result)},i.onprogress=r,i.readAsDataURL(e),n}static ReadFile(e,t,r,o,i){return(0,u.Ip)(e,t,r,o,i)}static FileAsURL(e){let t=new Blob([e]);return window.URL.createObjectURL(t)}static Format(e,t=2){return e.toFixed(t)}static DeepCopy(e,t,r,o){s.j.DeepCopy(e,t,r,o)}static IsEmpty(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}static RegisterTopRootEvents(e,t){for(let r=0;r<t.length;r++){let o=t[r];e.addEventListener(o.name,o.handler,!1);try{window.parent&&window.parent.addEventListener(o.name,o.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(e,t){for(let r=0;r<t.length;r++){let o=t[r];e.removeEventListener(o.name,o.handler);try{e.parent&&e.parent.removeEventListener(o.name,o.handler)}catch(e){}}}static async DumpFramebuffer(e,t,r,o,i="image/png",n,s){throw(0,l.S)("DumpTools")}static DumpData(e,t,r,o,i="image/png",n,s=!1,a=!1,c){throw(0,l.S)("DumpTools")}static async DumpDataAsync(e,t,r,o="image/png",i,n=!1,s=!1,a){throw(0,l.S)("DumpTools")}static _IsOffScreenCanvas(e){return void 0!==e.convertToBlob}static ToBlob(e,t,r="image/png",o){m._IsOffScreenCanvas(e)||e.toBlob||(e.toBlob=function(e,t,r){setTimeout(()=>{let o=atob(this.toDataURL(t,r).split(",")[1]),i=o.length,n=new Uint8Array(i);for(let e=0;e<i;e++)n[e]=o.charCodeAt(e);e(new Blob([n]))})}),m._IsOffScreenCanvas(e)?e.convertToBlob({type:r,quality:o}).then(e=>t(e)):e.toBlob(function(e){t(e)},r,o)}static DownloadBlob(e,t){if("download"in document.createElement("a")){if(!t){let e=new Date;t="screenshot_"+((e.getFullYear()+"-"+(e.getMonth()+1)).slice(2)+"-"+e.getDate()+"_"+e.getHours()+"-")+("0"+e.getMinutes()).slice(-2)+".png"}m.Download(e,t)}else if(e&&"undefined"!=typeof URL){let t=URL.createObjectURL(e),r=window.open("");if(!r)return;let o=r.document.createElement("img");o.onload=function(){URL.revokeObjectURL(t)},o.src=t,r.document.body.appendChild(o)}}static EncodeScreenshotCanvasData(e,t,r="image/png",o,i){if("string"!=typeof o&&t){if(t){if(m._IsOffScreenCanvas(e))return void e.convertToBlob({type:r,quality:i}).then(e=>{let r=new FileReader;r.readAsDataURL(e),r.onloadend=()=>{t(r.result)}});t(e.toDataURL(r,i))}}else this.ToBlob(e,function(e){e&&m.DownloadBlob(e,o),t&&t("")},r,i)}static Download(e,t){if("undefined"==typeof URL)return;let r=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.style.display="none",o.href=r,o.download=t,o.addEventListener("click",()=>{o.parentElement&&o.parentElement.removeChild(o)}),o.click(),window.URL.revokeObjectURL(r)}static BackCompatCameraNoPreventDefault(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]}static CreateScreenshot(e,t,r,o,i="image/png",n=!1,s){throw(0,l.S)("ScreenshotTools")}static async CreateScreenshotAsync(e,t,r,o="image/png",i){throw(0,l.S)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(e,t,r,o,i="image/png",n=1,s=!1,a,c=!1,f=!1,u=!0,d,g){throw(0,l.S)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(e,t,r,o="image/png",i=1,n=!1,s,a=!1,c=!1,f=!0,u,d){throw(0,l.S)("ScreenshotTools")}static RandomId(){return(0,h.f)()}static IsBase64(e){return(0,u.VL)(e)}static DecodeBase64(e){return(0,u.$K)(e)}static get errorsCount(){return n.Y.errorsCount}static Log(e){n.Y.Log(e)}static Warn(e){n.Y.Warn(e)}static Error(e){n.Y.Error(e)}static get LogCache(){return n.Y.LogCache}static ClearLogCache(){n.Y.ClearLogCache()}static set LogLevels(e){n.Y.LogLevels=e}static set PerformanceLogLevel(e){if((e&m.PerformanceUserMarkLogLevel)===m.PerformanceUserMarkLogLevel){m.StartPerformanceCounter=m._StartUserMark,m.EndPerformanceCounter=m._EndUserMark;return}if((e&m.PerformanceConsoleLogLevel)===m.PerformanceConsoleLogLevel){m.StartPerformanceCounter=m._StartPerformanceConsole,m.EndPerformanceCounter=m._EndPerformanceConsole;return}m.StartPerformanceCounter=m._StartPerformanceCounterDisabled,m.EndPerformanceCounter=m._EndPerformanceCounterDisabled}static _StartPerformanceCounterDisabled(e,t){}static _EndPerformanceCounterDisabled(e,t){}static _StartUserMark(e,t=!0){if(!m._Performance){if(!(0,i.CG)())return;m._Performance=window.performance}t&&m._Performance.mark&&m._Performance.mark(e+"-Begin")}static _EndUserMark(e,t=!0){t&&m._Performance.mark&&(m._Performance.mark(e+"-End"),m._Performance.measure(e,e+"-Begin",e+"-End"))}static _StartPerformanceConsole(e,t=!0){t&&(m._StartUserMark(e,t),console.time&&console.time(e))}static _EndPerformanceConsole(e,t=!0){t&&(m._EndUserMark(e,t),console.timeEnd(e))}static get Now(){return a.F.Now}static GetClassName(e,t=!1){let r=null;return!t&&e.getClassName?r=e.getClassName():(e instanceof Object&&(r=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),r||(r=typeof e)),r}static First(e,t){for(let r of e)if(t(r))return r;return null}static getFullClassName(e,t=!1){let r=null,o=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object){let i=t?e:Object.getPrototypeOf(e);r=i.constructor.__bjsclassName__,o=i.constructor.__bjsmoduleName__}r||(r=typeof e)}return r?(null!=o?o+".":"")+r:null}static async DelayAsync(e){await new Promise(t=>{setTimeout(()=>{t()},e)})}static IsSafari(){return!!(0,i.up)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}function P(e,t){return r=>{r.__bjsclassName__=e,r.__bjsmoduleName__=null!=t?t:null}}m.AssetBaseUrl="",m.UseCustomRequestHeaders=!1,m.CustomRequestHeaders=c.g.CustomRequestHeaders,m.GetDOMTextContent=i.v,m._DefaultCdnUrl="https://cdn.babylonjs.com",m._DefaultAssetsUrl="https://assets.babylonjs.com/core",m.GetAbsoluteUrl="object"==typeof document?e=>{let t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?e=>new URL(e,location.origin).href:()=>{throw Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},m.NoneLogLevel=n.Y.NoneLogLevel,m.MessageLogLevel=n.Y.MessageLogLevel,m.WarningLogLevel=n.Y.WarningLogLevel,m.ErrorLogLevel=n.Y.ErrorLogLevel,m.AllLogLevel=n.Y.AllLogLevel,m.IsWindowObjectExist=i.CG,m.PerformanceNoneLogLevel=0,m.PerformanceUserMarkLogLevel=1,m.PerformanceConsoleLogLevel=2,m.StartPerformanceCounter=m._StartPerformanceCounterDisabled,m.EndPerformanceCounter=m._EndPerformanceCounterDisabled;class K{constructor(e,t,r,o=0){this.iterations=e,this.index=o-1,this._done=!1,this._fn=t,this._successCallback=r}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(e,t,r,o=0){let i=new K(e,t,r,o);return i.executeNext(),i}static SyncAsyncForLoop(e,t,r,o,i,n=0){return K.Run(Math.ceil(e/t),o=>{i&&i()?o.breakLoop():setTimeout(()=>{for(let n=0;n<t;++n){let s=o.index*t+n;if(s>=e)break;if(r(s),i&&i()){o.breakLoop();break}}o.executeNext()},n)},o)}}m.Mix=p.V2,m.IsExponentOfTwo=p.lP,f.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},84137:function(e,t,r){r.d(t,{K:()=>n});var o=r(88280),i=r(46363);class n{static Instantiate(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];let t=(0,i.qw)(e);if(t)return t;o.Y.Warn(e+" not found, you may have missed an import.");let r=e.split("."),n=window||this;for(let e=0,t=r.length;e<t;e++)n=n[r[e]];return"function"!=typeof n?null:n}}n.RegisteredExternalClasses={}},94294:function(e,t,r){r.d(t,{Ku:()=>x,aK:()=>b,wz:()=>A,An:()=>S,k2:()=>R,l:()=>w});class o{constructor(){this.children=[]}isValid(e){return!0}process(e,t,r){let o="";if(this.line){let r=this.line,i=t.processor;if(i){i.lineProcessor&&(r=i.lineProcessor(r,t.isFragment,t.processingContext));let o=t.processor?.attributeKeywordName??"attribute",n=t.isFragment&&t.processor?.varyingFragmentKeywordName?t.processor?.varyingFragmentKeywordName:!t.isFragment&&t.processor?.varyingVertexKeywordName?t.processor?.varyingVertexKeywordName:"varying";!t.isFragment&&i.attributeProcessor&&this.line.startsWith(o)?r=i.attributeProcessor(this.line,e,t.processingContext):i.varyingProcessor&&(i.varyingCheck?.(this.line,t.isFragment)||!i.varyingCheck&&this.line.startsWith(n))?r=i.varyingProcessor(this.line,t.isFragment,e,t.processingContext):i.uniformProcessor&&i.uniformRegexp&&i.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&i.uniformBufferRegexp&&i.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(r=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):i.textureProcessor&&i.textureRegexp&&i.textureRegexp.test(this.line)?r=i.textureProcessor(this.line,t.isFragment,e,t.processingContext):(i.uniformProcessor||i.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?i.uniformProcessor&&(r=i.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):i.uniformBufferProcessor&&(r=i.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,i.endOfUniformBufferProcessor&&(r=i.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}o+=r+"\n"}for(let i of this.children)o+=i.process(e,t,r);return this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true",r[this.additionalDefineKey]=e[this.additionalDefineKey]),o}}class i{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(e){for(let t of(this._lines.length=0,e)){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}let e=t.trim();if(!e)continue;if(e.startsWith("//")){this._lines.push(t);continue}let r=e.indexOf(";");if(-1===r)this._lines.push(e);else if(r===e.length-1)e.length>1&&this._lines.push(e);else{let e=t.split(";");for(let t=0;t<e.length;t++){let r=e[t];r&&(r=r.trim())&&this._lines.push(r+(t!==e.length-1?";":""))}}}}}class n extends o{process(e,t,r){for(let o=0;o<this.children.length;o++){let i=this.children[o];if(i.isValid(e))return i.process(e,t,r)}return""}}class s extends o{isValid(e){return this.testExpression.isTrue(e)}}class a{isTrue(e){return!0}static postfixToInfix(e){let t=[];for(let r of e)if(void 0===a._OperatorPriority[r])t.push(r);else{let e=t[t.length-1],o=t[t.length-2];t.length-=2,t.push(`(${o}${r}${e})`)}return t[t.length-1]}static infixToPostfix(e){let t=a._InfixToPostfixCache.get(e);if(t)return t.accessTime=Date.now(),t.result;if(!e.includes("&&")&&!e.includes("||")&&!e.includes(")")&&!e.includes("("))return[e];let r=[],o=-1,i=()=>{""!==(f=f.trim())&&(r.push(f),f="")},n=e=>{o<a._Stack.length-1&&(a._Stack[++o]=e)},s=()=>a._Stack[o],l=()=>-1===o?"!!INVALID EXPRESSION!!":a._Stack[o--],c=0,f="";for(;c<e.length;){let t=e.charAt(c),u=c<e.length-1?e.substring(c,2+c):"";if("("===t)f="",n(t);else if(")"===t){for(i();-1!==o&&"("!==s();)r.push(l());l()}else if(a._OperatorPriority[u]>1){for(i();-1!==o&&a._OperatorPriority[s()]>=a._OperatorPriority[u];)r.push(l());n(u),c++}else f+=t;c++}for(i();-1!==o;)"("===s()?l():r.push(l());return a._InfixToPostfixCache.size>=a.InfixToPostfixCacheLimitSize&&a.ClearCache(),a._InfixToPostfixCache.set(e,{result:r,accessTime:Date.now()}),r}static ClearCache(){let e=Array.from(a._InfixToPostfixCache.entries()).sort((e,t)=>e[1].accessTime-t[1].accessTime);for(let t=0;t<a.InfixToPostfixCacheCleanupSize;t++)a._InfixToPostfixCache.delete(e[t][0])}}a.InfixToPostfixCacheLimitSize=5e4,a.InfixToPostfixCacheCleanupSize=25e3,a._InfixToPostfixCache=new Map,a._OperatorPriority={")":0,"(":1,"||":2,"&&":3},a._Stack=["","","","","","","","","","","","","","","","","","","",""];class l extends a{constructor(e,t=!1){super(),this.define=e,this.not=t}isTrue(e){let t=void 0!==e[this.define];return this.not&&(t=!t),t}}class c extends a{isTrue(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)}}class f extends a{isTrue(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)}}class u extends a{constructor(e,t,r){super(),this.define=e,this.operand=t,this.testValue=r}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(e){let t=!1,r=parseInt(void 0!=e[this.define]?e[this.define]:this.define),o=parseInt(void 0!=e[this.testValue]?e[this.testValue]:this.testValue);if(isNaN(r)||isNaN(o))return!1;switch(this.operand){case">":t=r>o;break;case"<":t=r<o;break;case"<=":t=r<=o;break;case">=":t=r>=o;break;case"==":t=r===o;break;case"!=":t=r!==o}return t}}var d=r(53864),g=r(56877);let h=/defined\s*?\((.+?)\)/g,p=/defined\s*?\[(.+?)\]/g,m=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,P=/__decl__/,K=/light\{X\}.(\w*)/g,v=/\{X\}/g,C=[],U=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function A(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function S(e,t,r,o){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),w(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),r(function(e,t,r){let o=function(e,t){if(t.processor?.noPrecision)return e;let r=t.shouldUseHighPrecisionShader;return -1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e}(e,t);if(!t.processor||0===t.processor.shaderLanguage&&-1!==o.indexOf("#version 3")&&(o=o.replace("#version 300 es",""),!t.processor.parseGLES3))return o;let i=t.defines,n=L(t,r);t.processor.preProcessor&&(o=t.processor.preProcessor(o,i,n,t.isFragment,t.processingContext));let s={};return o=T(o,n,t,s),t.processor.postProcessor&&(o=t.processor.postProcessor(o,i,t.isFragment,t.processingContext,r?{drawBuffersExtensionDisabled:!r.getCaps().drawBuffersExtension}:{},n,s)),r?._features.needShaderCodeInlining&&(o=r.inlineShaderCode(o)),o}(e,t,o),e)})}function b(e,t,r,o){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),w(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),r(function(e,t,r){let o=e,i=t.defines,n=L(t,r);t.processor?.preProcessor&&(o=t.processor.preProcessor(o,i,n,t.isFragment,t.processingContext));let s={};return o=T(o,n,t,s),t.processor?.postProcessor&&(o=t.processor.postProcessor(o,i,t.isFragment,t.processingContext,r?{drawBuffersExtensionDisabled:!r.getCaps().drawBuffersExtension}:{},n,s)),r._features.needShaderCodeInlining&&(o=r.inlineShaderCode(o)),o}(e,t,o),e)})}function x(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}}function F(e){let t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new l(t[1].trim(),"!"===e[0]);let r="",o=0;for(r of["==","!=",">=","<=","<",">"])if((o=e.indexOf(r))>-1)break;if(-1===o)return new l(e);let i=e.substring(0,o).trim(),n=e.substring(o+r.length).trim();return new u(i,r,n)}function y(e,t){let r=new s,o=e.substring(0,t),i=e.substring(t);return i=i.substring(0,(i.indexOf("//")+1||i.length+1)-1).trim(),"#ifdef"===o?r.testExpression=new l(i):"#ifndef"===o?r.testExpression=new l(i,!0):r.testExpression=function(e){e=e.replace(h,"defined[$1]");let t=a.infixToPostfix(e),r=[];for(let e of t)if("||"!==e&&"&&"!==e)r.push(e);else if(r.length>=2){let t=r[r.length-1],o=r[r.length-2];r.length-=2;let i="&&"==e?new f:new c;"string"==typeof t&&(t=t.replace(p,"defined($1)")),"string"==typeof o&&(o=o.replace(p,"defined($1)")),i.leftOperand="string"==typeof o?F(o):o,i.rightOperand="string"==typeof t?F(t):t,r.push(i)}let o=r[r.length-1];return"string"==typeof o&&(o=o.replace(p,"defined($1)")),"string"==typeof o?F(o):o}(i),r}function B(e,t,r,i){let n=e.currentLine;for(;E(e,r,i);){let s=(n=e.currentLine).substring(0,5).toLowerCase();if("#else"===s){let r=new o;t.children.push(r),E(e,r,i);return}if("#elif"===s){let e=y(n,5);t.children.push(e),r=e}}}function E(e,t,r){for(;e.canRead;){e.lineIndex++;let i=e.currentLine;if(i.indexOf("#")>=0){let o=U.exec(i);if(o&&o.length){switch(o[0]){case"#ifdef":{let o=new n;t.children.push(o);let s=y(i,6);o.children.push(s),B(e,o,s,r);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{let o=new n;t.children.push(o);let s=y(i,7);o.children.push(s),B(e,o,s,r);break}case"#if":{let o=new n,s=y(i,3);t.children.push(o),o.children.push(s),B(e,o,s,r)}}continue}}let s=new o;if(s.line=i,t.children.push(s),"#"===i[0]&&"d"===i[1]){let e=i.replace(";","").split(" ");s.additionalDefineKey=e[1],3===e.length&&(s.additionalDefineValue=e[2])}}return!1}function T(e,t,r,n){let s=new o,a=new i;return a.lineIndex=-1,a.lines=e.split("\n"),E(a,s,n),s.process(t,r,n)}function L(e,t){let r=e.defines,o={};for(let e of r){let t=e.replace("#define","").replace(";","").trim().split(" ");o[t[0]]=t.length>1?t[1]:""}return e.processor?.shaderLanguage===0&&(o.GL_ES="true"),o.__VERSION__=e.version,o[e.platformName]="true",(0,g.LE)(o,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),o}function w(e,t,r){let o;for(C.length=0;null!==(o=m.exec(e));)C.push(o);let i=String(e),n=[e],s=!1;for(let e of C){let o=e[1];if(-1!==o.indexOf("__decl__")&&(o=o.replace(P,""),t.supportsUniformBuffers&&(o=o.replace("Vertex","Ubo").replace("Fragment","Ubo")),o+="Declaration"),t.includesShadersStore[o]){let r=t.includesShadersStore[o];if(e[2]){let t=e[3].split(",");for(let e=0;e<t.length;e+=2){let o=RegExp(t[e],"g"),i=t[e+1];r=r.replace(o,i)}}if(e[4]){let o=e[5];if(-1!==o.indexOf("..")){let e=o.split(".."),i=parseInt(e[0]),n=parseInt(e[1]),s=r.slice(0);r="",isNaN(n)&&(n=t.indexParameters[e[1]]);for(let e=i;e<n;e++)t.supportsUniformBuffers||(s=s.replace(K,(e,t)=>t+"{X}")),r+=s.replace(v,e.toString())+"\n"}else t.supportsUniformBuffers||(r=r.replace(K,(e,t)=>t+"{X}")),r=r.replace(v,o)}let i=[];for(let t of n){let o=t.split(e[0]);for(let e=0;e<o.length-1;e++)i.push(o[e]),i.push(r);i.push(o[o.length-1])}n=i,s=s||r.indexOf("#include<")>=0||r.indexOf("#include <")>=0}else{let e=t.shadersRepository+"ShadersInclude/"+o+".fx";R.loadFile(e,e=>{t.includesShadersStore[o]=e,w(n.join(""),t,r)});return}}C.length=0,i=n.join(""),s?w(i.toString(),t,r):r(i)}let R={loadFile:(e,t,r,o,i,n)=>{throw(0,d.S)("FileTools")}}}}]);