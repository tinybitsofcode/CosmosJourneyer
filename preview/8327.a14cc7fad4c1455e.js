/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["8327"],{10457:function(e,i,t){t.r(i),t.d(i,{_ENVTextureLoader:()=>r});var s=t(80610);class r{constructor(){this.supportCascades=!1}loadCubeData(e,i,t,r,n){if(Array.isArray(e))return;let o=(0,s.qJ)(e);if(o){i.width=o.width,i.height=o.width;try{(0,s.qC)(i,o),(0,s.Ro)(i,e,o).then(()=>{i.isReady=!0,i.onLoadedObservable.notifyObservers(i),i.onLoadedObservable.clear(),r&&r()},e=>{n?.("Can not upload environment levels",e)})}catch(e){n?.("Can not upload environment file",e)}}else n&&n("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},11141:function(e,i,t){t.d(i,{Q:()=>s});function s(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}},23207:function(e,i,t){let s;t.r(i),t.d(i,{Dispose:()=>u,DumpData:()=>d,DumpDataAsync:()=>p,DumpFramebuffer:()=>c,DumpTools:()=>P});var r=t(19956),n=t(70541),o=t(16891),a=t(65098);let l=null;async function h(){return l||(l=new Promise((e,i)=>{let n,o=null,l={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(t.bind(t,66588)).then(({ThinEngine:h})=>{let c=a.l.Instances.length;try{n=new OffscreenCanvas(100,100),o=new h(n,!1,l)}catch(e){c<a.l.Instances.length&&a.l.Instances.pop()?.dispose(),o=new h(n=document.createElement("canvas"),!1,l)}a.l.Instances.pop(),a.l.OnEnginesDisposedObservable.add(e=>{o&&e!==o&&!o.isDisposed&&0===a.l.Instances.length&&u()}),o.getCaps().parallelShaderCompile=void 0;let p=new r.I(o);t.e("395").then(t.bind(t,35066)).then(({passPixelShader:t})=>{if(!o)return void i("Engine is not defined");let a=new r.H({engine:o,name:t.name,fragmentShader:t.shader,samplerNames:["textureSampler"]});e(s={canvas:n,engine:o,renderer:p,wrapper:a})})}).catch(i)})),await l}async function c(e,i,t,s,r="image/png",n,o){let a=new Uint8Array((await t.readPixels(0,0,e,i)).buffer);d(e,i,a,s,r,n,!0,void 0,o)}async function p(e,i,t,s="image/png",r,n=!1,o=!1,a){return await new Promise(l=>{d(e,i,t,e=>l(e),s,r,n,o,a)})}function d(e,i,t,s,r="image/png",a,l=!1,c=!1,p){h().then(h=>{if(h.engine.setSize(e,i,!0),t instanceof Float32Array){let e=new Uint8Array(t.length),i=t.length;for(;i--;){let s=t[i];e[i]=Math.round(255*(0,o.Clamp)(s))}t=e}let d=h.engine.createRawTexture(t,e,i,5,!1,!l,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",d),h.renderer.draw(),c?n.w1.ToBlob(h.canvas,e=>{let i=new FileReader;i.onload=e=>{let i=e.target.result;s&&s(i)},i.readAsArrayBuffer(e)},r,p):n.w1.EncodeScreenshotCanvasData(h.canvas,s,r,a,p),d.dispose()})}function u(){s?(s.wrapper.dispose(),s.renderer.dispose(),s.engine.dispose()):l?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),l=null,s=null}let P={DumpData:d,DumpDataAsync:p,DumpFramebuffer:c,Dispose:u};n.w1.DumpData=d,n.w1.DumpDataAsync=p,n.w1.DumpFramebuffer=c},74484:function(e,i,t){var s=t(24103),r=t(11740);r.V.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.V.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;this._texture.isReady&&(this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=s.$.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0})))}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},76466:function(e,i,t){t.d(i,{O:()=>n,u:()=>r});var s=t(11141);function r(e,i){i.EXPOSURE&&e.push("exposureLinear"),i.CONTRAST&&e.push("contrast"),i.COLORGRADING&&e.push("colorTransformSettings"),(i.VIGNETTE||i.DITHER)&&e.push("vInverseScreenSize"),i.VIGNETTE&&(e.push("vignetteSettings1"),e.push("vignetteSettings2")),i.COLORCURVES&&(0,s.Q)(e),i.DITHER&&e.push("ditherIntensity")}function n(e,i){i.COLORGRADING&&e.push("txColorTransform")}},87245:function(e,i,t){t.d(i,{$:()=>P});var s=t(19488),r=t(60818),n=t(94826),o=t(61834),a=t(52765),l=t(70654),h=t(62046),c=t(54966),p=t(65098),d=t(99372);class u{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(e){this._singleClick=e}set doubleClick(e){this._doubleClick=e}set hasSwiped(e){this._hasSwiped=e}set ignore(e){this._ignore=e}}class P{constructor(e){if(this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=[],this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new o.FM(0,0),this._previousStartingPointerPosition=new o.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=e||p.l.LastCreatedScene,!this._scene)return}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(e){return this._meshUnderPointerId[e]||null}get unTranslatedPointer(){return new o.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(e){this._pointerX=e}get pointerY(){return this._pointerY}set pointerY(e){this._pointerY=e}_updatePointerPosition(e){let i=this._scene.getEngine().getInputElementClientRect();i&&(this._pointerX=e.clientX-i.left,this._pointerY=e.clientY-i.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(e,i){let t,r=this._scene,n=r.getEngine(),o=n.getInputElement();for(let t of(o&&(o.tabIndex=n.canvasTabIndex,r.doNotHandleCursors||(o.style.cursor=r.defaultCursor)),this._setCursorAndPointerOverMesh(e,i,r),r._pointerMoveStage)){e=e||this._pickMove(i);let s=!!e?.pickedMesh;e=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,o)}let a=i.inputIndex>=h.Fz.MouseWheelX&&i.inputIndex<=h.Fz.MouseWheelZ?s.kD.POINTERWHEEL:s.kD.POINTERMOVE;r.onPointerMove&&(e=e||this._pickMove(i),r.onPointerMove(i,e,a)),e?(t=new s.R5(a,i,e),this._setRayOnPointerInfo(e,i)):(t=new s.R5(a,i,null,this),this._movePointerInfo=t),r.onPointerObservable.hasObservers()&&r.onPointerObservable.notifyObservers(t,a)}_setRayOnPointerInfo(e,i){let t=this._scene;e&&d.r._IsPickingAvailable&&!e.ray&&(e.ray=t.createPickingRay(i.offsetX,i.offsetY,o.y3.Identity(),t.activeCamera))}_addCameraPointerObserver(e,i){return this._cameraObserverCount++,this._scene.onPointerObservable.add(e,i)}_removeCameraPointerObserver(e){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(e)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(e,i,t){let r=this._scene,n=new s.FV(t,i,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.originalPickingInfo=e,n.ray=e.ray,"xr-near"===i.pointerType&&e.originMesh&&(n.nearInteractionPickingInfo=e)),r.onPrePointerObservable.notifyObservers(n,t),!!n.skipOnPointerObservable}_pickMove(e){let i=this._scene,t=i.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,i.pointerMovePredicate,i.pointerMoveFastCheck,i.cameraToUseForPointers,i.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(t,e,i),t}_setCursorAndPointerOverMesh(e,i,t){let s=t.getEngine().getInputElement();if(e?.pickedMesh){if(this.setPointerOverMesh(e.pickedMesh,i.pointerId,e,i),!t.doNotHandleCursors&&s&&this._pointerOverMesh){let e=this._pointerOverMesh._getActionManagerForTrigger();e&&e.hasPointerTriggers&&(s.style.cursor=e.hoverCursor||t.hoverCursor)}}else this.setPointerOverMesh(null,i.pointerId,e,i)}simulatePointerMove(e,i){let t=new PointerEvent("pointermove",i);t.inputIndex=h.Fz.Move,this._checkPrePointerObservable(e,t,s.kD.POINTERMOVE)||this._processPointerMove(e,t)}simulatePointerDown(e,i){let t=new PointerEvent("pointerdown",i);t.inputIndex=t.button+2,this._checkPrePointerObservable(e,t,s.kD.POINTERDOWN)||this._processPointerDown(e,t)}_processPointerDown(e,i){let t,r=this._scene;if(e?.pickedMesh){this._pickedDownMesh=e.pickedMesh;let t=e.pickedMesh._getActionManagerForTrigger();if(t){if(t.hasPickTriggers)switch(t.processTrigger(5,new a.V(e.pickedMesh,r.pointerX,r.pointerY,e.pickedMesh,i,e)),i.button){case 0:t.processTrigger(2,new a.V(e.pickedMesh,r.pointerX,r.pointerY,e.pickedMesh,i,e));break;case 1:t.processTrigger(4,new a.V(e.pickedMesh,r.pointerX,r.pointerY,e.pickedMesh,i,e));break;case 2:t.processTrigger(3,new a.V(e.pickedMesh,r.pointerX,r.pointerY,e.pickedMesh,i,e))}t.hasSpecificTrigger(8)&&window.setTimeout(()=>{let e=r.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,e=>e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===this._pickedDownMesh,!1,r.cameraToUseForPointers);e?.pickedMesh&&t&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>P.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,t.processTrigger(8,a.V.CreateNew(e.pickedMesh,i)))},P.LongPressDelay)}}else for(let t of r._pointerDownStage)e=t.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,!1);let n=s.kD.POINTERDOWN;e?(r.onPointerDown&&r.onPointerDown(i,e,n),t=new s.R5(n,i,e),this._setRayOnPointerInfo(e,i)):t=new s.R5(n,i,null,this),r.onPointerObservable.hasObservers()&&r.onPointerObservable.notifyObservers(t,n)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(e,i,t){let r=new PointerEvent("pointerup",i);r.inputIndex=h.Fz.Move;let n=new u;t?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,r,s.kD.POINTERUP)||this._processPointerUp(e,r,n)}_processPointerUp(e,i,t){let r=this._scene;if(e?.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(i,e),t.singleClick&&!t.ignore&&r.onPointerObservable.observers.length>this._cameraObserverCount)){let t=s.kD.POINTERPICK,n=new s.R5(t,i,e);this._setRayOnPointerInfo(e,i),r.onPointerObservable.notifyObservers(n,t)}let n=e.pickedMesh._getActionManagerForTrigger();if(n&&!t.ignore){n.processTrigger(7,a.V.CreateNew(e.pickedMesh,i,e)),!t.hasSwiped&&t.singleClick&&n.processTrigger(1,a.V.CreateNew(e.pickedMesh,i,e));let s=e.pickedMesh._getActionManagerForTrigger(6);t.doubleClick&&s&&s.processTrigger(6,a.V.CreateNew(e.pickedMesh,i,e))}}else if(!t.ignore)for(let s of r._pointerUpStage)e=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,t.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){let e=this._pickedDownMesh._getActionManagerForTrigger(16);e&&e.processTrigger(16,a.V.CreateNew(this._pickedDownMesh,i))}if(!t.ignore){let n=new s.R5(s.kD.POINTERUP,i,e);if(this._setRayOnPointerInfo(e,i),r.onPointerObservable.notifyObservers(n,s.kD.POINTERUP),r.onPointerUp&&r.onPointerUp(i,e,s.kD.POINTERUP),!t.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let n=0;if(t.singleClick?n=s.kD.POINTERTAP:t.doubleClick&&(n=s.kD.POINTERDOUBLETAP),n){let t=new s.R5(n,i,e);r.onPointerObservable.hasObservers()&&r.onPointerObservable.hasSpecificMask(n)&&r.onPointerObservable.notifyObservers(t,n)}}}}isPointerCaptured(e=0){return this._pointerCaptures[e]}attachControl(e=!0,i=!0,t=!0,o=null){let p=this._scene,d=p.getEngine();o||(o=d.getInputElement()),this._alreadyAttached&&this.detachControl(),o&&(this._alreadyAttachedTo=o),this._deviceSourceManager=new c.U(d),this._initActionManager=e=>{if(!this._meshPickProceed){let i=!p.skipPointerUpPicking&&(0!==p._registeredActions||this._checkForPicking()||p.onPointerUp)?p.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerUpPredicate,p.pointerUpFastCheck,p.cameraToUseForPointers,p.pointerUpTrianglePredicate):null;this._currentPickResult=i,i&&(e=i.hit&&i.pickedMesh?i.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return e},this._delayedSimpleClick=(e,i,t)=>{if((Date.now()-this._previousStartingPointerTime>P.DoubleClickDelay&&!this._doubleClickOccured||e!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,this._delayedClicks[e])){let i=this._delayedClicks[e].evt,t=s.kD.POINTERTAP,r=new s.R5(t,i,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(t)&&p.onPointerObservable.notifyObservers(r,t),this._delayedClicks[e]=null}},this._initClickEvent=(e,i,t,n)=>{let o=new u;this._currentPickResult=null;let a=null,l=e.hasSpecificMask(s.kD.POINTERPICK)||i.hasSpecificMask(s.kD.POINTERPICK)||e.hasSpecificMask(s.kD.POINTERTAP)||i.hasSpecificMask(s.kD.POINTERTAP)||e.hasSpecificMask(s.kD.POINTERDOUBLETAP)||i.hasSpecificMask(s.kD.POINTERDOUBLETAP);!l&&r.O&&(a=this._initActionManager(a,o))&&(l=a.hasPickTriggers);let h=!1;if(l=l&&!this._isMultiTouchGesture){let l=t.button;if(o.hasSwiped=this._isPointerSwiping(),!o.hasSwiped){let c=!P.ExclusiveDoubleClickMode;if(!c&&(c=!e.hasSpecificMask(s.kD.POINTERDOUBLETAP)&&!i.hasSpecificMask(s.kD.POINTERDOUBLETAP))&&!r.O.HasSpecificTrigger(6)&&(a=this._initActionManager(a,o))&&(c=!a.hasSpecificTrigger(6)),c)(Date.now()-this._previousStartingPointerTime>P.DoubleClickDelay||l!==this._previousButtonPressed)&&(o.singleClick=!0,n(o,this._currentPickResult),h=!0);else{let e={evt:t,clickInfo:o,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,l,o,n),P.DoubleClickDelay)};this._delayedClicks[l]=e}let p=e.hasSpecificMask(s.kD.POINTERDOUBLETAP)||i.hasSpecificMask(s.kD.POINTERDOUBLETAP);!p&&r.O.HasSpecificTrigger(6)&&(a=this._initActionManager(a,o))&&(p=a.hasSpecificTrigger(6)),p&&(l===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<P.DoubleClickDelay&&!this._doubleClickOccured?(o.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l,P.ExclusiveDoubleClickMode?(this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),n(o,this._previousPickResult)):n(o,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,o.doubleClick=!0,o.ignore=!1,P.ExclusiveDoubleClickMode&&this._delayedClicks[l]&&(clearTimeout(this._delayedClicks[l]?.timeoutId),this._delayedClicks[l]=null),n(o,this._currentPickResult)),h=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=l))}}h||n(o,this._currentPickResult)},this._onPointerMove=e=>{if(this._updatePointerPosition(e),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>P.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>P.DragMovementThreshold),d.isPointerLock&&d._verifyPointerLock(),this._checkPrePointerObservable(null,e,e.inputIndex>=h.Fz.MouseWheelX&&e.inputIndex<=h.Fz.MouseWheelZ?s.kD.POINTERWHEEL:s.kD.POINTERMOVE)||!p.cameraToUseForPointers&&!p.activeCamera)return;if(p.skipPointerMovePicking)return void this._processPointerMove(new n.p,e);p.pointerMovePredicate||(p.pointerMovePredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||p.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0));let i=p._registeredActions>0||p.constantlyUpdateMeshUnderPointer?this._pickMove(e):null;this._processPointerMove(i,e)},this._onPointerDown=e=>{let i,t=this._activePointerIds.indexOf(-1);if(-1===t?this._activePointerIds.push(e.pointerId):this._activePointerIds[t]=e.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,P.ExclusiveDoubleClickMode){for(let i=0;i<this._delayedClicks.length;i++)if(this._delayedClicks[i])if(e.button===i)clearTimeout(this._delayedClicks[i]?.timeoutId);else{let e=this._delayedClicks[i].clickInfo;this._doubleClickOccured=!1,e.singleClick=!0,e.ignore=!1;let t=this._delayedClicks[i].evt,r=s.kD.POINTERTAP,n=new s.R5(r,t,this._currentPickResult);p.onPointerObservable.hasObservers()&&p.onPointerObservable.hasSpecificMask(r)&&p.onPointerObservable.notifyObservers(n,r),this._delayedClicks[i]=null}}this._updatePointerPosition(e),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=e.button),p.preventDefaultOnPointerDown&&o&&(e.preventDefault(),o.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),!this._checkPrePointerObservable(null,e,s.kD.POINTERDOWN)&&(p.cameraToUseForPointers||p.activeCamera)&&(this._pointerCaptures[e.pointerId]=!0,p.pointerDownPredicate||(p.pointerDownPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0)),this._pickedDownMesh=null,i=!p.skipPointerDownPicking&&(0!==p._registeredActions||this._checkForPicking()||p.onPointerDown)?p.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,p.pointerDownPredicate,p.pointerDownFastCheck,p.cameraToUseForPointers,p.pointerDownTrianglePredicate):new n.p,this._processPointerDown(i,e))},this._onPointerUp=e=>{let i=this._activePointerIds.indexOf(e.pointerId);-1!==i&&(this._activePointerIds[i]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(e),p.preventDefaultOnPointerUp&&o&&(e.preventDefault(),o.focus()),this._initClickEvent(p.onPrePointerObservable,p.onPointerObservable,e,(i,t)=>{if(p.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!i.ignore)){if(this._checkPrePointerObservable(null,e,s.kD.POINTERUP)){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1);return}!i.hasSwiped&&(i.singleClick&&p.onPrePointerObservable.hasSpecificMask(s.kD.POINTERTAP)&&this._checkPrePointerObservable(null,e,s.kD.POINTERTAP)&&(this._skipPointerTap=!0),i.doubleClick&&p.onPrePointerObservable.hasSpecificMask(s.kD.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,e,s.kD.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}if(!this._pointerCaptures[e.pointerId]){this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1);return}0===e.buttons&&(this._pointerCaptures[e.pointerId]=!1),(p.cameraToUseForPointers||p.activeCamera)&&(p.pointerUpPredicate||(p.pointerUpPredicate=e=>e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!p.cameraToUseForPointers||(p.cameraToUseForPointers.layerMask&e.layerMask)!=0)),!this._meshPickProceed&&(r.O&&r.O.HasTriggers||this._checkForPicking()||p.onPointerUp)&&this._initActionManager(null,i),t||(t=this._currentPickResult),this._processPointerUp(t,e,i),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===e.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))}))},this._onKeyDown=e=>{let i=l.OG.KEYDOWN;if(p.onPreKeyboardObservable.hasObservers()){let t=new l.WZ(i,e);if(p.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){let t=new l.NG(i,e);p.onKeyboardObservable.notifyObservers(t,i)}p.actionManager&&p.actionManager.processTrigger(14,a.V.CreateNewFromScene(p,e))},this._onKeyUp=e=>{let i=l.OG.KEYUP;if(p.onPreKeyboardObservable.hasObservers()){let t=new l.WZ(i,e);if(p.onPreKeyboardObservable.notifyObservers(t,i),t.skipOnKeyboardObservable)return}if(p.onKeyboardObservable.hasObservers()){let t=new l.NG(i,e);p.onKeyboardObservable.notifyObservers(t,i)}p.actionManager&&p.actionManager.processTrigger(15,a.V.CreateNewFromScene(p,e))},this._deviceSourceManager.onDeviceConnectedObservable.add(s=>{s.deviceType===h.Yi.Mouse?s.onInputChangedObservable.add(r=>{this._originMouseEvent=r,r.inputIndex===h.Fz.LeftClick||r.inputIndex===h.Fz.MiddleClick||r.inputIndex===h.Fz.RightClick||r.inputIndex===h.Fz.BrowserBack||r.inputIndex===h.Fz.BrowserForward?i&&1===s.getInput(r.inputIndex)?this._onPointerDown(r):e&&0===s.getInput(r.inputIndex)&&this._onPointerUp(r):t&&(r.inputIndex===h.Fz.Move?this._onPointerMove(r):(r.inputIndex===h.Fz.MouseWheelX||r.inputIndex===h.Fz.MouseWheelY||r.inputIndex===h.Fz.MouseWheelZ)&&this._onPointerMove(r))}):s.deviceType===h.Yi.Touch?s.onInputChangedObservable.add(r=>{r.inputIndex===h.Fz.LeftClick&&(i&&1===s.getInput(r.inputIndex)?(this._onPointerDown(r),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):e&&0===s.getInput(r.inputIndex)&&(this._onPointerUp(r),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),t&&r.inputIndex===h.Fz.Move&&this._onPointerMove(r)}):s.deviceType===h.Yi.Keyboard&&s.onInputChangedObservable.add(e=>{"keydown"===e.type?this._onKeyDown(e):"keyup"===e.type&&this._onKeyUp(e)})}),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(e,i=0,t,s){let r;if(this._meshUnderPointerId[i]===e&&(!e||!e._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;let n=this._meshUnderPointerId[i];n&&(r=n._getActionManagerForTrigger(10))&&r.processTrigger(10,new a.V(n,this._pointerX,this._pointerY,e,s,{pointerId:i})),e?(this._meshUnderPointerId[i]=e,this._pointerOverMesh=e,(r=e._getActionManagerForTrigger(9))&&r.processTrigger(9,new a.V(e,this._pointerX,this._pointerY,e,s,{pointerId:i,pickResult:t}))):(delete this._meshUnderPointerId[i],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:e,pointerId:i})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(e){for(let i in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[i]===e&&delete this._meshUnderPointerId[i]}}P.DragMovementThreshold=10,P.LongPressDelay=500,P.DoubleClickDelay=300,P.ExclusiveDoubleClickMode=!1},89170:function(e,i,t){t.d(i,{m:()=>s});class s{static CompareLightsPriority(e,i){return e.shadowEnabled!==i.shadowEnabled?!!i.shadowEnabled-!!e.shadowEnabled:i.renderPriority-e.renderPriority}}s.FALLOFF_DEFAULT=0,s.FALLOFF_PHYSICAL=1,s.FALLOFF_GLTF=2,s.FALLOFF_STANDARD=3,s.LIGHTMAP_DEFAULT=0,s.LIGHTMAP_SPECULAR=1,s.LIGHTMAP_SHADOWSONLY=2,s.INTENSITYMODE_AUTOMATIC=0,s.INTENSITYMODE_LUMINOUSPOWER=1,s.INTENSITYMODE_LUMINOUSINTENSITY=2,s.INTENSITYMODE_ILLUMINANCE=3,s.INTENSITYMODE_LUMINANCE=4,s.LIGHTTYPEID_POINTLIGHT=0,s.LIGHTTYPEID_DIRECTIONALLIGHT=1,s.LIGHTTYPEID_SPOTLIGHT=2,s.LIGHTTYPEID_HEMISPHERICLIGHT=3,s.LIGHTTYPEID_RECT_AREALIGHT=4},92212:function(e,i,t){t.d(i,{M:()=>s});class s{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}},99372:function(e,i,t){t.d(i,{r:()=>s});class s{}s._IsPickingAvailable=!1}}]);