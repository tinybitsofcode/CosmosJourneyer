/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["2340"],{2607:function(e,t,r){r.d(t,{LV:()=>n.Z,N3:()=>i.Z,Z9:()=>a.Z,xE:()=>s.Z}),r(65002),r(75208),r(50195),r(1812),r(89309),r(10645);var n=r(6331);r(44976);var i=r(96368);r(58237);var a=r(2043),s=r(81997)},78626:function(e,t){t.uniformRandBool=t.normalRandom=t.randRange=t.randRangeInt=t.centeredRand=void 0;var r=function(e){return Math.random()};t.centeredRand=function(e,t){return void 0===e&&(e=r),(e(t)-.5)*2},t.randRangeInt=function(e,t,n,i){return void 0===n&&(n=r),Math.floor(n(i)*(t-e+1))+e},t.randRange=function(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=r),n(i)*(t-e)+e},t.normalRandom=function(e,t,n,i){return void 0===n&&(n=r),e+t*Math.sqrt(-2*Math.log(n(i)))*Math.cos(2*Math.PI*n(i+1))},t.uniformRandBool=function(e,t,n){return void 0===t&&(t=r),t(n)<e}},41686:function(e,t,r){r.d(t,{An:()=>L,Ku:()=>N,PM:()=>w,aK:()=>I,wz:()=>O,xd:()=>D});var n=r(52630),i=r(5380),a=r(46348),s=r(13070),o=r(50242),l=r(31621),E=r(90435),_=r(41345),u=r(75061),T=r(9139),d=r(88173);let R=/defined\s*?\((.+?)\)/g,A=/defined\s*?\[(.+?)\]/g,c=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,h=/__decl__/,p=/light\{X\}.(\w*)/g,g=/\{X\}/g,f=[],S=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function O(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)}function L(e,t,r,n){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),D(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),r(function(e,t,r){let n=function(e,t){if(t.processor?.noPrecision)return e;let r=t.shouldUseHighPrecisionShader;return -1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e}(e,t);if(!t.processor||0===t.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!t.processor.parseGLES3))return n;let i=t.defines,a=x(t,r);t.processor.preProcessor&&(n=t.processor.preProcessor(n,i,a,t.isFragment,t.processingContext));let s={};return n=U(n,a,t,s),t.processor.postProcessor&&(n=t.processor.postProcessor(n,i,t.isFragment,t.processingContext,r?{drawBuffersExtensionDisabled:!r.getCaps().drawBuffersExtension}:{},a,s)),r?._features.needShaderCodeInlining&&(n=r.inlineShaderCode(n)),n}(e,t,n),e)})}function I(e,t,r,n){t.processor?.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),D(e,t,e=>{t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e,t.defines)),r(function(e,t,r){let n=e,i=t.defines,a=x(t,r);t.processor?.preProcessor&&(n=t.processor.preProcessor(n,i,a,t.isFragment,t.processingContext));let s={};return n=U(n,a,t,s),t.processor?.postProcessor&&(n=t.processor.postProcessor(n,i,t.isFragment,t.processingContext,r?{drawBuffersExtensionDisabled:!r.getCaps().drawBuffersExtension}:{},a,s)),r._features.needShaderCodeInlining&&(n=r.inlineShaderCode(n)),n}(e,t,n),e)})}function N(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}}function P(e){let t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new o.G(t[1].trim(),"!"===e[0]);let r="",n=0;for(r of["==","!=",">=","<=","<",">"])if((n=e.indexOf(r))>-1)break;if(-1===n)return new o.G(e);let i=e.substring(0,n).trim(),a=e.substring(n+r.length).trim();return new u.h(i,r,a)}function m(e,t){let r=new s.o,n=e.substring(0,t),i=e.substring(t);return i=i.substring(0,(i.indexOf("//")+1||i.length+1)-1).trim(),"#ifdef"===n?r.testExpression=new o.G(i):"#ifndef"===n?r.testExpression=new o.G(i,!0):r.testExpression=function(e){e=e.replace(R,"defined[$1]");let t=_.m.infixToPostfix(e),r=[];for(let e of t)if("||"!==e&&"&&"!==e)r.push(e);else if(r.length>=2){let t=r[r.length-1],n=r[r.length-2];r.length-=2;let i="&&"==e?new E.J:new l.J;"string"==typeof t&&(t=t.replace(A,"defined($1)")),"string"==typeof n&&(n=n.replace(A,"defined($1)")),i.leftOperand="string"==typeof n?P(n):n,i.rightOperand="string"==typeof t?P(t):t,r.push(i)}let n=r[r.length-1];return"string"==typeof n&&(n=n.replace(A,"defined($1)")),"string"==typeof n?P(n):n}(i),r}function M(e,t,r,i){let a=e.currentLine;for(;C(e,r,i);){let s=(a=e.currentLine).substring(0,5).toLowerCase();if("#else"===s){let r=new n.I;t.children.push(r),C(e,r,i);return}if("#elif"===s){let e=m(a,5);t.children.push(e),r=e}}}function C(e,t,r){for(;e.canRead;){e.lineIndex++;let i=e.currentLine;if(i.indexOf("#")>=0){let n=S.exec(i);if(n&&n.length){switch(n[0]){case"#ifdef":{let n=new a.d;t.children.push(n);let s=m(i,6);n.children.push(s),M(e,n,s,r);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{let n=new a.d;t.children.push(n);let s=m(i,7);n.children.push(s),M(e,n,s,r);break}case"#if":{let n=new a.d,s=m(i,3);t.children.push(n),n.children.push(s),M(e,n,s,r)}}continue}}let s=new n.I;if(s.line=i,t.children.push(s),"#"===i[0]&&"d"===i[1]){let e=i.replace(";","").split(" ");s.additionalDefineKey=e[1],3===e.length&&(s.additionalDefineValue=e[2])}}return!1}function U(e,t,r,a){let s=new n.I,o=new i.t;return o.lineIndex=-1,o.lines=e.split("\n"),C(o,s,a),s.process(t,r,a)}function x(e,t){let r=e.defines,n={};for(let e of r){let t=e.replace("#define","").replace(";","").trim().split(" ");n[t[0]]=t.length>1?t[1]:""}return e.processor?.shaderLanguage===0&&(n.GL_ES="true"),n.__VERSION__=e.version,n[e.platformName]="true",(0,d.sk)(n,t?.isNDCHalfZRange,t?.useReverseDepthBuffer,t?.useExactSrgbConversions),n}function D(e,t,r){let n;for(f.length=0;null!==(n=c.exec(e));)f.push(n);let i=String(e),a=[e],s=!1;for(let e of f){let n=e[1];if(-1!==n.indexOf("__decl__")&&(n=n.replace(h,""),t.supportsUniformBuffers&&(n=n.replace("Vertex","Ubo").replace("Fragment","Ubo")),n+="Declaration"),t.includesShadersStore[n]){let r=t.includesShadersStore[n];if(e[2]){let t=e[3].split(",");for(let e=0;e<t.length;e+=2){let n=RegExp(t[e],"g"),i=t[e+1];r=r.replace(n,i)}}if(e[4]){let n=e[5];if(-1!==n.indexOf("..")){let e=n.split(".."),i=parseInt(e[0]),a=parseInt(e[1]),s=r.slice(0);r="",isNaN(a)&&(a=t.indexParameters[e[1]]);for(let e=i;e<a;e++)t.supportsUniformBuffers||(s=s.replace(p,(e,t)=>t+"{X}")),r+=s.replace(g,e.toString())+"\n"}else t.supportsUniformBuffers||(r=r.replace(p,(e,t)=>t+"{X}")),r=r.replace(g,n)}let i=[];for(let t of a){let n=t.split(e[0]);for(let e=0;e<n.length-1;e++)i.push(n[e]),i.push(r);i.push(n[n.length-1])}a=i,s=s||r.indexOf("#include<")>=0||r.indexOf("#include <")>=0}else{let e=t.shadersRepository+"ShadersInclude/"+n+".fx";w.loadFile(e,e=>{t.includesShadersStore[n]=e,D(a.join(""),t,r)});return}}f.length=0,i=a.join(""),s?D(i.toString(),t,r):r(i)}let w={loadFile:(e,t,r,n,i,a)=>{throw(0,T.S)("FileTools")}}},88173:function(e,t,r){r.d(t,{A8:()=>l,Gb:()=>a,an:()=>i,sk:()=>o,wv:()=>s});var n=r(9139);r(82090);let i={};function a(e,t,r=""){return r+(t?t+"\n":"")+e}function s(e,t,r,a,s,o,l){let E=l||i.loadFile;if(E)return E(e,t,r,a,s,o);throw(0,n.S)("FileTools")}function o(e,t,r,n){if(e){t?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,r?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER,n?e.USE_EXACT_SRGB_CONVERSIONS="":delete e.USE_EXACT_SRGB_CONVERSIONS;return}{let e="";return t&&(e+="#define IS_NDC_HALF_ZRANGE"),r&&(e&&(e+="\n"),e+="#define USE_REVERSE_DEPTHBUFFER"),n&&(e&&(e+="\n"),e+="#define USE_EXACT_SRGB_CONVERSIONS"),e}}function l(e,t,r=!1,n){switch(e){case 3:{let e=(t instanceof ArrayBuffer,new Int8Array(t));return n&&e.set(new Int8Array(n)),e}case 0:{let e=(t instanceof ArrayBuffer,new Uint8Array(t));return n&&e.set(new Uint8Array(n)),e}case 4:{let e=new Int16Array(t instanceof ArrayBuffer?t:r?t/2:t);return n&&e.set(new Int16Array(n)),e}case 5:case 8:case 9:case 10:case 2:{let e=new Uint16Array(t instanceof ArrayBuffer?t:r?t/2:t);return n&&e.set(new Uint16Array(n)),e}case 6:{let e=new Int32Array(t instanceof ArrayBuffer?t:r?t/4:t);return n&&e.set(new Int32Array(n)),e}case 7:case 11:case 12:case 13:case 14:case 15:{let e=new Uint32Array(t instanceof ArrayBuffer?t:r?t/4:t);return n&&e.set(new Uint32Array(n)),e}case 1:{let e=new Float32Array(t instanceof ArrayBuffer?t:r?t/4:t);return n&&e.set(new Float32Array(n)),e}}let i=(t instanceof ArrayBuffer,new Uint8Array(t));return n&&i.set(new Uint8Array(n)),i}},43720:function(e,t,r){r.d(t,{g:()=>n});class n{}n.AUTOSAMPLERSUFFIX="Sampler",n.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",n.ALPHA_DISABLE=0,n.ALPHA_ADD=1,n.ALPHA_COMBINE=2,n.ALPHA_SUBTRACT=3,n.ALPHA_MULTIPLY=4,n.ALPHA_MAXIMIZED=5,n.ALPHA_ONEONE=6,n.ALPHA_PREMULTIPLIED=7,n.ALPHA_PREMULTIPLIED_PORTERDUFF=8,n.ALPHA_INTERPOLATE=9,n.ALPHA_SCREENMODE=10,n.ALPHA_ONEONE_ONEONE=11,n.ALPHA_ALPHATOCOLOR=12,n.ALPHA_REVERSEONEMINUS=13,n.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,n.ALPHA_ONEONE_ONEZERO=15,n.ALPHA_EXCLUSION=16,n.ALPHA_LAYER_ACCUMULATE=17,n.ALPHA_EQUATION_ADD=0,n.ALPHA_EQUATION_SUBSTRACT=1,n.ALPHA_EQUATION_REVERSE_SUBTRACT=2,n.ALPHA_EQUATION_MAX=3,n.ALPHA_EQUATION_MIN=4,n.ALPHA_EQUATION_DARKEN=5,n.DELAYLOADSTATE_NONE=0,n.DELAYLOADSTATE_LOADED=1,n.DELAYLOADSTATE_LOADING=2,n.DELAYLOADSTATE_NOTLOADED=4,n.NEVER=512,n.ALWAYS=519,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATER=516,n.GEQUAL=518,n.NOTEQUAL=517,n.KEEP=7680,n.ZERO=0,n.REPLACE=7681,n.INCR=7682,n.DECR=7683,n.INVERT=5386,n.INCR_WRAP=34055,n.DECR_WRAP=34056,n.TEXTURE_CLAMP_ADDRESSMODE=0,n.TEXTURE_WRAP_ADDRESSMODE=1,n.TEXTURE_MIRROR_ADDRESSMODE=2,n.TEXTURE_CREATIONFLAG_STORAGE=1,n.TEXTUREFORMAT_ALPHA=0,n.TEXTUREFORMAT_LUMINANCE=1,n.TEXTUREFORMAT_LUMINANCE_ALPHA=2,n.TEXTUREFORMAT_RGB=4,n.TEXTUREFORMAT_RGBA=5,n.TEXTUREFORMAT_RED=6,n.TEXTUREFORMAT_R=6,n.TEXTUREFORMAT_R16_UNORM=33322,n.TEXTUREFORMAT_RG16_UNORM=33324,n.TEXTUREFORMAT_RGB16_UNORM=32852,n.TEXTUREFORMAT_RGBA16_UNORM=32859,n.TEXTUREFORMAT_R16_SNORM=36760,n.TEXTUREFORMAT_RG16_SNORM=36761,n.TEXTUREFORMAT_RGB16_SNORM=36762,n.TEXTUREFORMAT_RGBA16_SNORM=36763,n.TEXTUREFORMAT_RG=7,n.TEXTUREFORMAT_RED_INTEGER=8,n.TEXTUREFORMAT_R_INTEGER=8,n.TEXTUREFORMAT_RG_INTEGER=9,n.TEXTUREFORMAT_RGB_INTEGER=10,n.TEXTUREFORMAT_RGBA_INTEGER=11,n.TEXTUREFORMAT_BGRA=12,n.TEXTUREFORMAT_DEPTH24_STENCIL8=13,n.TEXTUREFORMAT_DEPTH32_FLOAT=14,n.TEXTUREFORMAT_DEPTH16=15,n.TEXTUREFORMAT_DEPTH24=16,n.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,n.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,n.TEXTUREFORMAT_STENCIL8=19,n.TEXTUREFORMAT_UNDEFINED=0xffffffff,n.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,n.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,n.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,n.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,n.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,n.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,n.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,n.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,n.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,n.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,n.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,n.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,n.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,n.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,n.TEXTURETYPE_UNSIGNED_BYTE=0,n.TEXTURETYPE_UNSIGNED_INT=0,n.TEXTURETYPE_FLOAT=1,n.TEXTURETYPE_HALF_FLOAT=2,n.TEXTURETYPE_BYTE=3,n.TEXTURETYPE_SHORT=4,n.TEXTURETYPE_UNSIGNED_SHORT=5,n.TEXTURETYPE_INT=6,n.TEXTURETYPE_UNSIGNED_INTEGER=7,n.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,n.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,n.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,n.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,n.TEXTURETYPE_UNSIGNED_INT_24_8=12,n.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,n.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,n.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,n.TEXTURETYPE_UNDEFINED=16,n.TEXTURE_2D=3553,n.TEXTURE_2D_ARRAY=35866,n.TEXTURE_CUBE_MAP=34067,n.TEXTURE_CUBE_MAP_ARRAY=0xdeadbeef,n.TEXTURE_3D=32879,n.TEXTURE_NEAREST_SAMPLINGMODE=1,n.TEXTURE_NEAREST_NEAREST=1,n.TEXTURE_BILINEAR_SAMPLINGMODE=2,n.TEXTURE_LINEAR_LINEAR=2,n.TEXTURE_TRILINEAR_SAMPLINGMODE=3,n.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,n.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,n.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,n.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,n.TEXTURE_NEAREST_LINEAR=7,n.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,n.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,n.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,n.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,n.TEXTURE_LINEAR_NEAREST=12,n.TEXTURE_EXPLICIT_MODE=0,n.TEXTURE_SPHERICAL_MODE=1,n.TEXTURE_PLANAR_MODE=2,n.TEXTURE_CUBIC_MODE=3,n.TEXTURE_PROJECTION_MODE=4,n.TEXTURE_SKYBOX_MODE=5,n.TEXTURE_INVCUBIC_MODE=6,n.TEXTURE_EQUIRECTANGULAR_MODE=7,n.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,n.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,n.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,n.TEXTURE_FILTERING_QUALITY_HIGH=64,n.TEXTURE_FILTERING_QUALITY_MEDIUM=16,n.TEXTURE_FILTERING_QUALITY_LOW=8,n.SCALEMODE_FLOOR=1,n.SCALEMODE_NEAREST=2,n.SCALEMODE_CEILING=3,n.MATERIAL_TextureDirtyFlag=1,n.MATERIAL_LightDirtyFlag=2,n.MATERIAL_FresnelDirtyFlag=4,n.MATERIAL_AttributesDirtyFlag=8,n.MATERIAL_MiscDirtyFlag=16,n.MATERIAL_PrePassDirtyFlag=32,n.MATERIAL_ImageProcessingDirtyFlag=64,n.MATERIAL_AllDirtyFlag=127,n.MATERIAL_TriangleFillMode=0,n.MATERIAL_WireFrameFillMode=1,n.MATERIAL_PointFillMode=2,n.MATERIAL_PointListDrawMode=3,n.MATERIAL_LineListDrawMode=4,n.MATERIAL_LineLoopDrawMode=5,n.MATERIAL_LineStripDrawMode=6,n.MATERIAL_TriangleStripDrawMode=7,n.MATERIAL_TriangleFanDrawMode=8,n.MATERIAL_ClockWiseSideOrientation=0,n.MATERIAL_CounterClockWiseSideOrientation=1,n.ACTION_NothingTrigger=0,n.ACTION_OnPickTrigger=1,n.ACTION_OnLeftPickTrigger=2,n.ACTION_OnRightPickTrigger=3,n.ACTION_OnCenterPickTrigger=4,n.ACTION_OnPickDownTrigger=5,n.ACTION_OnDoublePickTrigger=6,n.ACTION_OnPickUpTrigger=7,n.ACTION_OnPickOutTrigger=16,n.ACTION_OnLongPressTrigger=8,n.ACTION_OnPointerOverTrigger=9,n.ACTION_OnPointerOutTrigger=10,n.ACTION_OnEveryFrameTrigger=11,n.ACTION_OnIntersectionEnterTrigger=12,n.ACTION_OnIntersectionExitTrigger=13,n.ACTION_OnKeyDownTrigger=14,n.ACTION_OnKeyUpTrigger=15,n.PARTICLES_BILLBOARDMODE_Y=2,n.PARTICLES_BILLBOARDMODE_ALL=7,n.PARTICLES_BILLBOARDMODE_STRETCHED=8,n.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,n.MESHES_CULLINGSTRATEGY_STANDARD=0,n.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,n.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,n.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,n.SCENELOADER_NO_LOGGING=0,n.SCENELOADER_MINIMAL_LOGGING=1,n.SCENELOADER_SUMMARY_LOGGING=2,n.SCENELOADER_DETAILED_LOGGING=3,n.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,n.PREPASS_POSITION_TEXTURE_TYPE=1,n.PREPASS_VELOCITY_TEXTURE_TYPE=2,n.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,n.PREPASS_COLOR_TEXTURE_TYPE=4,n.PREPASS_DEPTH_TEXTURE_TYPE=5,n.PREPASS_NORMAL_TEXTURE_TYPE=6,n.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,n.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,n.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,n.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,n.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,n.PREPASS_ALBEDO_TEXTURE_TYPE=12,n.BUFFER_CREATIONFLAG_READ=1,n.BUFFER_CREATIONFLAG_WRITE=2,n.BUFFER_CREATIONFLAG_READWRITE=3,n.BUFFER_CREATIONFLAG_UNIFORM=4,n.BUFFER_CREATIONFLAG_VERTEX=8,n.BUFFER_CREATIONFLAG_INDEX=16,n.BUFFER_CREATIONFLAG_STORAGE=32,n.BUFFER_CREATIONFLAG_INDIRECT=64,n.RENDERPASS_MAIN=0,n.INPUT_ALT_KEY=18,n.INPUT_CTRL_KEY=17,n.INPUT_META_KEY1=91,n.INPUT_META_KEY2=92,n.INPUT_META_KEY3=93,n.INPUT_SHIFT_KEY=16,n.SNAPSHOTRENDERING_STANDARD=0,n.SNAPSHOTRENDERING_FAST=1,n.PERSPECTIVE_CAMERA=0,n.ORTHOGRAPHIC_CAMERA=1,n.FOVMODE_VERTICAL_FIXED=0,n.FOVMODE_HORIZONTAL_FIXED=1,n.RIG_MODE_NONE=0,n.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,n.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,n.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,n.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,n.RIG_MODE_STEREOSCOPIC_INTERLACED=14,n.RIG_MODE_VR=20,n.RIG_MODE_CUSTOM=22,n.MAX_SUPPORTED_UV_SETS=6,n.GL_ALPHA_EQUATION_ADD=32774,n.GL_ALPHA_EQUATION_MIN=32775,n.GL_ALPHA_EQUATION_MAX=32776,n.GL_ALPHA_EQUATION_SUBTRACT=32778,n.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,n.GL_ALPHA_FUNCTION_SRC=768,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,n.GL_ALPHA_FUNCTION_SRC_ALPHA=770,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,n.GL_ALPHA_FUNCTION_DST_ALPHA=772,n.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,n.GL_ALPHA_FUNCTION_DST_COLOR=774,n.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,n.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,n.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,n.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,n.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,n.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,n.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,n.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,n.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,n.SnippetUrl="https://snippet.babylonjs.com",n.FOGMODE_NONE=0,n.FOGMODE_EXP=1,n.FOGMODE_EXP2=2,n.FOGMODE_LINEAR=3,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.PositionKind="position",n.NormalKind="normal",n.TangentKind="tangent",n.UVKind="uv",n.UV2Kind="uv2",n.UV3Kind="uv3",n.UV4Kind="uv4",n.UV5Kind="uv5",n.UV6Kind="uv6",n.ColorKind="color",n.ColorInstanceKind="instanceColor",n.MatricesIndicesKind="matricesIndices",n.MatricesWeightsKind="matricesWeights",n.MatricesIndicesExtraKind="matricesIndicesExtra",n.MatricesWeightsExtraKind="matricesWeightsExtra",n.ANIMATIONTYPE_FLOAT=0,n.ANIMATIONTYPE_VECTOR3=1,n.ANIMATIONTYPE_QUATERNION=2,n.ANIMATIONTYPE_MATRIX=3,n.ANIMATIONTYPE_COLOR3=4,n.ANIMATIONTYPE_COLOR4=7,n.ANIMATIONTYPE_VECTOR2=5,n.ANIMATIONTYPE_SIZE=6,n.ShadowMinZ=0,n.ShadowMaxZ=1e4},80709:function(e,t,r){r.d(t,{v:()=>n});class n{static GetShadersRepository(e=0){return 0===e?n.ShadersRepository:n.ShadersRepositoryWGSL}static GetShadersStore(e=0){return 0===e?n.ShadersStore:n.ShadersStoreWGSL}static GetIncludesShadersStore(e=0){return 0===e?n.IncludesShadersStore:n.IncludesShadersStoreWGSL}}n.ShadersRepository="src/Shaders/",n.ShadersStore={},n.IncludesShadersStore={},n.ShadersRepositoryWGSL="src/ShadersWGSL/",n.ShadersStoreWGSL={},n.IncludesShadersStoreWGSL={}},89808:function(e,t,r){r.d(t,{S:()=>a});var n=r(86832),i=r(62451);class a extends i.c{constructor(e){super(e)}getClassName(){return"AddBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} + ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.AddBlock",a)},70008:function(e,t,r){r.d(t,{x:()=>a});var n=r(86832),i=r(62451);class a extends i.c{constructor(e){super(e)}getClassName(){return"DivideBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} / ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.DivideBlock",a)},74185:function(e,t,r){r.d(t,{u:()=>o});var n=r(81005),i=r(1275),a=r(9291),s=r(86832);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("value",i.E.AutoDetect),this.registerOutput("output",i.E.Float),this._inputs[0].excludedConnectionPointTypes.push(i.E.Float),this._inputs[0].excludedConnectionPointTypes.push(i.E.Matrix)}getClassName(){return"LengthBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = length(${this.value.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.LengthBlock",o)},72472:function(e,t,r){r.d(t,{J:()=>o});var n=r(81005),i=r(1275),a=r(9291),s=r(86832);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("left",i.E.AutoDetect),this.registerInput("right",i.E.AutoDetect),this.registerInput("gradient",i.E.AutoDetect),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._linkConnectionTypes(1,2,!0),this._inputs[2].acceptedConnectionPointTypes.push(i.E.Float)}getClassName(){return"LerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = mix(${this.left.associatedVariableName} , ${this.right.associatedVariableName}, ${this.gradient.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.LerpBlock",o)},2384:function(e,t,r){r.d(t,{d:()=>o});var n=r(81005),i=r(1275),a=r(9291),s=r(86832);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("left",i.E.AutoDetect),this.registerInput("right",i.E.AutoDetect),this.registerOutput("output",i.E.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1)}getClassName(){return"MinBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = min(${this.left.associatedVariableName}, ${this.right.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.MinBlock",o)},99661:function(e,t,r){r.d(t,{n:()=>o});var n=r(81005),i=r(1275),a=r(9291),s=r(86832);class o extends n.k{constructor(e){super(e,a.u.Neutral),this.registerInput("value",i.E.Float),this.registerInput("edge",i.E.Float),this.registerOutput("output",i.E.Float)}getClassName(){return"StepBlock"}get value(){return this._inputs[0]}get edge(){return this._inputs[1]}get output(){return this._outputs[0]}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = step(${this.edge.associatedVariableName}, ${this.value.associatedVariableName});
`,this}}(0,s.H7)("BABYLON.StepBlock",o)},21710:function(e,t,r){r.d(t,{F:()=>a});var n=r(86832),i=r(62451);class a extends i.c{constructor(e){super(e)}getClassName(){return"SubtractBlock"}_buildBlock(e){super._buildBlock(e);let t=this._outputs[0];return e.compilationString+=e._declareOutput(t)+` = ${this.left.associatedVariableName} - ${this.right.associatedVariableName};
`,this}}(0,n.H7)("BABYLON.SubtractBlock",a)},46166:function(e,t,r){r.d(t,{l:()=>i});var n=r(13405);class i extends n.x{constructor(e,t,r,i,a,s=!0,o=!1,l=3,E=0,_,u,T){if(super(null,a,!s,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,_),this.format=i,!this._engine)return;this._engine._caps.textureFloatLinearFiltering||1!==E||(l=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==E||(l=1),this._texture=this._engine.createRawTexture(e,t,r,i,s,o,l,null,E,_??0,u??!1),this.wrapU=n.x.CLAMP_ADDRESSMODE,this.wrapV=n.x.CLAMP_ADDRESSMODE,this._waitingForData=!!T&&!e}update(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();let e=new i(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return e._texture=this._texture,this._texture.incrementReferences(),e}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,1,n,a,s,o)}static CreateLuminanceAlphaTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,2,n,a,s,o)}static CreateAlphaTexture(e,t,r,n,a=!0,s=!1,o=3){return new i(e,t,r,0,n,a,s,o)}static CreateRGBTexture(e,t,r,n,a=!0,s=!1,o=3,l=0,E=0,_=!1){return new i(e,t,r,4,n,a,s,o,l,E,_)}static CreateRGBATexture(e,t,r,n,a=!0,s=!1,o=3,l=0,E=0,_=!1,u=!1){return new i(e,t,r,5,n,a,s,o,l,E,_,u)}static CreateRGBAStorageTexture(e,t,r,n,a=!0,s=!1,o=3,l=0,E=!1){return new i(e,t,r,5,n,a,s,o,l,1,E)}static CreateRTexture(e,t,r,a,s=!0,o=!1,l=n.x.TRILINEAR_SAMPLINGMODE,E=1){return new i(e,t,r,6,a,s,o,l,E)}static CreateRStorageTexture(e,t,r,a,s=!0,o=!1,l=n.x.TRILINEAR_SAMPLINGMODE,E=1){return new i(e,t,r,6,a,s,o,l,E,1)}}},23066:function(e,t,r){r.d(t,{$6:()=>A,DG:()=>c,Es:()=>d,Qq:()=>R,W:()=>h,kt:()=>T,vU:()=>p});var n=r(51971),i=r(22543),a=r(51884),s=r(53566),o=r(26670),l=r(60892),E=r(66395),_=r(91939),u=r(72754);function T(e){let t,r,i=[],a=[],o=[],l=[],E=e.width||e.size||1,_=e.height||e.size||1,T=0|(e.subdivisionsX||e.subdivisions||1),d=0|(e.subdivisionsY||e.subdivisions||1);for(t=0;t<=d;t++)for(r=0;r<=T;r++){let e=new n.P(r*E/T-E/2,0,(d-t)*_/d-_/2),i=new n.P(0,1,0);a.push(e.x,e.y,e.z),o.push(i.x,i.y,i.z),l.push(r/T,u.VJ?t/d:1-t/d)}for(t=0;t<d;t++)for(r=0;r<T;r++)i.push(r+1+(t+1)*(T+1)),i.push(r+1+t*(T+1)),i.push(r+t*(T+1)),i.push(r+(t+1)*(T+1)),i.push(r+1+(t+1)*(T+1)),i.push(r+t*(T+1));let R=new s.x;return R.indices=i,R.positions=a,R.normals=o,R.uvs=l,R}function d(e){let t,r,i,a,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,l=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,E=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,_=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,u=e.subdivisions||{w:1,h:1},T=e.precision||{w:1,h:1},d=[],R=[],A=[],c=[];u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,T.w=T.w<1?1:T.w,T.h=T.h<1?1:T.h;let h={w:(E-o)/u.w,h:(_-l)/u.h};for(i=0;i<u.h;i++)for(a=0;a<u.w;a++)!function(e,i,a,s){let o=R.length/3,l=T.w+1;for(t=0;t<T.h;t++)for(r=0;r<T.w;r++){let e=[o+r+t*l,o+(r+1)+t*l,o+(r+1)+(t+1)*l,o+r+(t+1)*l];d.push(e[1]),d.push(e[2]),d.push(e[3]),d.push(e[0]),d.push(e[1]),d.push(e[3])}let E=n.P.Zero(),_=new n.P(0,1,0);for(t=0;t<=T.h;t++)for(r=0,E.z=t*(s-i)/T.h+i;r<=T.w;r++)E.x=r*(a-e)/T.w+e,E.y=0,R.push(E.x,E.y,E.z),A.push(_.x,_.y,_.z),c.push(r/T.w,t/T.h)}(o+a*h.w,l+i*h.h,o+(a+1)*h.w,l+(i+1)*h.h);let p=new s.x;return p.indices=d,p.positions=R,p.normals=A,p.uvs=c,p}function R(e){let t,r,a=[],o=[],l=[],E=[],u=e.colorFilter||new i.Wo(.3,.59,.11),T=e.alphaFilter||0,d=!1;if(e.minHeight>e.maxHeight){d=!0;let t=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=t}for(t=0;t<=e.subdivisions;t++)for(r=0;r<=e.subdivisions;r++){let i=new n.P(r*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),a=(((i.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(i.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth)*4,s=e.buffer[a]/255,R=e.buffer[a+1]/255,A=e.buffer[a+2]/255,c=e.buffer[a+3]/255;d&&(s=1-s,R=1-R,A=1-A);let h=s*u.r+R*u.g+A*u.b;c>=T?i.y=e.minHeight+(e.maxHeight-e.minHeight)*h:i.y=e.minHeight-_.kn,e.heightBuffer&&(e.heightBuffer[t*(e.subdivisions+1)+r]=i.y),o.push(i.x,i.y,i.z),l.push(0,0,0),E.push(r/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(r=0;r<e.subdivisions;r++){let n=r+1+(t+1)*(e.subdivisions+1),i=r+1+t*(e.subdivisions+1),s=r+t*(e.subdivisions+1),l=r+(t+1)*(e.subdivisions+1),E=o[3*n+1]>=e.minHeight,_=o[3*i+1]>=e.minHeight,u=o[3*s+1]>=e.minHeight;E&&_&&u&&(a.push(n),a.push(i),a.push(s)),o[3*l+1]>=e.minHeight&&E&&u&&(a.push(l),a.push(n),a.push(s))}s.x.ComputeNormals(o,a,l);let R=new s.x;return R.indices=a,R.positions=o,R.normals=l,R.uvs=E,R}function A(e,t={},r){let n=new o.E(e,r);return n._setReady(!1),n._subdivisionsX=t.subdivisionsX||t.subdivisions||1,n._subdivisionsY=t.subdivisionsY||t.subdivisions||1,n._width=t.width||1,n._height=t.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,T(t).applyToMesh(n,t.updatable),n._setReady(!0),n}function c(e,t,r=null){let n=new a.Kj(e,r);return d(t).applyToMesh(n,t.updatable),n}function h(e,t,r={},n=null){let a,s=r.width||10,_=r.height||10,u=r.subdivisions||1,T=r.minHeight||0,d=r.maxHeight||1,A=r.colorFilter||new i.Wo(.3,.59,.11),c=r.alphaFilter||0,p=r.updatable,g=r.onReady;n=n||E.l.LastCreatedScene;let f=new o.E(e,n);f._subdivisionsX=u,f._subdivisionsY=u,f._width=s,f._height=_,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),r.passHeightBufferInCallback&&(a=new Float32Array((u+1)*(u+1)));let S=(e,t,r)=>{R({width:s,height:_,subdivisions:u,minHeight:T,maxHeight:d,colorFilter:A,buffer:e,bufferWidth:t,bufferHeight:r,alphaFilter:c,heightBuffer:a}).applyToMesh(f,p),g&&g(f,a),f._setReady(!0)};return"string"==typeof t?l.w1.LoadImage(t,e=>{let t=e.width,r=e.height;n.isDisposed||S(n?.getEngine().resizeImageBitmap(e,t,r),t,r)},r.onError?r.onError:()=>{},n.offlineProvider):S(t.data,t.width,t.height),f}let p={CreateGround:A,CreateGroundFromHeightMap:h,CreateTiledGround:c};s.x.CreateGround=T,s.x.CreateTiledGround=d,s.x.CreateGroundFromHeightMap=R,a.Kj.CreateGround=(e,t,r,n,i,a)=>A(e,{width:t,height:r,subdivisions:n,updatable:a},i),a.Kj.CreateTiledGround=(e,t,r,n,i,a,s,o,l)=>c(e,{xmin:t,zmin:r,xmax:n,zmax:i,subdivisions:a,precision:s,updatable:l},o),a.Kj.CreateGroundFromHeightMap=(e,t,r,n,i,a,s,o,l,E,_)=>h(e,t,{width:r,height:n,subdivisions:i,minHeight:a,maxHeight:s,updatable:l,onReady:E,alphaFilter:_},o)},7521:function(e,t,r){let n;r.r(t),r.d(t,{Dispose:()=>d,DumpData:()=>T,DumpDataAsync:()=>u,DumpFramebuffer:()=>_,DumpTools:()=>R});var i=r(79268),a=r(60892),s=r(68645),o=r(66395);let l=null;async function E(){return l||(l=new Promise((e,t)=>{let a,s=null,l={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(r.bind(r,81171)).then(({ThinEngine:E})=>{let _=o.l.Instances.length;try{a=new OffscreenCanvas(100,100),s=new E(a,!1,l)}catch(e){_<o.l.Instances.length&&o.l.Instances.pop()?.dispose(),s=new E(a=document.createElement("canvas"),!1,l)}o.l.Instances.pop(),o.l.OnEnginesDisposedObservable.add(e=>{s&&e!==s&&!s.isDisposed&&0===o.l.Instances.length&&d()}),s.getCaps().parallelShaderCompile=void 0;let u=new i.I(s);r.e("5970").then(r.bind(r,80364)).then(({passPixelShader:r})=>{if(!s)return void t("Engine is not defined");let o=new i.H({engine:s,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});e(n={canvas:a,engine:s,renderer:u,wrapper:o})})}).catch(t)})),await l}async function _(e,t,r,n,i="image/png",a,s){let o=new Uint8Array((await r.readPixels(0,0,e,t)).buffer);T(e,t,o,n,i,a,!0,void 0,s)}function u(e,t,r,n="image/png",i,a=!1,s=!1,o){return new Promise(l=>{T(e,t,r,e=>l(e),n,i,a,s,o)})}function T(e,t,r,n,i="image/png",o,l=!1,_=!1,u){E().then(E=>{if(E.engine.setSize(e,t,!0),r instanceof Float32Array){let e=new Uint8Array(r.length),t=r.length;for(;t--;){let n=r[t];e[t]=Math.round(255*(0,s.Clamp)(n))}r=e}let T=E.engine.createRawTexture(r,e,t,5,!1,!l,1);E.renderer.setViewport(),E.renderer.applyEffectWrapper(E.wrapper),E.wrapper.effect._bindTexture("textureSampler",T),E.renderer.draw(),_?a.w1.ToBlob(E.canvas,e=>{let t=new FileReader;t.onload=e=>{let t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)},i,u):a.w1.EncodeScreenshotCanvasData(E.canvas,n,i,o,u),T.dispose()})}function d(){n?(n.wrapper.dispose(),n.renderer.dispose(),n.engine.dispose()):l?.then(e=>{e.wrapper.dispose(),e.renderer.dispose(),e.engine.dispose()}),l=null,n=null}let R={DumpData:T,DumpDataAsync:u,DumpFramebuffer:_,Dispose:d};a.w1.DumpData=T,a.w1.DumpDataAsync=u,a.w1.DumpFramebuffer=_},4592:function(e,t,r){r.d(t,{D0:()=>N,En:()=>f,Lf:()=>M,QH:()=>h,Ro:()=>O,hO:()=>S,oJ:()=>I,p6:()=>p,qC:()=>m,qJ:()=>c,qh:()=>C});var n=r(60892),i=r(51971),a=r(68645),s=r(74262),o=r(10967),l=r(41583),E=r(3895),_=r(88970),u=r(92550),T=r(52386),d=r(7521);r(24229);let R="image/png",A=[134,22,135,150,246,214,150,54];function c(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=0;for(let e=0;e<A.length;e++)if(t.getUint8(r++)!==A[e])return u.Y.Error("Not a babylon environment map"),null;let n="",i=0;for(;i=t.getUint8(r++);)n+=String.fromCharCode(i);let a=JSON.parse(n);return(a=h(a)).binaryDataPosition=r,a.specular&&(a.specular.lodGenerationScale=a.specular.lodGenerationScale||.8),a}function h(e){if(e.version>2)throw Error(`Unsupported babylon environment map version "${e.version}". Latest supported version is "2".`);return 2===e.version?e:e={...e,version:2,imageType:R}}async function p(e,t={}){let r=e.getInternalTexture();if(!r)return Promise.reject("The cube texture is invalid.");let n=r.getEngine();if(2!==e.textureType&&1!==e.textureType&&0!==e.textureType&&0!==e.textureType&&7!==e.textureType&&-1!==e.textureType)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");let i=1;if(!n.getCaps().textureFloatRender&&(i=2,!n.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");e.sphericalPolynomial;let s=e.getInternalTexture()?._sphericalPolynomialPromise,o=r.width,l=new E.x(n),_={},u={};n.flushFramebuffer();let T=t.imageType??R,d=(0,a.ILog2)(r.width);for(let r=0;r<=d;r++){let n=Math.pow(2,d-r);for(let a=0;a<6;a++)_[6*r+a]=await g(l,e,i,a,r,n,T,t.imageQuality)}let c=t.disableIrradianceTexture?null:e.irradianceTexture;if(c){let e=c.getSize().width;for(let r=0;r<6;r++)u[r]=await g(l,c,i,r,0,e,T,t.imageQuality)}l.dispose(),s&&await s;let h={version:2,width:o,imageType:T,irradiance:function(e){let t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}}(e),specular:{mipmaps:[],lodGenerationScale:e.lodGenerationScale}},f=0;for(let e=0;e<=d;e++)for(let t=0;t<6;t++){let r=_[6*e+t].byteLength;h.specular.mipmaps.push({length:r,position:f}),f+=r}if(c){h.irradiance=h.irradiance||{x:[0,0,0],xx:[0,0,0],y:[0,0,0],yy:[0,0,0],z:[0,0,0],zz:[0,0,0],yz:[0,0,0],zx:[0,0,0],xy:[0,0,0]},h.irradiance.irradianceTexture={size:c.getSize().width,faces:[]};for(let e=0;e<6;e++){let t=u[e].byteLength;h.irradiance.irradianceTexture.faces.push({length:t,position:f}),f+=t}}let S=JSON.stringify(h),O=new ArrayBuffer(S.length+1),L=new Uint8Array(O);for(let e=0,t=S.length;e<t;e++)L[e]=S.charCodeAt(e);L[S.length]=0;let I=new ArrayBuffer(A.length+f+O.byteLength),N=new Uint8Array(I),P=new DataView(I),m=0;for(let e=0;e<A.length;e++)P.setUint8(m++,A[e]);N.set(new Uint8Array(O),m),m+=O.byteLength;for(let e=0;e<=d;e++)for(let t=0;t<6;t++){let r=_[6*e+t];N.set(new Uint8Array(r),m),m+=r.byteLength}if(c)for(let e=0;e<6;e++){let t=u[e];N.set(new Uint8Array(t),m),m+=t.byteLength}return I}async function g(e,t,r,n,i,a,s,o){let l=await t.readPixels(n,i,void 0,!1);if(l&&l.byteLength===l.length){let e=new Float32Array(4*l.byteLength);for(let t=0;t<l.byteLength;t++)e[t]=l[t]/255,e[t]=Math.pow(e[t],2.2);l=e}else if(l&&t.gammaSpace){let e=l;for(let t=0;t<e.length;t++)e[t]=Math.pow(e[t],2.2)}let E=e.getEngine(),_=E.createRawTexture(l,a,a,5,!1,!0,1,null,r);await T.r.EncodeTextureToRGBD(_,e,r);let u=await E._readTexturePixels(_,a,a),R=await (0,d.DumpDataAsync)(a,a,u,s,void 0,!1,!0,o);return _.dispose(),R}function f(e,t){let r=(t=h(t)).specular,n=Math.log2(t.width);if(n=Math.round(n)+1,r.mipmaps.length!==6*n)throw Error(`Unsupported specular mipmaps number "${r.mipmaps.length}"`);let i=Array(n);for(let a=0;a<n;a++){i[a]=Array(6);for(let n=0;n<6;n++){let s=r.mipmaps[6*a+n];i[a][n]=new Uint8Array(e.buffer,e.byteOffset+t.binaryDataPosition+s.position,s.length)}}return i}function S(e,t){t=h(t);let r=Array(6),n=t.irradiance?.irradianceTexture;if(n){if(6!==n.faces.length)throw Error(`Incorrect irradiance texture faces number "${n.faces.length}"`);for(let i=0;i<6;i++){let a=n.faces[i];r[i]=new Uint8Array(e.buffer,e.byteOffset+t.binaryDataPosition+a.position,a.length)}}return r}function O(e,t,r){let n=(r=h(r)).specular;if(!n)return Promise.resolve([]);e._lodGenerationScale=n.lodGenerationScale;let i=[],a=f(t,r);i.push(I(e,a,r.imageType));let s=r.irradiance?.irradianceTexture;if(s){let n=S(t,r);i.push(N(e,n,s.size,r.imageType))}return Promise.all(i)}function L(e,t,r,n,i,a,s,o,l,E,_){return new Promise((u,T)=>{if(r){let r=t.createTexture(null,!0,!0,null,1,null,e=>{T(e)},e);n?.onEffectCreatedObservable.addOnce(o=>{o.executeWhenCompiled(()=>{n.externalTextureSamplerBinding=!0,n.onApply=n=>{n._bindTexture("textureSampler",r),n.setFloat2("scale",1,t._features.needsInvertingBitmap&&e instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([n],E,!0,a,s),t.restoreDefaultFramebuffer(),r.dispose(),URL.revokeObjectURL(i),u())})})}else{if(t._uploadImageToTexture(_,e,a,s),o){let r=l[s];r&&t._uploadImageToTexture(r._texture,e,a,0)}u()}})}async function I(e,t,r=R){let n=e.getEngine();e.format=5,e.type=0,e.generateMipMaps=!0,e._cachedAnisotropicFilteringLevel=null,n.updateTextureSamplingMode(3,e),await P(e,t,!0,r),e.isReady=!0}async function N(e,t,r,n=R){let i=e.getEngine(),a=new o.l(i,5);e._irradianceTexture=new l.V(i,a),a.isCube=!0,a.format=5,a.type=0,a.generateMipMaps=!0,a._cachedAnisotropicFilteringLevel=null,a.generateMipMaps=!0,a.width=r,a.height=r,i.updateTextureSamplingMode(3,a),await P(a,[t],!1,n),i.generateMipMapsForCubemap(a),a.isReady=!0}async function P(e,t,i,s=R){if(!n.w1.IsExponentOfTwo(e.width))throw Error("Texture size must be a power of two");let E=(0,a.ILog2)(e.width)+1,u=e.getEngine(),T=!1,d=!1,A=null,c=null,h=null,p=u.getCaps();p.textureLOD?u._features.supportRenderAndCopyToLodForFloatTextures?p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(T=!0,e.type=2):p.textureFloatRender&&p.textureFloatLinearFiltering&&(T=!0,e.type=1):T=!1:(T=!1,d=i);let g=0;if(T)u.isWebGPU?(g=1,await r.e("7908").then(r.bind(r,50850))):await r.e("354").then(r.bind(r,97525)),A=new _.D("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,e.type,void 0,null,!1,void 0,g),e._isRGBD=!1,e.invertY=!1,c=u.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:e.type,format:5});else if(e._isRGBD=!0,e.invertY=!0,d){h={};let t=e._lodGenerationScale,r=e._lodGenerationOffset;for(let n=0;n<3;n++){let i=(E-1)*t+r,a=Math.round(Math.min(Math.max(r+(i-r)*(1-n/2),0),i)),s=new o.l(u,2);s.isCube=!0,s.invertY=!0,s.generateMipMaps=!1,u.updateTextureSamplingMode(2,s);let _=new l.V(null);switch(_._isCube=!0,_._texture=s,h[a]=_,n){case 0:e._lodTextureLow=_;break;case 1:e._lodTextureMid=_;break;case 2:e._lodTextureHigh=_}}}let f=[];for(let r=0;r<t.length;r++)for(let n=0;n<6;n++){let i,a=new Blob([t[r][n]],{type:s}),o=URL.createObjectURL(a);if(u._features.forceBitmapOverHTMLImageElement)i=u.createImageBitmap(a,{premultiplyAlpha:"none"}).then(t=>L(t,u,T,A,o,n,r,d,h,c,e));else{let t=new Image;t.src=o,i=new Promise((i,a)=>{t.onload=()=>{L(t,u,T,A,o,n,r,d,h,c,e).then(()=>i()).catch(e=>{a(e)})},t.onerror=e=>{a(e)}})}f.push(i)}if(await Promise.all(f),t.length<E){let r,n=Math.pow(2,E-1-t.length),i=n*n*4;switch(e.type){case 0:r=new Uint8Array(i);break;case 2:r=new Uint16Array(i);break;case 1:r=new Float32Array(i)}for(let n=t.length;n<E;n++)for(let t=0;t<6;t++)u._uploadArrayBufferViewToTexture(c?.texture||e,r,t,n)}if(c){let t=e._irradianceTexture;e._irradianceTexture=null,u._releaseTexture(e),c._swapAndDie(e),e._irradianceTexture=t}A&&A.dispose(),d&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))}function m(e,t){let r=(t=h(t)).irradiance;if(!r)return;let n=new s.i;i.P.FromArrayToRef(r.x,0,n.x),i.P.FromArrayToRef(r.y,0,n.y),i.P.FromArrayToRef(r.z,0,n.z),i.P.FromArrayToRef(r.xx,0,n.xx),i.P.FromArrayToRef(r.yy,0,n.yy),i.P.FromArrayToRef(r.zz,0,n.zz),i.P.FromArrayToRef(r.yz,0,n.yz),i.P.FromArrayToRef(r.zx,0,n.zx),i.P.FromArrayToRef(r.xy,0,n.xy),e._sphericalPolynomial=n}function M(e,t,r,n,i){let a=I(e.getEngine().createRawCubeTexture(null,e.width,e.format,e.type,e.generateMipMaps,e.invertY,e.samplingMode,e._compression),t).then(()=>e);return e.onRebuildCallback=e=>({proxy:a,isReady:!0,isAsync:!0}),e._source=13,e._bufferViewArrayArray=t,e._lodGenerationScale=n,e._lodGenerationOffset=i,e._sphericalPolynomial=r,I(e,t).then(()=>(e.isReady=!0,e))}let C={GetEnvInfo:c,CreateEnvTextureAsync:p,CreateRadianceImageDataArrayBufferViews:f,CreateIrradianceImageDataArrayBufferViews:S,UploadEnvLevelsAsync:O,UploadRadianceLevelsAsync:I,UploadIrradianceLevelsAsync:N,UploadEnvSpherical:m}},92550:function(e,t,r){r.d(t,{Y:()=>n});class n{static _CheckLimit(e,t){let r=n._LogLimitOutputs[e];return r?r.current++:(r={limit:t,current:1},n._LogLimitOutputs[e]=r),r.current<=r.limit}static _GenerateLimitMessage(e,t=1){let r=n._LogLimitOutputs[e];if(!r||!n.MessageLimitReached)return;let i=this._Levels[t];r.current===r.limit&&n[i.name](n.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,i.name??""))}static _AddLogEntry(e){n._LogCache=e+n._LogCache,n.OnNewCacheEntry&&n.OnNewCacheEntry(e)}static _FormatMessage(e){let t=e=>e<10?"0"+e:""+e,r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e}static _LogDisabled(e,t){}static _LogEnabled(e=1,t,r){let i=Array.isArray(t)?t[0]:t;if(void 0!==r&&!n._CheckLimit(i,r))return;let a=n._FormatMessage(i),s=this._Levels[e],o=Array.isArray(t)?t.slice(1):[];s.logFunc&&s.logFunc("BJS - "+a,...o);let l=`<div style='color:${s.color}'>${a}</div><br>`;n._AddLogEntry(l),n._GenerateLimitMessage(i,e)}static get LogCache(){return n._LogCache}static ClearLogCache(){n._LogCache="",n._LogLimitOutputs={},n.errorsCount=0}static set LogLevels(e){for(let t of(n.Log=n._LogDisabled,n.Warn=n._LogDisabled,n.Error=n._LogDisabled,[n.MessageLogLevel,n.WarningLogLevel,n.ErrorLogLevel]))(e&t)===t&&(n[this._Levels[t].name]=n._LogEnabled.bind(n,t))}}n.NoneLogLevel=0,n.MessageLogLevel=1,n.WarningLogLevel=2,n.ErrorLogLevel=4,n.AllLogLevel=7,n.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",n._LogCache="",n._LogLimitOutputs={},n._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],n.errorsCount=0,n.Log=n._LogEnabled.bind(n,n.MessageLogLevel),n.Warn=n._LogEnabled.bind(n,n.WarningLogLevel),n.Error=n._LogEnabled.bind(n,n.ErrorLogLevel)},22465:function(e,t,r){r.d(t,{MK:()=>d,Th:()=>A,mE:()=>c,n4:()=>p,ng:()=>R,qB:()=>T});var n=r(13405),i=r(37433),a=r(88254),s=r(92550),o=r(60892),l=r(7521),E=r(85975),_=r(28118);let u=null;function T(e,t,r,n,i="image/png",a=!1,l,E=!1){let{height:_,width:d}=h(e,t,r);return _&&d?t.getScene().activeCamera!==t?void A(e,t,r,e=>{if(a){let t=new Blob([e]);o.w1.DownloadBlob(t),n&&n("")}else n&&n(e)},i,1,e.getCreationOptions().antialias,void 0,void 0,void 0,void 0,l):void e.onEndFrameObservable.addOnce(()=>{u||(u=document.createElement("canvas")),u.width=d,u.height=_;let t=u.getContext("2d"),r=e.getRenderingCanvas();if(!t||!r)return void s.Y.Error("Failed to create screenshot. Rendering context or rendering canvas is not available.");let T=r.width,R=r.height,A=u.width,c=u.height,h=A/T,p=c/R,g=E?Math.max(h,p):Math.min(h,p),f=T*g,S=R*g;t.drawImage(r,0,0,T,R,(A-f)/2,(c-S)/2,f,S),a?(o.w1.EncodeScreenshotCanvasData(u,void 0,i,void 0,l),n&&n("")):o.w1.EncodeScreenshotCanvasData(u,n,i,void 0,l)}):void s.Y.Error("Invalid 'size' parameter !")}function d(e,t,r,n="image/png",i,a=!1){return new Promise((s,o)=>{T(e,t,r,e=>{void 0!==e?s(e):o(Error("Data is undefined"))},n,void 0,i,a)})}function R(e,t,r,n,i="image/png",a,s=!1){return new Promise(o=>{T(e,t,{width:r,height:n},()=>{o()},i,!0,a,s)})}function A(e,t,o,u,T="image/png",d=1,R=!1,c,p=!1,g=!1,f=!0,S,O,L){let{height:I,width:N,finalWidth:P,finalHeight:m}=h(e,t,o);if(!(I&&N))return void s.Y.Error("Invalid 'size' parameter !");e.skipFrameRender=!0;let M=e.getRenderWidth,C=e.getRenderHeight;e.getRenderWidth=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.width:N,e.getRenderHeight=(t=!1)=>!t&&e._currentRenderTarget?e._currentRenderTarget.height:I,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e);let U=t.getScene(),x=new i._("screenShot",{width:N,height:I},U,!1,!1,0,!1,n.x.BILINEAR_SAMPLINGMODE,void 0,g,void 0,void 0,void 0,d);x.renderList=U.meshes.slice(),x.samples=d,x.renderSprites=p,x.activeCamera=t,x.forceLayerMaskCheck=f,O?.(x);let D=L||l.DumpData,w=()=>{(0,_.r)(()=>x.isReadyForRendering()&&t.isReady(!0),()=>{e.onEndFrameObservable.addOnce(()=>{P===N&&m===I?x.readPixels(void 0,void 0,void 0,!1).then(e=>{D(N,I,e,u,T,c,!0,void 0,S),x.dispose()}):(e.isWebGPU?r.e("4010").then(r.bind(r,16893)):r.e("5970").then(r.bind(r,80364))).then(()=>(0,E.$0)("pass",x.getInternalTexture(),U,void 0,void 0,void 0,P,m).then(t=>{e._readTexturePixels(t,P,m,-1,0,null,!0,!1,0,0).then(e=>{D(P,m,e,u,T,c,!0,void 0,S),t.dispose()})}))}),U.incrementRenderId(),U.resetCachedMaterial();let n=U.activeCamera,i=U.activeCameras,a=t.outputRenderTarget,s=U.spritesEnabled;U.activeCamera=t,U.activeCameras=null,t.outputRenderTarget=x,U.spritesEnabled=p;let o=U.meshes;U.meshes=x.renderList||U.meshes;try{U.render()}finally{U.activeCamera=n,U.activeCameras=i,t.outputRenderTarget=a,U.spritesEnabled=s,U.meshes=o,e.getRenderWidth=M,e.getRenderHeight=C,e.onResizeObservable.hasObservers()&&e.onResizeObservable.notifyObservers(e),t.getProjectionMatrix(!0),e.skipFrameRender=!1}},()=>{e.skipFrameRender=!1,e.getRenderWidth=M,e.getRenderHeight=C})},y=()=>{U.incrementRenderId(),U.resetCachedMaterial(),w()};if(R){let e=new a.P("antialiasing",1,U.activeCamera);x.addPostProcess(e),e.onEffectCreatedObservable.addOnce(e=>{e.isReady()?y():e.onCompiled=()=>{y()}})}else y()}function c(e,t,r,n="image/png",i=1,a=!1,s,o=!1,l=!1,E=!0,_,u,T){return new Promise((d,R)=>{A(e,t,r,e=>{void 0!==e?d(e):R(Error("Data is undefined"))},n,i,a,s,o,l,E,_,u,T)})}function h(e,t,r){let n=0,i=0,a=0,s=0;if("object"==typeof r){let o=r.precision?Math.abs(r.precision):1;r.width&&r.height?(n=r.height*o,i=r.width*o):r.width&&!r.height?n=Math.round((i=r.width*o)/e.getAspectRatio(t)):r.height&&!r.width?i=Math.round((n=r.height*o)*e.getAspectRatio(t)):n=Math.round((i=Math.round(e.getRenderWidth()*o))/e.getAspectRatio(t)),r.finalWidth&&r.finalHeight?(s=r.finalHeight,a=r.finalWidth):r.finalWidth&&!r.finalHeight?s=Math.round((a=r.finalWidth)/e.getAspectRatio(t)):r.finalHeight&&!r.finalWidth?a=Math.round((s=r.finalHeight)*e.getAspectRatio(t)):(a=i,s=n)}else isNaN(r)||(n=r,i=r,a=r,s=r);return i&&(i=Math.floor(i)),n&&(n=Math.floor(n)),a&&(a=Math.floor(a)),s&&(s=Math.floor(s)),{height:0|n,width:0|i,finalWidth:0|a,finalHeight:0|s}}let p={CreateScreenshot:T,CreateScreenshotAsync:d,CreateScreenshotWithResizeAsync:R,CreateScreenshotUsingRenderTarget:A,CreateScreenshotUsingRenderTargetAsync:c};o.w1.CreateScreenshot=T,o.w1.CreateScreenshotAsync=d,o.w1.CreateScreenshotUsingRenderTarget=A,o.w1.CreateScreenshotUsingRenderTargetAsync=c},85975:function(e,t,r){let n,i;r.d(t,{$0:()=>_,Oi:()=>A,ay:()=>u,cW:()=>E,qZ:()=>T,yl:()=>R});var a=r(13405),s=r(37433),o=r(4444),l=r(88970);function E(e,t,r,n=!0){let i=e.getScene(),l=i.getEngine(),_=new s._("resized"+e.name,{width:t,height:r},i,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);_.wrapU=e.wrapU,_.wrapV=e.wrapV,_.uOffset=e.uOffset,_.vOffset=e.vOffset,_.uScale=e.uScale,_.vScale=e.vScale,_.uAng=e.uAng,_.vAng=e.vAng,_.wAng=e.wAng,_.coordinatesIndex=e.coordinatesIndex,_.level=e.level,_.anisotropicFilteringLevel=e.anisotropicFilteringLevel,_._texture.isReady=!1,e.wrapU=a.x.CLAMP_ADDRESSMODE,e.wrapV=a.x.CLAMP_ADDRESSMODE;let u=new o.Q("pass",1,null,n?a.x.BILINEAR_SAMPLINGMODE:a.x.NEAREST_SAMPLINGMODE,l,!1,0);return u.externalTextureSamplerBinding=!0,u.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{u.onApply=function(t){t.setTexture("textureSampler",e)};let t=_.renderTarget;t&&(i.postProcessManager.directRender([u],t),l.unBindFramebuffer(t),_.disposeFramebufferObjects(),u.dispose(),_.getInternalTexture().isReady=!0)})}),_}function _(e,t,r,n,i,a,s,o){let E=t.getEngine();return t.isReady=!1,i=i??t.samplingMode,n=n??t.type,a=a??t.format,s=s??t.width,o=o??t.height,-1===n&&(n=0),new Promise(_=>{let u=new l.D("postprocess",e,null,null,1,null,i,E,!1,void 0,n,void 0,null,!1,a);u.externalTextureSamplerBinding=!0;let T=E.createRenderTargetTexture({width:s,height:o},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i,type:n,format:a});u.onEffectCreatedObservable.addOnce(e=>{e.executeWhenCompiled(()=>{u.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},r.postProcessManager.directRender([u],T,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(t),u&&u.dispose(),T._swapAndDie(t),t.type=n,t.format=5,t.isReady=!0,_(t)})})})}function u(e){n||(i=new Int32Array((n=new Float32Array(1)).buffer)),n[0]=e;let t=i[0],r=t>>16&32768,a=t>>12&2047,s=t>>23&255;return s<103?r:s>142?(r|=31744,r|=+(255!=s)&&8388607&t):s<113?(a|=2048,r|=(a>>114-s)+(a>>113-s&1)):(r|=s-112<<10|a>>1,r+=1&a)}function T(e){let t=(32768&e)>>15,r=(31744&e)>>10,n=1023&e;return 0===r?(t?-1:1)*6103515625e-14*(n/1024):31==r?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+n/1024)}let d=async(e,t,n,i,o)=>{let E,_=e.getScene(),u=_.getEngine();u.isWebGPU?e.isCube?await r.e("3012").then(r.bind(r,61381)):await r.e("6876").then(r.bind(r,54548)):e.isCube?await r.e("2166").then(r.bind(r,15)):await r.e("6546").then(r.bind(r,60896)),E=e.isCube?new l.D("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:a.x.NEAREST_NEAREST_MIPNEAREST,engine:u,defines:["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"][i],shaderLanguage:+!!u.isWebGPU}):new l.D("lod","lod",{uniforms:["lod","gamma"],samplingMode:a.x.NEAREST_NEAREST_MIPNEAREST,engine:u,shaderLanguage:+!!u.isWebGPU}),await new Promise(e=>{E.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{e(0)})})});let T=new s._("temp",{width:t,height:n},_,!1);E.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",o),t.setInt("gamma",+!!e.gammaSpace)};let d=e.getInternalTexture();try{if(T.renderTarget&&d){let r=d.samplingMode;0!==o?e.updateSamplingMode(a.x.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(a.x.NEAREST_NEAREST),_.postProcessManager.directRender([E],T.renderTarget,!0),e.updateSamplingMode(r);let i=await u.readPixels(0,0,t,n),s=new Uint8Array(i.buffer,0,i.byteLength);return u.unBindFramebuffer(T.renderTarget),s}throw Error("Render to texture failed.")}finally{T.dispose(),E.dispose()}};async function R(e,t,r,n=0,i=0){return!e.isReady()&&e._texture&&await new Promise((t,r)=>{if(null===e._texture)return void r(0);e._texture.onLoadedObservable.addOnce(()=>{t(0)})}),await d(e,t,r,n,i)}let A={CreateResizedCopy:E,ApplyPostProcess:_,ToHalfFloat:u,FromHalfFloat:T,GetTextureDataAsync:R}}}]);