/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["8977"],{14280:function(e,t,n){n.d(t,{Iu:()=>s,QB:()=>v,Sf:()=>c,Sl:()=>m,U1:()=>u,XT:()=>o,cs:()=>h,fx:()=>g,gM:()=>f,jw:()=>l,nA:()=>d,tW:()=>y});var r=n(84081),i=n(61834),a=n(42933);function s(e,t){e.setAbsolutePosition(e.getAbsolutePosition().add(t)),e.computeWorldMatrix(!0)}function o(e,t,n,r){e.rotateAround(t,n,r),e.computeWorldMatrix(!0)}function u(e,t,n){e.rotate(t,n,r.T.WORLD)}function l(e){if(null===e.rotationQuaternion)throw Error("Null quaternion for ".concat(e.name));return e.rotationQuaternion}function c(e,t){e.rotationQuaternion=t,e.computeWorldMatrix(!0)}function d(e,t){if(!t.equalsWithEpsilon(e.up,1e-7)){var n=e.up;u(e,i.P.Cross(t,n),-Math.acos(i.P.Dot(t,n)))}}function h(e){return e.getDirection(a.F.FORWARD)}function f(e){return e.getDirection(a.F.UP)}function v(e){return p(e).negate()}function p(e){return e.getDirection(a.F.LEFT)}function m(e,t){u(e,h(e),t)}function y(e,t){u(e,p(e),t)}function g(e,t){u(e,f(e),t)}},24542:function(e,t,n){n.d(t,{d:()=>tl}),n(80781),n(10425),n(99876);var r,i=n(20534),a=n(1167),s=n(71777),o=n(61834),u=n(70541),l=n(95603),c=n(24919),d=n(72392),h=n(87158),f=n(46060),v=n(89963),p=n(32133),m=n(43366),y=n(67144),g=n(76103),b=n(31872),S=n(50137),w=n(92099),P=n(73303);n(78683),n(95698);var E=n(95212);let T=n.p+"17af999e7b7ad57f.mp3",C=n.p+"041ff9a253ed825d.mp3",A=n.p+"1549759e283bd206.ogg",O=n.p+"31e17b20ef567c2c.ogg",M=n.p+"39989db1f505d453.ogg",L=n.p+"d0fafb23c7d554d6.mp3",I=n.p+"e681fd4fea79fa37.ogg",k=n.p+"2a8bc67628c05fba.ogg",V=n.p+"1814b3aace9cf589.ogg",R=n.p+"bf4b326c5ffca2bb.mp3",D=n.p+"368a319571c58001.ogg",x=n.p+"c1c5397b26a6c809.ogg",N=n.p+"920dd9f7b92185e2.ogg";function B(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}let _=n.p+"a77f60b1dade8fb8.mp3",U=n.p+"2344fdde5c5a6410.mp3",j=n.p+"a5a4982c205e1a77.mp3",W=n.p+"452710f264d2ba19.mp3",F=n.p+"305475735c5d3c0e.mp3",G=n.p+"65ceacf6bbb524ce.mp3",z=n.p+"5f6f5bf7bfca113e.mp3",Z=n.p+"4884a61f606c46b6.mp3",q=n.p+"414af932bdf1a85c.mp3",X=n.p+"9bbc526876e8d7f3.mp3",H=n.p+"4c543ebfed7579a0.mp3",Y=n.p+"dea0682c68132870.mp3";function Q(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}let $=n.p+"d03a87f2075d6f53.mp3",J=n.p+"02b9b418f00b21c6.mp3",K=n.p+"cd82c2ed886f9749.mp3",ee=n.p+"5d862e8381583459.mp3",et=n.p+"c83251e2246e7d88.mp3",en=n.p+"64c7906a8f900679.mp3",er=n.p+"2da6813008740281.mp3",ei=n.p+"b3ce59bafdbe5a25.mp3",ea=n.p+"cb1faa14ee3af51b.mp3",es=n.p+"398d2c8156e90ba6.mp3",eo=n.p+"03f6eca0cfdf0539.mp3";function eu(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function el(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}var ec=n(1858);function ed(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}var eh=n(72067),ef=n(74913);function ev(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ep=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");ev(this,"currentMusic",null),ev(this,"silenceSeconds",0),ev(this,"volume",1),ev(this,"fadeSeconds",3),ev(this,"pauseMusicWhenPaused",!1),ev(this,"starSystemView",void 0),ev(this,"musics",void 0),this.musics=e,this.starSystemView=n;var i=ef.a.audioEngine;if(null===i)throw Error("Audio context is null");i.onAudioUnlockedObservable.add(function(){if(null!==r.currentMusic){var e=r.currentMusic;r.currentMusic=null,r.setMusic(e)}})}return e=[{key:"setMusicFromSelection",value:function(e){if(!(null!==this.currentMusic&&e.includes(this.currentMusic))){var t=e[Math.floor(Math.random()*e.length)];void 0!==t&&this.setMusic(t)}}},{key:"setMusic",value:function(e){if(this.currentMusic!==e){if(null!==this.currentMusic){this.currentMusic.setVolume(0,this.fadeSeconds),this.currentMusic.stop(this.fadeSeconds),this.currentMusic=null,this.silenceSeconds=this.fadeSeconds;return}null!==e&&(this.currentMusic=e,this.currentMusic.stop(),this.currentMusic.setVolume(0),this.currentMusic.play(),this.currentMusic.setVolume(this.volume,this.fadeSeconds),console.log("currently playing",this.currentMusic.name))}}},{key:"setSoundtrackVolume",value:function(e){this.volume=e,null!==this.currentMusic&&this.currentMusic.setVolume(e)}},{key:"getVolume",value:function(){return this.volume}},{key:"update",value:function(e,t,n,r){if(null!==this.currentMusic){if(e&&this.pauseMusicWhenPaused&&this.currentMusic.isPlaying)return void this.currentMusic.pause();if(!e&&this.currentMusic.isPaused)return void this.currentMusic.play();e||this.currentMusic.isPlaying||(this.currentMusic=null,this.silenceSeconds=30+(Math.random()-.5)*20)}if(this.silenceSeconds>0){this.silenceSeconds-=r;return}if(!this.starSystemView.isLoadingSystem()){var i=this.starSystemView.getSpaceshipControls().getSpaceship(),a=this.starSystemView.scene.getActiveControls()===this.starSystemView.getCharacterControls(),s=this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition(),u=this.starSystemView.getStarSystem().getNearestOrbitalObject(s),l=o.P.Distance(s,u.getTransform().getAbsolutePosition());if(!t||n)return void this.setMusic(this.musics.wandering);if(!i.isLanded()&&null!==i.getTargetLandingPad())return void this.setMusic(this.musics.straussBlueDanube);var c=i.getInternals().getWarpDrive();switch(u.model.type){case b.o.BLACK_HOLE:this.setMusicFromSelection([this.musics.soaring]);return;case b.o.MANDELBULB:case b.o.JULIA_SET:case b.o.MANDELBOX:case b.o.SIERPINSKI_PYRAMID:case b.o.MENGER_SPONGE:case b.o.DARK_KNIGHT:if(l<100*u.getBoundingRadius())return void this.setMusicFromSelection([this.musics.spacialWinds,this.musics.echoesOfTime]);break;case b.o.STAR:case b.o.NEUTRON_STAR:case b.o.TELLURIC_PLANET:case b.o.TELLURIC_SATELLITE:case b.o.GAS_PLANET:case b.o.CUSTOM:break;case b.o.SPACE_STATION:case b.o.SPACE_ELEVATOR:if((null===c||c.isDisabled())&&l<10*u.getBoundingRadius())return void this.setMusic(this.musics.equatorialComplex)}if(null!==c&&c.isEnabled()){var d=[this.musics.atlanteanTwilight,this.musics.infinitePerspective,this.musics.mesmerize];this.setMusicFromSelection(d);return}if(!i.isLanded()&&(null===c||c.isDisabled())){var h=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind];this.setMusicFromSelection(h);return}if(a||i.isLanded()){var f=[this.musics.thatZenMoment,this.musics.deepRelaxation,this.musics.peaceOfMind,this.musics.mesmerize,this.musics.reawakening];this.setMusicFromSelection(f);return}this.setMusic(null)}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),em=n(54530),ey=n(4761),eg=n(55914),eb=n(70620),eS=n(70618),ew=n(74667),eP=n(96775),eE=n(33778),eT=n(68215),eC=n(85791),eA=n(49541),eO=n(90328),eM=n(14280),eL=n(24660),eI=n(32075),ek=n(15589),eV=n(59265),eR=n(43999),eD=n(2607),ex=n(58237),eN=n(52653),eB=n(58672),e_=n(11508),eU=n(12428),ej=n(94117),eW=n(94997),eF=[eg.S,eW.B,eU.v,e_.m,eN.V,eB.H,ej.v],eG=n(30073),ez=n(91307);function eZ(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eq(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function eX(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],s=!0,o=!1;try{for(i=i.call(e);!(s=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){o=!0,r=e}finally{try{s||null==i.return||i.return()}finally{if(o)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return eZ(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eZ(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var eH=n(86950),eY=n(24432),eQ=n(16050),e$=n(31328);function eJ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eK=function e(){var t=this;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");eJ(this,"htmlRoot",void 0),eJ(this,"onTutorialSelected",new eC.y$),eJ(this,"availableTutorials",void 0),this.htmlRoot=document.createElement("div"),this.htmlRoot.classList.add("tutorialsMenuContainer"),this.availableTutorials=[new eH.d,new e$.b,new eQ.D,new eY.L],this.availableTutorials.forEach(function(e){var n=document.createElement("div");n.classList.add("tutorial");var r=document.createElement("h2");r.textContent=e.getTitle(),n.appendChild(r);var i=document.createElement("img");i.src=e.coverImageSrc,i.alt=e.getTitle(),n.appendChild(i);var a=document.createElement("p");a.textContent=e.getDescription(),n.appendChild(a),t.htmlRoot.appendChild(n),n.addEventListener("click",function(){t.onTutorialSelected.notifyObservers(e)})});var n=document.createElement("p");n.classList.add("moreWillCome"),n.textContent=eI.Z.t("tutorials:common:moreWillComeSoon"),this.htmlRoot.appendChild(n)};function e0(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var e1=((r={})[r.LOAD_SAVE=0]="LOAD_SAVE",r[r.SETTINGS=1]="SETTINGS",r[r.TUTORIALS=2]="TUTORIALS",r[r.CONTRIBUTE=3]="CONTRIBUTE",r[r.CREDITS=4]="CREDITS",r[r.ABOUT=5]="ABOUT",r),e2=function(){var e;function t(e,n,r,i){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e0(this,"activeRightPanel",null),e0(this,"loadSavePanel",void 0),e0(this,"loadSavePanelContent",void 0),e0(this,"settingsPanel",void 0),e0(this,"tutorialsPanel",void 0),e0(this,"tutorialsPanelContent",void 0),e0(this,"contributePanel",void 0),e0(this,"creditsPanel",void 0),e0(this,"aboutPanel",void 0),e0(this,"starSystemDatabase",void 0),e0(this,"saveManager",void 0),this.starSystemDatabase=e,this.saveManager=n;var a=document.getElementById("loadSavePanel");if(null===a)throw Error("#loadSavePanel does not exist!");this.loadSavePanel=a,this.attachCloseButton(this.loadSavePanel),this.loadSavePanelContent=new eV.W(e,r),this.loadSavePanel.appendChild(this.loadSavePanelContent.htmlRoot),this.settingsPanel=function(e){var t=document.getElementById("settingsPanel");if(null===t)throw Error("#settings does not exist!");var n=document.createElement("div");n.classList.add("settings-section");var r=document.createElement("h3");r.textContent=eI.Z.t("sidePanel:audioSettings"),r.style.fontFamily="Nasalization, sans-serif",n.appendChild(r);var i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="10px",i.style.fontFamily="Nasalization, sans-serif";var a=document.createElement("label");a.textContent=eI.Z.t("sidePanel:musicVolume"),a.style.fontFamily="Nasalization, sans-serif",a.style.minWidth="80px",a.style.flexGrow="1",a.style.color="#fff",a.style.fontWeight="bold",a.style.letterSpacing="1px",a.style.fontSize="1.1em",i.appendChild(a);var s=document.createElement("input");s.type="range",s.min="0",s.max="1",s.step="0.05",s.value=e.getVolume().toString(),s.style.margin="0 10px",s.style.accentColor="#ffffff";var o=document.createElement("span");return o.textContent=(100*parseFloat(s.value)).toFixed(0)+"%",o.style.fontFamily="Nasalization, sans-serif",o.style.color="#fff",o.style.backgroundColor="#1a1a1a",o.style.padding="2px 8px",o.style.borderRadius="4px",o.style.fontWeight="bold",o.style.fontSize="1em",o.style.marginLeft="4px",o.style.minWidth="50px",o.style.textAlign="center",s.addEventListener("input",function(){var t=parseFloat(s.value);o.textContent=(100*t).toFixed(0)+"%",e.setSoundtrackVolume(t)}),i.appendChild(s),i.appendChild(o),n.appendChild(i),t.appendChild(n),(0,eG.x)().then(function(e){eF.forEach(function(n){var r=document.createElement("div");r.classList.add("map");var i=document.createElement("h3");i.textContent=n.name.replace(/([A-Z])/g," $1").trim(),r.appendChild(i);var a=!0,s=!1,o=void 0;try{for(var u,l=Object.entries(n.map)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0)!function(){var t=eX(u.value,2),n=t[0],i=t[1],a=new Map;(eq(i,eR.Z)?i.bindings:i.action.bindings).forEach(function(t){if(eq(t.control,ex.Z))(0,ez.cs)(t.control,e).forEach(function(e){var t,n=eX(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(eq(t.control,eD.N3)){var n,r=(0,ez.x_)(t.control,e);a.has("BUTTON")||a.set("BUTTON",[]),null==(n=a.get("BUTTON"))||n.push(r)}else if(eq(t.control,eD.LV))(0,ez.C9)(t.control,e).forEach(function(e){var t,n=eX(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(eq(t.control,eD.Z9))(0,ez.JT)(t.control).forEach(function(e){var t,n=eX(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else if(eq(t.control,eD.xE))(0,ez.gG)().forEach(function(e){var t,n=eX(e,2),r=n[0],i=n[1];a.has(r)||a.set(r,[]),null==(t=a.get(r))||t.push(i)});else throw Error("Unknown control type")});var s=document.createElement("div"),o=document.createElement("p");if(o.textContent=n.replace(/([A-Z])/g," $1").trim(),s.appendChild(o),1===a.size){s.classList.add("actionSingle");var l=document.createElement("div");l.classList.add("valuesContainer");var c=!0,d=!1,h=void 0;try{for(var f,v=a.values()[Symbol.iterator]();!(c=(f=v.next()).done);c=!0)f.value.forEach(function(e){var t=document.createElement("p");t.innerText=e,l.appendChild(t)})}catch(e){d=!0,h=e}finally{try{c||null==v.return||v.return()}finally{if(d)throw h}}s.appendChild(l)}else s.classList.add("actionMultiple"),a.forEach(function(e,t){var n=document.createElement("div");n.classList.add("subAction");var r=document.createElement("p");r.textContent=t;var i=document.createElement("div");i.classList.add("valuesContainer"),e.forEach(function(e){var t=document.createElement("p");t.innerText=e,i.appendChild(t)}),n.appendChild(r),n.appendChild(i),s.appendChild(n)});r.appendChild(s)}()}catch(e){s=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw o}}t.appendChild(r)})}),t}(i),this.attachCloseButton(this.settingsPanel);var s=document.getElementById("tutorials");if(null===s)throw Error("#tutorials does not exist!");this.tutorialsPanel=s,this.attachCloseButton(this.tutorialsPanel),this.tutorialsPanelContent=new eK,this.tutorialsPanel.appendChild(this.tutorialsPanelContent.htmlRoot);var o=document.getElementById("contribute");if(null===o)throw Error("#contribute does not exist!");this.contributePanel=o,this.attachCloseButton(this.contributePanel);var u=document.getElementById("credits");if(null===u)throw Error("#credits does not exist!");this.creditsPanel=u,this.attachCloseButton(this.creditsPanel);var l=document.getElementById("about");if(null===l)throw Error("#about does not exist!");this.aboutPanel=l,this.attachCloseButton(this.aboutPanel)}return e=[{key:"panelFromType",value:function(e){var t=null;switch(e){case 0:t=this.loadSavePanel;break;case 1:t=this.settingsPanel;break;case 2:t=this.tutorialsPanel;break;case 3:t=this.contributePanel;break;case 4:t=this.creditsPanel;break;case 5:t=this.aboutPanel}return t}},{key:"attachCloseButton",value:function(e){var t=this;if(!e.querySelector(".close-button")){var n=document.createElement("button");n.innerText="X",n.className="close-button",n.addEventListener("click",function(){t.hideActivePanel()}),e.appendChild(n)}}},{key:"toggleActivePanel",value:function(e){var t=this.panelFromType(e);this.activeRightPanel!==t&&(0===e&&this.loadSavePanelContent.populateCmdrList(this.starSystemDatabase,this.saveManager),null!==this.activeRightPanel&&this.hideActivePanel(),this.activeRightPanel=t,t.classList.add("visible"))}},{key:"hideActivePanel",value:function(){null!==this.activeRightPanel&&(this.activeRightPanel.classList.remove("visible"),this.activeRightPanel=null)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function e3(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function e4(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){e3(a,r,i,s,o,"next",e)}function o(e){e3(a,r,i,s,o,"throw",e)}s(void 0)})}}function e6(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function e5(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var e8=function(){var e;function t(e,n,r,i){var a=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e6(this,"scene",void 0),e6(this,"controls",void 0),e6(this,"starSystemView",void 0),e6(this,"starSystemModel",void 0),e6(this,"onStartObservable",new eC.y$),e6(this,"onContributeObservable",new eC.y$),e6(this,"onCreditsObservable",new eC.y$),e6(this,"onAboutObservable",new eC.y$),e6(this,"htmlRoot",void 0),e6(this,"title",void 0),e6(this,"version",void 0),e6(this,"sidePanels",void 0),e6(this,"universeObjectId",void 0),e6(this,"startAnimationDurationSeconds",5),this.sidePanels=e,this.starSystemView=n,this.scene=this.starSystemView.scene,this.controls=this.starSystemView.getDefaultControls(),this.starSystemView.setUIEnabled(!1);var s=r.getSystemModelFromCoordinates({localX:.49137314641446483,localY:.48043087077347135,localZ:.38353311777279386,starSectorX:0,starSectorY:0,starSectorZ:0});if(null===s)throw Error("Cannot find system");var o=s.planets.at(1);if(void 0===o)throw Error("Cannot find planet with index 2");this.universeObjectId=(0,P.D2)(o,s),this.starSystemModel=s;var u=document.getElementById("mainMenu");if(null===u)throw Error("#mainMenu does not exist!");this.htmlRoot=u,this.htmlRoot.style.display="none";var l=document.querySelector("#mainMenu h1");if(null===l)throw Error("#mainMenu h1 does not exist!");this.title=l;var c=document.getElementById("version");if(null===c)throw Error("#version does not exist!");var d=c.querySelector("a");if(null===d)throw Error("version link does not exist!");d.textContent="Alpha ".concat(ek.i8),this.version=c,document.querySelectorAll("#menuItems li").forEach(function(e){e.addEventListener("mouseenter",function(){i.playNow(em.k6.HOVER)}),e.addEventListener("click",function(){i.playNow(em.k6.CLICK)})}),document.querySelectorAll("#mainMenu *[data-i18n]").forEach(function(e){var t=e.getAttribute("data-i18n");if(null===t)throw Error("data-i18n attribute is null");e.textContent=eI.Z.t(t)});var h=document.getElementById("startButton");if(null===h)throw Error("#startButton does not exist!");h.addEventListener("click",function(){a.startAnimation(function(){return a.onStartObservable.notifyObservers()})});var f=document.getElementById("loadSaveButton");if(null===f)throw Error("#loadSaveButton does not exist!");f.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.LOAD_SAVE)}),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(){a.hide()});var v=document.getElementById("settingsButton");if(null===v)throw Error("#settingsButton does not exist!");v.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.SETTINGS)});var p=document.getElementById("tutorialsButton");if(null===p)throw Error("#tutorialsButton does not exist!");p.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.TUTORIALS)});var m=document.getElementById("contributeButton");if(null===m)throw Error("#contributeButton does not exist!");m.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.CONTRIBUTE),a.onContributeObservable.notifyObservers()});var y=document.getElementById("creditsButton");if(null===y)throw Error("#creditsButton does not exist!");y.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.CREDITS),a.onCreditsObservable.notifyObservers()});var g=document.getElementById("aboutButton");if(null===g)throw Error("#aboutButton does not exist!");g.addEventListener("click",function(){a.sidePanels.toggleActivePanel(e1.ABOUT),a.onAboutObservable.notifyObservers()})}return e=[{key:"init",value:function(){return e4(function(){var e;return e5(this,function(t){switch(t.label){case 0:return e=this,[4,this.starSystemView.loadStarSystem(this.starSystemModel)];case 1:return t.sent(),this.starSystemView.onInitStarSystem.addOnce(function(){return e4(function(){var e,t;return e5(this,function(n){switch(n.label){case 0:return[4,this.starSystemView.switchToDefaultControls(!1)];case 1:if(n.sent(),e=this.starSystemModel.stellarObjects[0].type===b.o.BLACK_HOLE?8:2,void 0===(t=this.starSystemView.getStarSystem().getOrbitalObjectById(this.universeObjectId.idInSystem)))throw Error("Could not find object with ID ".concat(JSON.stringify(this.universeObjectId)));return(0,eL.xM)(this.controls,t,this.starSystemView.getStarSystem(),e),[2]}})}).call(e)}),this.starSystemView.targetCursorLayer.setEnabled(!1),this.htmlRoot.style.display="block",[2]}})}).call(this)}},{key:"startAnimation",value:function(e){var t=this;this.sidePanels.hideActivePanel();var n=this.starSystemView.getStarSystem(),r=(0,eM.cs)(this.controls.getTransform()),i=n.getOrbitalObjectById(this.universeObjectId.idInSystem),a=n.getCelestialBodies().find(function(e){return e===i});if(void 0===a)throw Error("No corresponding celestial body found");var s=a.getTransform().getAbsolutePosition().subtract(this.controls.getTransform().getAbsolutePosition()).normalize(),u=o.P.Cross(r,s),l=o.P.GetAngleBetweenVectors(r,s,u),c=(0,eL._T)(a,n,.9),d=new eA._(this.controls.getTransform(),u,l,this.startAnimationDurationSeconds),h=new eO.J(this.controls.getTransform(),c,this.startAnimationDurationSeconds);this.title.animate([{marginTop:this.title.style.marginTop,opacity:1},{marginTop:"30vh",opacity:0}],{duration:1e3*this.startAnimationDurationSeconds,easing:"ease-in-out",fill:"forwards"});var f=function(){var r=t.scene.getEngine().getDeltaTime()/1e3;if(h.isFinished()||h.update(r),d.isFinished()){t.scene.onBeforePhysicsObservable.removeCallback(f),t.htmlRoot.style.display="none",t.starSystemView.setUIEnabled(!0),e();return}d.update(r),t.controls.getActiveCamera().getViewMatrix(),n.applyFloatingOrigin(),t.starSystemView.postProcessManager.update(0),n.updateShaders(0)};this.scene.onBeforePhysicsObservable.add(f),this.hideMenu(),this.hideVersion()}},{key:"hideVersion",value:function(){this.version.style.transform="translateY(100%)"}},{key:"hideMenu",value:function(){var e=document.getElementById("menuItems");if(null===e)throw Error("#menuItems does not exist!");e.style.left="-20%"}},{key:"hide",value:function(){this.hideVersion(),this.hideMenu(),this.sidePanels.hideActivePanel(),this.htmlRoot.style.display="none"}},{key:"isVisible",value:function(){return"none"!==this.htmlRoot.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),e7=n(67313);function e9(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(){var e;function t(e,n){var r=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e9(this,"rootNode",void 0),e9(this,"mask",void 0),e9(this,"screenshotButton",void 0),e9(this,"shareButton",void 0),e9(this,"contributeButton",void 0),e9(this,"tutorialsButton",void 0),e9(this,"settingsButton",void 0),e9(this,"loadButton",void 0),e9(this,"saveButton",void 0),e9(this,"resumeButton",void 0),e9(this,"sidePanels",void 0),e9(this,"onScreenshot",new eC.y$),e9(this,"onShare",new eC.y$),e9(this,"onSave",new eC.y$),e9(this,"onResume",new eC.y$),this.sidePanels=e,this.mask=document.createElement("div"),this.mask.id="pauseMask",this.rootNode=document.createElement("ul"),this.rootNode.id="pauseMenu",this.rootNode.classList.add("leftSideMenu");var i=function(e,t){var n=document.createElement("li");return n.id=e,n.classList.add("button"),n.innerText=eI.Z.t(t),r.rootNode.appendChild(n),n};this.resumeButton=i("resumeButton","pauseMenu:resume"),this.saveButton=i("saveButton","pauseMenu:save"),this.loadButton=i("loadButton","pauseMenu:load"),this.tutorialsButton=i("pauseTutorialsButton","pauseMenu:tutorials"),this.settingsButton=i("pauseSettingsButton","pauseMenu:settings"),this.contributeButton=i("pauseContributeButton","pauseMenu:contribute"),this.screenshotButton=i("screenshotButton","pauseMenu:screenshot"),this.shareButton=i("shareButton","pauseMenu:share"),this.mask.appendChild(this.rootNode),document.body.appendChild(this.mask),this.screenshotButton.addEventListener("click",function(){return r.onScreenshot.notifyObservers()}),this.shareButton.addEventListener("click",function(){return r.onShare.notifyObservers()}),this.contributeButton.addEventListener("click",function(){n.playNow(em.k6.CLICK),r.sidePanels.toggleActivePanel(e1.CONTRIBUTE)}),this.tutorialsButton.addEventListener("click",function(){n.playNow(em.k6.CLICK),r.sidePanels.toggleActivePanel(e1.TUTORIALS)}),this.settingsButton.addEventListener("click",function(){n.playNow(em.k6.CLICK),r.sidePanels.toggleActivePanel(e1.SETTINGS)}),this.loadButton.addEventListener("click",function(){n.playNow(em.k6.CLICK),r.sidePanels.toggleActivePanel(e1.LOAD_SAVE)}),this.saveButton.addEventListener("click",function(){return r.onSave.notifyObservers()}),this.resumeButton.addEventListener("click",function(){return r.onResume.notifyObservers()}),this.rootNode.querySelectorAll("li").forEach(function(e){e.addEventListener("mouseenter",function(){n.playNow(em.k6.HOVER)}),e.addEventListener("click",function(){n.playNow(em.k6.CLICK)})}),this.setVisibility(!1)}return e=[{key:"setVisibility",value:function(e){this.rootNode.style.display=e?"grid":"none",this.mask.style.display=e?"block":"none",e||this.sidePanels.hideActivePanel()}},{key:"isVisible",value:function(){return"none"!==this.rootNode.style.display}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}(),tt=n(19577),tn=n(91822),tr=n(76473);function ti(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){n(e);return}o.done?t(u):Promise.resolve(u).then(r,i)}function ta(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){ti(a,r,i,s,o,"next",e)}function o(e){ti(a,r,i,s,o,"throw",e)}s(void 0)})}}function ts(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function to(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tu(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}var tl=function(){var e,t;function r(e,t,n,i,a,s,u,l,c){var d=this;if(!(this instanceof r))throw TypeError("Cannot call a class as a function");to(this,"engine",void 0),to(this,"assets",void 0),to(this,"starSystemView",void 0),to(this,"starMap",void 0),to(this,"musicConductor",void 0),to(this,"soundPlayer",void 0),to(this,"tts",void 0),to(this,"mainMenu",void 0),to(this,"pauseMenu",void 0),to(this,"sidePanels",void 0),to(this,"tutorialLayer",void 0),to(this,"activeView",void 0),to(this,"state",0),to(this,"videoRecorder",null),to(this,"player",void 0),to(this,"encyclopaedia",void 0),to(this,"starSystemDatabase",void 0),to(this,"saveManager",void 0),to(this,"elapsedSeconds",0),to(this,"autoSavePeriodSeconds",300),to(this,"autoSaveTimerSeconds",0),to(this,"isAutoSaveEnabled",!0),this.engine=t,this.assets=n,this.player=e,this.player.onNameChangedObservable.add(function(e){d.saveManager.renameCmdr(d.player.uuid,e),d.saveManager.save()}),this.starSystemDatabase=s,this.saveManager=u,this.encyclopaedia=a,this.player.discoveries.uploaded.forEach(function(e){return ta(function(){return tu(this,function(t){switch(t.label){case 0:return[4,this.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(d)}),this.starSystemView=i,this.starSystemView.onBeforeJump.add(function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(d)}),this.starSystemView.onAfterJump.add(function(){return ta(function(){var e;return tu(this,function(t){switch(t.label){case 0:return e=this,[4,this.createAutoSave()];case 1:if(t.sent(),this.player.tutorials.fuelScoopingCompleted)return[3,3];return[4,this.tutorialLayer.setTutorial(new eY.L)];case 2:t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.fuelScoopingCompleted=!0}),t.label=3;case 3:return[2]}})}).call(d)}),this.starSystemView.onNewDiscovery.add(function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(d)}),this.musicConductor=new ep(this.assets.audio.musics,this.starSystemView),this.soundPlayer=l,this.tts=c,this.starMap=new eS.s(this.player,this.engine,this.encyclopaedia,this.starSystemDatabase,this.soundPlayer),this.starMap.onTargetSetObservable.add(function(e){d.starSystemView.setSystemAsTarget(e)}),this.starMap.detachControl(),this.starSystemView.attachControl(),this.activeView=this.starSystemView,l.setInstanceMask(eh.S.STAR_SYSTEM_VIEW),this.tutorialLayer=new tt.b(this.soundPlayer),document.body.appendChild(this.tutorialLayer.root),this.sidePanels=new e2(this.starSystemDatabase,this.saveManager,this.soundPlayer,this.musicConductor),this.sidePanels.loadSavePanelContent.onLoadSaveObservable.add(function(e){t.onEndFrameObservable.addOnce(function(){return ta(function(){return tu(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[3,2];return[4,this.createAutoSave()];case 1:t.sent(),t.label=2;case 2:return[4,this.resume()];case 3:return t.sent(),this.starSystemView.setUIEnabled(!0),[4,this.loadSave(e)];case 4:return t.sent(),[2]}})}).call(d)})}),this.mainMenu=new e8(this.sidePanels,this.starSystemView,this.starSystemDatabase,this.soundPlayer),this.mainMenu.onStartObservable.add(function(){return ta(function(){var e,t,n;return tu(this,function(r){switch(r.label){case 0:return e=this,[4,this.tutorialLayer.setTutorial(new eH.d)];case 1:return r.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.flightCompleted=!0}),[4,this.starSystemView.switchToSpaceshipControls()];case 2:return r.sent(),t=this.starSystemView.getSpaceshipControls().getTransform().getAbsolutePosition(),n=this.starSystemView.getStarSystem().getOrbitalFacilities().reduce(function(e,n){return o.P.DistanceSquared(t,n.getTransform().getAbsolutePosition())<o.P.DistanceSquared(t,e.getTransform().getAbsolutePosition())?n:e}),this.starSystemView.setTarget(n),[4,this.createAutoSave()];case 3:return r.sent(),[2]}})}).call(d)}),this.sidePanels.tutorialsPanelContent.onTutorialSelected.add(function(e){return ta(function(){return tu(this,function(t){switch(t.label){case 0:if(this.mainMenu.isVisible())return[3,3];return[4,this.createAutoSave()];case 1:return t.sent(),[4,(0,eT.bG)(eI.Z.t("tutorials:common:loadTutorialWillLeaveGame"),this.soundPlayer)];case 2:if(!t.sent())return[2];t.label=3;case 3:return this.sidePanels.hideActivePanel(),this.loadTutorial(e),[2]}})}).call(d)}),this.starSystemView.getSpaceshipControls().onToggleWarpDrive.add(function(e){return ta(function(){var t,n,r,i,a,s;return tu(this,function(u){switch(u.label){case 0:if(t=this,e||this.player.tutorials.stationLandingCompleted||null===(r=(n=this.starSystemView.getSpaceshipControls()).getClosestLandableFacility())||(i=n.getTransform().getAbsolutePosition(),a=r.getTransform().position,s=10*r.getBoundingRadius(),o.P.DistanceSquared(i,a)>Math.pow(s,2)))return[2];return[4,this.tutorialLayer.setTutorial(new e$.b)];case 1:return u.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){t.player.tutorials.stationLandingCompleted=!0}),[2]}})}).call(d)}),this.starSystemView.getSpaceshipControls().onCompleteLanding.add(function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(d)}),this.starSystemView.onInitStarSystem.add(function(){var e=d.starSystemView.getStarSystem().model;d.starMap.setCurrentStarSystem(e.coordinates)}),this.starSystemView.spaceStationLayer.onTakeOffObservable.add(function(){return ta(function(){var e;return tu(this,function(t){switch(t.label){case 0:if(e=this,this.player.tutorials.starMapCompleted)return[2];return[4,this.tutorialLayer.setTutorial(new eQ.D)];case 1:return t.sent(),this.tutorialLayer.onQuitTutorial.addOnce(function(){e.player.tutorials.starMapCompleted=!0}),[2]}})}).call(d)}),this.pauseMenu=new te(this.sidePanels,this.soundPlayer),this.pauseMenu.onResume.add(function(){return d.resume()}),this.pauseMenu.onScreenshot.add(function(){return d.takeScreenshot()}),this.pauseMenu.onShare.add(function(){d.engine.onEndFrameObservable.addOnce(function(){return ta(function(){var e,t,n;return tu(this,function(r){switch(r.label){case 0:return e=this,[4,this.generateSaveData()];case 1:if((t=r.sent()).player.uuid=tr.Z.SHARED_POSITION_SAVE_UUID,null!==(n=(0,v.z0)(t)))return[3,3];return[4,(0,eT.UX)("Could not create a shareable link.",this.soundPlayer)];case 2:case 4:return r.sent(),[2];case 3:return[4,navigator.clipboard.writeText(n.toString()).then(function(){(0,e7.sc)(e7.OO.GENERAL,e7.sh.INFO,eI.Z.t("notifications:copiedToClipboard"),2e3,e.soundPlayer)})]}})}).call(d)})}),this.pauseMenu.onSave.add(function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:return[4,this.saveToLocalStorage()];case 1:return e.sent()?(0,e7.sc)(e7.OO.GENERAL,e7.sh.SUCCESS,eI.Z.t("notifications:saveOk"),2e3,this.soundPlayer):(0,e7.sc)(e7.OO.GENERAL,e7.sh.ERROR,eI.Z.t("notifications:cantSaveTutorial"),2e3,this.soundPlayer),[2]}})}).call(d)}),window.addEventListener("blur",function(){d.mainMenu.isVisible()||d.starSystemView.isLoadingSystem()||d.pause()}),window.addEventListener("mouseleave",function(){d.mainMenu.isVisible()||d.starSystemView.isLoadingSystem()||d.pause()}),window.addEventListener("resize",function(){d.engine.resize(!0)}),window.addEventListener("beforeunload",function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.createAutoSave()];case 1:return e.sent(),[2]}})}).call(d)}),eg.S.map.toggleStarMap.on("complete",function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.toggleStarMap()];case 1:return e.sent(),[2]}})}).call(d)}),eg.S.map.screenshot.on("complete",function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeScreenshot()];case 1:return e.sent(),[2]}})}).call(d)}),eg.S.map.videoCapture.on("complete",function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:if(this.mainMenu.isVisible())return[2];return[4,this.takeVideoCapture()];case 1:return e.sent(),[2]}})}).call(d)}),eg.S.map.togglePause.on("complete",function(){!d.mainMenu.isVisible()&&(d.isPaused()||d.pause())}),window.CosmosJourneyer=this}return e=[{key:"pause",value:function(){!this.isPaused()&&(this.mainMenu.isVisible()||(this.state=2,document.exitPointerLock(),this.activeView===this.starSystemView&&this.starSystemView.stopBackgroundSounds(),this.soundPlayer.playNow(em.k6.OPEN_PAUSE_MENU),this.pauseMenu.setVisibility(!0)))}},{key:"resume",value:function(){return ta(function(){var e;return tu(this,function(t){switch(t.label){case 0:if(!this.isPaused())return[2];if(this.state=1,this.soundPlayer.playNow(em.k6.CLICK),this.pauseMenu.setVisibility(!1),!(this.activeView===this.starSystemView&&this.starSystemView.scene.getActiveControls().shouldLockPointer()))return[3,2];return[4,null==(e=this.engine.getRenderingCanvas())?void 0:e.requestPointerLock()];case 1:t.sent(),t.label=2;case 2:return[2]}})}).call(this)}},{key:"isPaused",value:function(){return 2===this.state}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ta(function(){var t;return tu(this,function(n){switch(n.label){case 0:if(t=this,e)return[3,2];return[4,this.mainMenu.init()];case 1:n.sent(),n.label=2;case 2:return this.starSystemView.initStarSystem(),this.engine.runRenderLoop(function(){var e=t.engine.getDeltaTime()/1e3;t.elapsedSeconds+=e,t.player.timePlayedSeconds+=e,t.engine.loadingScreen.setProgressPercentage(100*t.starSystemView.loader.getLoadingProgress()),t.autoSaveTimerSeconds+=e,t.autoSaveTimerSeconds>=t.autoSavePeriodSeconds&&(t.autoSaveTimerSeconds%=t.autoSavePeriodSeconds,t.mainMenu.isVisible()||t.starSystemView.isJumpingBetweenSystems()||t.createAutoSave()),(0,e7.BX)(e),t.musicConductor.update(t.isPaused(),t.activeView===t.starSystemView,t.mainMenu.isVisible(),e),t.soundPlayer.update(),t.tts.update(),t.isPaused()||t.activeView.render()}),this.state=1,[2]}})}).call(this)}},{key:"toggleStarMap",value:function(){return ta(function(){var e,t;return tu(this,function(n){switch(n.label){case 0:if(this.activeView!==this.starSystemView)return[3,1];return this.soundPlayer.setInstanceMask(eh.S.STAR_MAP_VIEW),this.starSystemView.targetCursorLayer.setEnabled(!1),document.exitPointerLock(),this.starSystemView.detachControl(),this.starMap.attachControl(),e=this.starMap,this.activeView=e,e.focusOnCurrentSystem(),[3,3];case 1:if(this.starMap.detachControl(),this.starSystemView.attachControl(),this.soundPlayer.setInstanceMask(eh.S.STAR_SYSTEM_VIEW),this.activeView=this.starSystemView,!this.starSystemView.scene.getActiveControls().shouldLockPointer())return[3,3];return[4,null==(t=this.engine.getRenderingCanvas())?void 0:t.requestPointerLock()];case 2:n.sent(),n.label=3;case 3:return[2]}})}).call(this)}},{key:"takeScreenshot",value:function(){return ta(function(){var e;return tu(this,function(t){switch(t.label){case 0:if(null!==(e=this.activeView.getMainScene().activeCamera))return[3,2];return[4,(0,eT.UX)("Cannot take screenshot: camera is null",this.soundPlayer)];case 1:return t.sent(),[2,!1];case 2:return u.w1.CreateScreenshot(this.engine,e,{precision:1}),[2,!0]}})}).call(this)}},{key:"takeVideoCapture",value:function(){return ta(function(){return tu(this,function(e){switch(e.label){case 0:if(!l.S.IsSupported(this.engine))return console.warn("Your browser does not support video recording!"),[2];if(null===this.videoRecorder&&(this.videoRecorder=new l.S(this.engine,{fps:60,recordChunckSize:3e6,mimeType:"video/webm;codecs=h264"})),!this.videoRecorder.isRecording)return[3,1];return this.videoRecorder.stopRecording(),[3,3];case 1:return[4,this.videoRecorder.startRecording("planetEngine.webm",Number(prompt("Enter video duration in seconds","10"))).then()];case 2:e.sent(),e.label=3;case 3:return[2]}})}).call(this)}},{key:"getCurrentUniverseCoordinates",value:function(e){var t=this.starSystemView.getStarSystem(),n=e.getAbsolutePosition(),r=t.getNearestOrbitalObject(n),i=(0,P.D2)(r.model,t.model),a=r.getTransform().computeWorldMatrix(!0).clone().invert(),s=o.P.TransformCoordinates(n,a);s.length()<1.1*r.getBoundingRadius()&&s.copyFromFloats(0,0,5*r.getBoundingRadius());var u=e.absoluteRotationQuaternion,l=r.getTransform().absoluteRotationQuaternion.clone().invert(),c=u.multiply(l);return{type:"relative",universeObjectId:i,position:{x:s.x,y:s.y,z:s.z},rotation:{x:c.x,y:c.y,z:c.z,w:c.w}}}},{key:"generateSaveData",value:function(){return ta(function(){var e,t,n,r,i,a;return tu(this,function(s){switch(s.label){case 0:if(t=(e=this.starSystemView.getSpaceshipControls()).getSpaceship(),n=this.getCurrentUniverseCoordinates(e.getTransform()),r=t.isLandedAtFacility()?{type:"atStation",universeObjectId:n.universeObjectId}:n,i=this.activeView.getMainScene().activeCamera,a="",!i)return[3,2];return[4,u.w1.CreateScreenshotAsync(this.engine,i,{width:320,height:180,precision:.8})];case 1:a=s.sent(),s.label=2;case 2:return[2,{timestamp:Date.now(),player:eb.J.Serialize(this.player),playerLocation:{type:"inSpaceship",shipId:t.id},shipLocations:to({},t.id,r),thumbnail:a}]}})}).call(this)}},{key:"saveToLocalStorage",value:function(){return ta(function(){var e,t,n,r,i,a,s;return tu(this,function(o){switch(o.label){case 0:if(this.player.uuid===tr.Z.TUTORIAL_SAVE_UUID)return[2,!1];if(this.player.uuid!==tr.Z.SHARED_POSITION_SAVE_UUID)return[3,2];return this.player.uuid=crypto.randomUUID(),n=(t=this.player).setName,[4,(0,eT.We)(eI.Z.t("spaceStation:cmdrNameChangePrompt"),this.player.getName(),this.soundPlayer)];case 1:n.apply(t,[null!=(e=o.sent())?e:"Python"]),o.label=2;case 2:return[4,this.generateSaveData()];case 3:return i=(r=o.sent()).player.uuid,(s=null!=(a=this.saveManager.getSavesForCmdr(i))?a:{manual:[],auto:[]}).manual.unshift(r),this.saveManager.setCmdrSaves(i,s),[2,this.saveManager.save()]}})}).call(this)}},{key:"setAutoSaveEnabled",value:function(e){this.isAutoSaveEnabled=e}},{key:"createAutoSave",value:function(){return ta(function(){var e,t,n,r;return tu(this,function(i){switch(i.label){case 0:if(!this.isAutoSaveEnabled)return[2];return[4,this.generateSaveData()];case 1:if((t=(e=i.sent()).player.uuid)===tr.Z.SHARED_POSITION_SAVE_UUID||t===tr.Z.TUTORIAL_SAVE_UUID)return[2];for((r=null!=(n=this.saveManager.getSavesForCmdr(t))?n:{manual:[],auto:[e]}).auto.unshift(e);r.auto.length>tr.Z.MAX_AUTO_SAVES;)r.auto.pop();return this.saveManager.setCmdrSaves(t,r),this.saveManager.save(),this.autoSaveTimerSeconds=0,[2]}})}).call(this)}},{key:"downloadSaveFile",value:function(){var e=this;this.engine.onEndFrameObservable.addOnce(function(){return ta(function(){var e,t,n,r;return tu(this,function(i){switch(i.label){case 0:return[4,this.generateSaveData()];case 1:return e=new Blob([JSON.stringify(i.sent())],{type:"application/json"}),t=URL.createObjectURL(e),(n=document.createElement("a")).href=t,r=new Date().toLocaleString().replace(/[^0-9a-zA-Z]/g,"_"),n.download="CMDR_".concat(this.player.getName(),"_").concat(r,".json"),n.click(),[2]}})}).call(e)})}},{key:"loadTutorial",value:function(e){var t=this;this.engine.onEndFrameObservable.addOnce(function(){return ta(function(){var t,n;return tu(this,function(r){switch(r.label){case 0:if(this.mainMenu.hide(),this.mainMenu.isVisible())return[3,2];return[4,this.createAutoSave()];case 1:r.sent(),r.label=2;case 2:if((t=e.getSaveData(this.starSystemDatabase)).success)return[3,4];return console.error(t.error),[4,(0,eT.UX)(eI.Z.t("The tutorial save has errors and could not be loaded! Check the console for more information."),this.soundPlayer)];case 3:return r.sent(),[2];case 4:return[4,this.loadSave(t.value)];case 5:return r.sent(),this.player.uuid=tr.Z.TUTORIAL_SAVE_UUID,[4,this.resume()];case 6:return r.sent(),[4,this.tutorialLayer.setTutorial(e)];case 7:return r.sent(),this.starSystemView.setUIEnabled(!0),n=this.starSystemView.getStarSystem().getNearestOrbitalObject(this.starSystemView.scene.getActiveControls().getTransform().getAbsolutePosition()),this.starSystemView.getSpaceshipControls().getTransform().lookAt(n.getTransform().getAbsolutePosition()),[2]}})}).call(t)})}},{key:"loadSave",value:function(e){return ta(function(){var t,n,r,i,a,s;return tu(this,function(o){switch(o.label){case 0:if(t=this,"inSpaceship"===(n=e.playerLocation).type)return[3,1];return r=n,[3,6];case 1:if(void 0!==(i=e.shipLocations[n.shipId]))return[3,3];return[4,(0,eT.UX)("Player is in spaceship, but said spaceship does not exist. The loading procedure has been aborted.",this.soundPlayer)];case 2:case 4:return o.sent(),[2];case 3:if("inSpaceship"!==i.type)return[3,5];return[4,(0,eT.UX)("Spaceship inside spaceships is not yet supported. The loading procedure has been aborted.",this.soundPlayer)];case 5:r=i,o.label=6;case 6:if(null!==(a=this.starSystemDatabase.getSystemModelFromCoordinates(r.universeObjectId.systemCoordinates)))return[3,8];return[4,(0,eT.UX)("Cannot load universe coordinates: system model not found. The loading procedure has been aborted.",this.soundPlayer)];case 7:return o.sent(),[2];case 8:return s=eb.J.Deserialize(e.player,this.starSystemDatabase),this.player.copyFrom(s,this.starSystemDatabase),this.player.discoveries.uploaded.forEach(function(e){return ta(function(){return tu(this,function(t){switch(t.label){case 0:return[4,this.encyclopaedia.contributeDiscoveryIfNew(e)];case 1:return t.sent(),[2]}})}).call(t)}),[4,this.starSystemView.resetPlayer()];case 9:return o.sent(),this.engine.loadingScreen.displayLoadingUI(),[4,this.starSystemView.loadStarSystem(a)];case 10:if(o.sent(),0!==this.state)return[3,12];return[4,this.init(!0)];case 11:return o.sent(),[3,13];case 12:this.starSystemView.initStarSystem(),o.label=13;case 13:if("inSpaceship"!==n.type)return[3,15];return[4,this.starSystemView.switchToSpaceshipControls()];case 14:return o.sent(),[3,17];case 15:return[4,this.starSystemView.switchToCharacterControls()];case 16:o.sent(),o.label=17;case 17:return[4,this.loadLocation(r)];case 18:return o.sent(),this.starSystemView.getSpaceshipControls().getActiveCamera().getViewMatrix(!0),this.starSystemView.getStarSystem().applyFloatingOrigin(),this.engine.loadingScreen.hideLoadingUI(),null!==this.player.currentItinerary&&this.starSystemView.setSystemAsTarget(this.player.currentItinerary[1]),[2]}})}).call(this)}},{key:"loadLocation",value:function(e){return ta(function(){return tu(this,function(t){switch(t.label){case 0:if("relative"!==e.type)return[3,2];return[4,this.loadRelativeLocation(e)];case 1:return t.sent(),[3,4];case 2:if("atStation"!==e.type)return[3,4];return[4,this.loadAtStationLocation(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})}).call(this)}},{key:"loadRelativeLocation",value:function(e){return ta(function(){var t,n,r,i,a,u;return tu(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem)))return[3,2];return i=n.getStellarObjects()[0],(0,eL.gr)(i,new o.P(0,0,4*i.getBoundingRadius()),new s._f(0,0,0,1),t),[4,(0,eT.UX)("The object you are trying to spawn near to could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:return l.sent(),[2];case 2:return(0,eL.gr)(r,new o.P(e.position.x,e.position.y,e.position.z),new s._f(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w),t),(a=o.P.Distance(t.getAbsolutePosition(),r.getTransform().getAbsolutePosition()))<1.1*(u=r.getBoundingRadius())&&(a<.1?t.position.addInPlace(new o.P(0,0,5*u)):t.position.scaleInPlace(1.1*u/a)),this.starSystemView.targetCursorLayer.setTarget(r),this.starSystemView.spaceShipLayer.setTarget(r.getTransform()),[2]}})}).call(this)}},{key:"loadAtStationLocation",value:function(e){return ta(function(){var t,n,r,i,a,u;return tu(this,function(l){switch(l.label){case 0:if(t=this.starSystemView.scene.getActiveControls().getTransform(),void 0!==(r=(n=this.starSystemView.getStarSystem()).getOrbitalObjectById(e.universeObjectId.idInSystem))&&(r.type===b.o.SPACE_STATION||r.type===b.o.SPACE_ELEVATOR))return[3,2];return i=n.getStellarObjects()[0],(0,eL.gr)(i,new o.P(0,0,4*i.getBoundingRadius()),new s._f(0,0,0,1),t),[4,(0,eT.UX)("The space station you are trying to spawn at could not be found. You will spawn around the first stellar object of the system instead.",this.soundPlayer)];case 1:case 3:return l.sent(),[2];case 2:if(void 0!==(a=r.getLandingPadManager().getAvailableLandingPads().at(0)))return[3,4];return u=r,(0,eL.gr)(u,new o.P(0,0,4*u.getBoundingRadius()),new s._f(0,0,0,1),t),[4,(0,eT.UX)("There are no available pads at the space station you are trying to spawn at. You have been moved outside of the station instead.",this.soundPlayer)];case 4:return this.starSystemView.getSpaceshipControls().getSpaceship().spawnOnPad(a),[2]}})}).call(this)}}],t=[{key:"CreateAsync",value:function(){return ta(function(){var e,t,s,u,l,v,b,P,eh,ef,ev,ep,eg,eS,eC;return tu(this,function(eA){switch(eA.label){case 0:if((e=document.getElementById("renderer")).width=window.innerWidth,e.height=window.innerHeight,t=new eP.a(e),!window.location.search.includes("webgpu"))return[3,2];return[4,a.u.CreateAsync(e,{twgslOptions:{wasmPath:new URL(n(43808),n.b).href,jsPath:new URL(n(78996),n.b).href},audioEngine:!0})];case 1:return u=eA.sent(),[3,3];case 2:u=new i.D(e,!0,{preserveDrawingBuffer:!0,useHighPrecisionMatrix:!0,doNotHandleContextLost:!0,audioEngine:!0}),eA.label=3;case 3:return(s=u).useReverseDepthBuffer=!0,s.loadingScreen=t,s.loadingScreen.displayLoadingUI(),window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight,s.resize(!0)}),[4,(0,eI.L)()];case 4:return eA.sent(),console.log("API: ".concat(s.isWebGPU?"WebGPU":"WebGL")),console.log("GPU detected: ".concat(s.extractDriverInfo())),[4,(0,d.Z)()];case 5:var eO,eM,eL;return l=eA.sent(),console.log("Havok initialized"),v=new w.Z((0,g.D)()),v.registerGeneralPlugin(function(e){return(0,tn.q)([e.coordinates.starSectorX,e.coordinates.starSectorY,e.coordinates.starSectorZ,e.coordinates.localX,e.coordinates.localY,e.coordinates.localZ])>.5},function(e){var t=e.stellarObjects.map(function(e){return e.id});return e.anomalies.push((0,S.C)(t)),e}),b=eb.J.Default(v),(P=new f.t).backends.push(new h.O(v)),(eh=new eE.E(s)).useRightHandedSystem=!0,(ef=new c.a(!0,l)).setVelocityLimits(1e4,1e4),eh.enablePhysics(o.P.Zero(),ef),[4,(eO=function(e,n){t.setProgressPercentage(e/n*100)},eM=eh,(eL=function(){var e,t,n;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:var i;return e=(i=function(){var e,t,n,r;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:var a,s,o;return e=(a=function(){var e,t,n,r,i,a,s,o,u,l,c,d,h,f,v,p,m,y,g;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(b){switch(b.label){case 0:return e=0,t=0,r=(n=function(n,r,i){var a=new Promise(function(e){var t=new E.$(n,r,null,function(){e(t)},i)});return t++,a.then(function(n){return eO(++e,t,n.name),n})})("OuchSound",Y),i=n("EngineRunningSound",H,{loop:!0}),a=n("MenuHoverSound",_,{playbackRate:.5}),s=n("MenuSelectSound",_),o=n("OpenPauseMenuSound",_,{playbackRate:.75}),u=n("TargetLockSound",X),l=n("TargetUnlockSound",X,{playbackRate:.5}),c=n("EnableWarpDriveSound",F,{playbackRate:2}),d=n("DisableWarpDriveSound",U),h=n("AcceleratingWarpDriveSound",G,{playbackRate:1,volume:.3,loop:!0}),f=n("DeceleratingWarpDriveSound",Z,{playbackRate:1,volume:.3,loop:!0}),v=n("HyperSpaceSound",z,{playbackRate:1.5,volume:.25,loop:!0}),p=n("ThrusterSound",j,{playbackRate:1,volume:.5,loop:!0}),m=n("Success",q),y=n("Error",W),g={},[4,r];case 1:return g.ouch=b.sent(),[4,i];case 2:return g.engineRunning=b.sent(),[4,a];case 3:return g.menuHover=b.sent(),[4,s];case 4:return g.menuSelect=b.sent(),[4,o];case 5:return g.openPauseMenu=b.sent(),[4,u];case 6:return g.targetLock=b.sent(),[4,l];case 7:return g.targetUnlock=b.sent(),[4,c];case 8:return g.enableWarpDrive=b.sent(),[4,d];case 9:return g.disableWarpDrive=b.sent(),[4,h];case 10:return g.acceleratingWarpDrive=b.sent(),[4,f];case 11:return g.deceleratingWarpDrive=b.sent(),[4,v];case 12:return g.hyperSpace=b.sent(),[4,p];case 13:return g.thruster=b.sent(),[4,m];case 14:return g.success=b.sent(),[4,y];case 15:return[2,(g.error=b.sent(),g)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=a.apply(e,t);function s(e){Q(i,n,r,s,o,"next",e)}function o(e){Q(i,n,r,s,o,"throw",e)}s(void 0)})})(),t=(s=function(){var e,t,n,r,i,a,s,o,u,l,c,d,h,f,v,p,m;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(y){switch(y.label){case 0:return e=0,t=0,r=(n=function(n,r,i){var a=new Promise(function(e){var t=new E.$(n,r,null,function(){e(t)},i)});return t++,a.then(function(n){return eO(++e,t,n.name),n})})("Wandering",T,{loop:!0}),i=n("StraussBlueDanube",x),a=n("DeepRelaxation",A),s=n("AtlanteanTwilight",C),o=n("InfinitePerspective",I),u=n("ThatZenMoment",N),l=n("EchoesOfTime",O),c=n("PeaceOfMind",V),d=n("SpacialWinds",L),h=n("Mesmerize",k),f=n("Reawakening",R),v=n("EquatorialComplex",M),p=n("Soaring",D),m={},[4,r];case 1:return m.wandering=y.sent(),[4,i];case 2:return m.straussBlueDanube=y.sent(),[4,a];case 3:return m.deepRelaxation=y.sent(),[4,s];case 4:return m.atlanteanTwilight=y.sent(),[4,o];case 5:return m.infinitePerspective=y.sent(),[4,u];case 6:return m.thatZenMoment=y.sent(),[4,l];case 7:return m.echoesOfTime=y.sent(),[4,c];case 8:return m.peaceOfMind=y.sent(),[4,d];case 9:return m.spacialWinds=y.sent(),[4,h];case 10:return m.mesmerize=y.sent(),[4,f];case 11:return m.reawakening=y.sent(),[4,v];case 12:return m.equatorialComplex=y.sent(),[4,p];case 13:return[2,(m.soaring=y.sent(),m)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=s.apply(e,t);function a(e){B(i,n,r,a,o,"next",e)}function o(e){B(i,n,r,a,o,"throw",e)}a(void 0)})})(),n=(o=function(){var e,t,n,r,i,a,s,o,u,l,c,d,h,f,v,p;return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(u){var l=[o,u];if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(m){switch(m.label){case 0:return e=0,t=0,r=(n=function(n,r,i){var a=new Promise(function(e){var t=new E.$(n,r,null,function(){e(t)},i)});return t++,a.then(function(n){return eO(++e,t,n.name),n})})("InitiatingPlanetaryLanding",et),i=n("LandingRequestGranted",er),a=n("LandingComplete",en),s=n("MissionComplete",ei),o=n("NewDiscovery",ea),u=n("CannotEngageWarpDrive",$),l=n("WarpDriveEmergencyShutDown",eo),c=n("WarpDriveDisengaged",es),d=n("EngagingWarpDrive",J),h=n("FuelScoopingVoice",K),f=n("FuelScoopingCompleteVoice",ee),v={},p={},[4,r];case 1:return p.initiatingPlanetaryLanding=m.sent(),[4,i];case 2:return p.landingRequestGranted=m.sent(),[4,a];case 3:return p.landingComplete=m.sent(),[4,s];case 4:return p.missionComplete=m.sent(),[4,o];case 5:return p.newDiscovery=m.sent(),[4,u];case 6:return p.cannotEngageWarpDrive=m.sent(),[4,l];case 7:return p.warpDriveEmergencyShutDown=m.sent(),[4,c];case 8:return p.warpDriveDisengaged=m.sent(),[4,d];case 9:return p.engagingWarpDrive=m.sent(),[4,h];case 10:return p.fuelScooping=m.sent(),[4,f];case 11:return[2,(v.charlotte=(p.fuelScoopingComplete=m.sent(),p),v)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=o.apply(e,t);function a(e){eu(i,n,r,a,s,"next",e)}function s(e){eu(i,n,r,a,s,"throw",e)}a(void 0)})})(),r={},[4,e];case 1:return r.sounds=i.sent(),[4,t];case 2:return r.musics=i.sent(),[4,n];case 3:return[2,(r.speakerVoiceLines=i.sent(),r)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function s(e){el(a,n,r,s,o,"next",e)}function o(e){el(a,n,r,s,o,"throw",e)}s(void 0)})})(),t=(0,ec.v)(eO,eM),n={},[4,e];case 1:return n.audio=r.sent(),[4,t];case 2:return[2,(n.rendering=r.sent(),n)]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var i=eL.apply(e,t);function a(e){ed(i,n,r,a,s,"next",e)}function s(e){ed(i,n,r,a,s,"throw",e)}a(void 0)})})())];case 6:return ev=eA.sent(),ep=new em.st(ev.audio.sounds),eg=new ey.Ae(ev.audio.speakerVoiceLines),[4,(eS=new ew.p(eh,b,s,ef,P,v,ep,eg,ev.rendering)).resetPlayer()];case 7:return eA.sent(),[4,(0,eG.x)()];case 8:if(null!==eA.sent())return[3,10];return[4,(0,eT.UX)("Your keyboard layout could not be detected. The QWERTY layout will be assumed by default.",ep)];case 9:eA.sent(),eA.label=10;case 10:return[4,y.d.CreateAsync(new m.$,v)];case 11:if((eC=eA.sent()).success)return[3,13];return[4,(0,eT.UX)((0,p.M)(eC.error),ep)];case 12:throw eA.sent(),Error("Failed to create save manager");case 13:return[2,new r(b,s,ev,eS,P,v,eC.value,ep,eg)]}})})()}}],e&&ts(r.prototype,e),t&&ts(r,t),r}()},24660:function(e,t,n){n.d(t,{_T:()=>c,gr:()=>o,pl:()=>u,xM:()=>l});var r=n(16891),i=n(61834),a=n(14280);function s(e,t){var n=-1,r=t[0];if(void 0===r)throw Error("no bodieees !");var i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var l=o.value,c=e.subtract(l.getTransform().getAbsolutePosition()).length();(-1===n||c<n)&&(r=l,n=c)}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return r}function o(e,t,n,r){var s=e.getBoundingRadius(),o=t.length(),u=Math.max(2*s,o),l=e.getTransform().getWorldMatrix(),c=i.P.TransformCoordinates(t.scale(u/(o+1e-4)),l);r.setAbsolutePosition(c);var d=e.getTransform().absoluteRotationQuaternion,h=n.multiply(d);(0,a.Sf)(r,h)}function u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=s(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(a===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.P(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var o=t.getTransform().getAbsolutePosition().subtract(a.getTransform().getAbsolutePosition()),u=o.length();o.scaleInPlace(1/u);var l=a.getTransform().getAbsolutePosition().add(o.scale(u-r*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(l)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.P.Zero()),e.getTransform().lookAt(t.getTransform().getAbsolutePosition())}function l(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,o=s(t.getTransform().getAbsolutePosition(),n.getStellarObjects());if(o===t)e.getTransform().setAbsolutePosition(t.getTransform().getAbsolutePosition().add(new i.P(0,.2,1).scaleInPlace(t.getBoundingRadius()*r)));else{var u=t.getTransform().getAbsolutePosition().subtract(o.getTransform().getAbsolutePosition()),l=u.length();u.scaleInPlace(1/l);var c=(0,a.gM)(t.getTransform()),d=i.P.Cross(u,c),h=o.getTransform().getAbsolutePosition().add(u.scale(l+1.5*t.getBoundingRadius())).add(d.scale(4*t.getBoundingRadius()));e.getTransform().setAbsolutePosition(h),(0,a.XT)(e.getTransform(),t.getTransform().getAbsolutePosition(),u,-Math.PI/16)}n.translateEverythingNow(e.getTransform().getAbsolutePosition().negate()),e.getTransform().setAbsolutePosition(i.P.Zero());var f=o.getTransform().getAbsolutePosition().subtract(t.getTransform().getAbsolutePosition()).normalize(),v=t.getTransform().getAbsolutePosition().add(f.scale(4*t.getBoundingRadius()));e.getTransform().lookAt(v),e.getTransform().computeWorldMatrix(!0),(0,a.Sl)(e.getTransform(),-Math.PI/8),e.getActiveCamera().getViewMatrix(!0),e.getActiveCamera().getProjectionMatrix(!0)}function c(e,t,n){var o=e.asteroidField;if(null===o)throw Error("The body does not have an asteroid field");var u=e.getTransform().getAbsolutePosition(),l=(0,r.Lerp)(o.innerRadius,o.outerRadius,n),c=s(u,t.getStellarObjects()),d=u.subtract(c.getTransform().getAbsolutePosition()).normalize(),h=(0,a.gM)(e.getTransform()),f=i.P.Cross(d,h).normalize();return u.add(f.scale(l)).add(h.scale(o.patchThickness))}},43808:function(e,t,n){e.exports=n.p+"fd7997898bbeb1f1.wasm"},4761:function(e,t,n){n.d(t,{Ae:()=>u,bM:()=>s,eU:()=>o});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i,a,s=((i={})[i.CHARLOTTE=0]="CHARLOTTE",i),o=((a={})[a.INITIATING_PLANETARY_LANDING=0]="INITIATING_PLANETARY_LANDING",a[a.LANDING_REQUEST_GRANTED=1]="LANDING_REQUEST_GRANTED",a[a.LANDING_COMPLETE=2]="LANDING_COMPLETE",a[a.MISSION_COMPLETE=3]="MISSION_COMPLETE",a[a.NEW_DISCOVERY=4]="NEW_DISCOVERY",a[a.CANNOT_ENGAGE_WARP_DRIVE=5]="CANNOT_ENGAGE_WARP_DRIVE",a[a.WARP_DRIVE_EMERGENCY_SHUT_DOWN=6]="WARP_DRIVE_EMERGENCY_SHUT_DOWN",a[a.WARP_DRIVE_DISENGAGED=7]="WARP_DRIVE_DISENGAGED",a[a.ENGAGING_WARP_DRIVE=8]="ENGAGING_WARP_DRIVE",a[a.FUEL_SCOOPING=9]="FUEL_SCOOPING",a[a.FUEL_SCOOPING_COMPLETE=10]="FUEL_SCOOPING_COMPLETE",a),u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");r(this,"voiceLines",void 0),r(this,"isPlaying",!1),r(this,"soundQueue",new Set),this.voiceLines=e}return e=[{key:"getLineFromVoiceLines",value:function(e,t){switch(t){case 0:return e.initiatingPlanetaryLanding;case 1:return e.landingRequestGranted;case 2:return e.landingComplete;case 3:return e.missionComplete;case 4:return e.newDiscovery;case 5:return e.cannotEngageWarpDrive;case 6:return e.warpDriveEmergencyShutDown;case 7:return e.warpDriveDisengaged;case 8:return e.engagingWarpDrive;case 9:return e.fuelScooping;case 10:return e.fuelScoopingComplete}}},{key:"getVoiceLinesFromSpeaker",value:function(e){if(0===e)return this.voiceLines.charlotte}},{key:"sayNow",value:function(e,t){this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t).play()}},{key:"enqueueSay",value:function(e,t){this.soundQueue.add(this.getLineFromVoiceLines(this.getVoiceLinesFromSpeaker(e),t))}},{key:"update",value:function(){var e=this;if(!this.isPlaying){var t=this.soundQueue.values().next().value;void 0!==t&&(this.soundQueue.delete(t),this.isPlaying=!0,t.play(),t.onEndedObservable.addOnce(function(){e.isPlaying=!1}))}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},48353:function(e,t,n){n.d(t,{Kz:()=>s,P1:()=>o,Ub:()=>u,XX:()=>a,fT:()=>i});var r=n(96509);function i(e){return e/r.JR}function a(e){return e*r.JR}function s(e){return e/r.C}function o(e){return e+273.15}function u(e){return e*r.AU}},53020:function(e,t,n){n.d(t,{n:()=>s}),n(4046);var r=n(57423);n(39596);var i=n(6562);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var s=function(e,t,n,s){var o=new r.HE(n.r,n.g,n.b,1),u=t.map(function(){return o});return(0,i.nL)(e,{points:function(e){if(Array.isArray(e))return a(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),colors:u,updatable:!1},s)}},70104:function(e,t,n){n.d(t,{vG:()=>h});var r=n(85737),i=n(16585),a=n(76473),s=(0,i.c)(a.Z.POWER_PLAY_SEED),o=0,u=(0,r.makeNoise3D)(function(){return s(o++)}),l=(0,i.c)(a.Z.POWER_PLAY_SEED+598),c=0,d=(0,r.makeNoise3D)(function(){return l(c++)});function h(e){var t,n;return{materialistSpiritualist:(t=e.x,.5*u(.2*t,.2*e.y,.2*e.z)+.5),capitalistCommunist:(n=e.x,.5*d(.2*n,.2*e.y,.2*e.z)+.5)}}},78996:function(e,t,n){e.exports=n.p+"869739fc3ede15e2.js"},81469:function(e,t,n){n.d(t,{V:()=>i,n:()=>a});var r=n(26980),i=r.z.object({type:r.z.literal("discoveryScanner"),size:r.z.number(),quality:r.z.number()});function a(e){return{relativeRange:e.size+e.quality/10}}},91010:function(e,t,n){n.d(t,{P8:()=>i,Wl:()=>a});var r=n(61834);function i(e,t){for(var n=Math.floor(e.length/16),r=Math.floor(n/t),i=new Float32Array(16*r),a=0;a<r;a++){var s=16*Math.floor(Math.random()*n);i.set(e.subarray(s,s+16),16*a)}return i}function a(e,t,n,i){if(void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]||void 0===e[4]||void 0===e[5]||void 0===e[6]||void 0===e[7]||void 0===e[8]||void 0===e[9]||void 0===e[10]||void 0===e[11]||void 0===e[12]||void 0===e[13]||void 0===e[14]||void 0===e[15])throw Error("Matrix is not defined");t.set(e[12],e[13],e[14]);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);i.set(a,a,a);var s=r.y3.Identity();s.setRowFromFloats(0,e[0]/a,e[1]/a,e[2]/a,0),s.setRowFromFloats(1,e[4]/a,e[5]/a,e[6]/a,0),s.setRowFromFloats(2,e[8]/a,e[9]/a,e[10]/a,0),s.setRowFromFloats(3,0,0,0,1),n.copyFrom(r._f.FromRotationMatrix(s))}},91307:function(e,t,n){function r(e){var t=[];return e.children.forEach(function(n,r){"x"!==r&&"y"!==r&&t.push([r,e.name])}),t}function i(e,t){var n=[];if(e.children.forEach(function(e,r){if("x"!==r&&"y"!==r){var i,a,s=e.name;s=s.replace("key:",""),s=null!=(a=null==t||null==(i=t.get(s))?void 0:i.toUpperCase())?a:s,n.push([r,s])}}),void 0===n[0]||void 0===n[1]||void 0===n[2]||void 0===n[3])throw Error("DPadComposite keys are undefined");return[n[2],n[0],n[3],n[1]]}function a(){return[["x","pointerX"],["y","pointerY"]]}function s(e,t){var n,r,i=e.name;return i=i.replace("key:",""),i=null!=(r=null==t||null==(n=t.get(i))?void 0:n.toUpperCase())?r:i}function o(e,t){var n=[];return e.children.forEach(function(e,r){var i,a,s=e.name;s=s.replace("key:",""),s=null!=(a=null==t||null==(i=t.get(s))?void 0:i.toUpperCase())?a:s,n.push([r,s])}),n}function u(e,t){return e.action.bindings.map(function(e){return s(e.control,t)})}n.d(t,{C9:()=>o,JT:()=>r,cs:()=>i,gG:()=>a,gW:()=>u,x_:()=>s})},91822:function(e,t,n){function r(e,t,n){return(0x466f45d*e^0x127409f*t^0x4f9ffb7*n)%1e9}function i(e){var t=0x811c9dc5,n=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var o=a.value;t^=o,t=Math.imul(t,0x1000193)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return(t>>>=0)/0xffffffff}n.d(t,{Z:()=>r,q:()=>i})}}]);