/*
 *  This file is part of Cosmos Journeyer
 *
 *  Copyright (C) 2024 Barthélemy Paléologue <barth.paleologue@cosmosjourneyer.com>
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

"use strict";(globalThis.webpackChunkcosmos_journeyer=globalThis.webpackChunkcosmos_journeyer||[]).push([["2961"],{68645:function(e,t,n){function r(e){return parseInt(e.toString().replace(/\W/g,""))}function a(e,t,n=1401298e-51){return Math.abs(e-t)<=n}function i(e,t,n,r=1401298e-51){return e<t-r||e>n+r}function o(e,t){return e===t?e:Math.random()*(t-e)+e}function u(e,t,n){return e+(t-e)*n}function l(e,t,n){let r=h(t-e,360);return r>180&&(r-=360),e+r*c(n)}function s(e,t,n){let r=0;return e!=t?c((n-e)/(t-e)):0}function d(e,t,n,r,a){let i=a*a,o=a*i;return e*(2*o-3*i+1)+n*(-2*o+3*i)+t*(o-2*i+a)+r*(o-i)}function f(e,t,n,r,a){let i=a*a;return(i-a)*6*e+(3*i-4*a+1)*t+(-i+a)*6*n+(3*i-2*a)*r}function c(e,t=0,n=1){return Math.min(n,Math.max(t,e))}function p(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function g(e){let t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()}function m(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;let t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t}function h(e,t){return e-Math.floor(e/t)*t}function E(e,t,n){return(e-t)/(n-t)}function M(e,t,n){return e*(n-t)+t}function S(e,t){let n=h(t-e,360);return n>180&&(n-=360),n}function w(e,t){let n=h(e,2*t);return t-Math.abs(n-t)}function A(e,t,n){let r=c(n);return t*(r=-2*r*r*r+3*r*r)+e*(1-r)}function T(e,t,n){let r=0;return Math.abs(t-e)<=n?t:e+Math.sign(t-e)*n}function x(e,t,n){let r=S(e,t),a=0;return-n<r&&r<n?a=t:(t=e+r,a=T(e,t,n)),a}function b(e,t,n){return(e-t)/(n-t)}function R(e,t,n){return(n-t)*e+t}n.r(t),n.d(t,{Clamp:()=>c,DeltaAngle:()=>S,Denormalize:()=>M,ExtractAsInt:()=>r,Hermite:()=>d,Hermite1stDerivative:()=>f,HighestCommonFactor:()=>function e(t,n){let r=t%n;return 0===r?n:e(n,r)},ILog2:()=>m,InverseLerp:()=>s,Lerp:()=>u,LerpAngle:()=>l,MoveTowards:()=>T,MoveTowardsAngle:()=>x,Normalize:()=>E,NormalizeRadians:()=>p,OutsideRange:()=>i,PercentToRange:()=>R,PingPong:()=>w,RandomRange:()=>o,RangeToPercent:()=>b,Repeat:()=>h,SmoothStep:()=>A,ToHex:()=>g,WithinEpsilon:()=>a})},85975:function(e,t,n){let r,a;n.d(t,{$0:()=>d,Oi:()=>m,ay:()=>f,cW:()=>s,qZ:()=>c,yl:()=>g});var i=n(13405),o=n(37433),u=n(4444),l=n(88970);function s(e,t,n,r=!0){let a=e.getScene(),l=a.getEngine(),d=new o._("resized"+e.name,{width:t,height:n},a,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);d.wrapU=e.wrapU,d.wrapV=e.wrapV,d.uOffset=e.uOffset,d.vOffset=e.vOffset,d.uScale=e.uScale,d.vScale=e.vScale,d.uAng=e.uAng,d.vAng=e.vAng,d.wAng=e.wAng,d.coordinatesIndex=e.coordinatesIndex,d.level=e.level,d.anisotropicFilteringLevel=e.anisotropicFilteringLevel,d._texture.isReady=!1,e.wrapU=i.x.CLAMP_ADDRESSMODE,e.wrapV=i.x.CLAMP_ADDRESSMODE;let f=new u.Q("pass",1,null,r?i.x.BILINEAR_SAMPLINGMODE:i.x.NEAREST_SAMPLINGMODE,l,!1,0);return f.externalTextureSamplerBinding=!0,f.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{f.onApply=function(t){t.setTexture("textureSampler",e)};let t=d.renderTarget;t&&(a.postProcessManager.directRender([f],t),l.unBindFramebuffer(t),d.disposeFramebufferObjects(),f.dispose(),d.getInternalTexture().isReady=!0)})}),d}function d(e,t,n,r,a,i,o,u){let s=t.getEngine();return t.isReady=!1,a=a??t.samplingMode,r=r??t.type,i=i??t.format,o=o??t.width,u=u??t.height,-1===r&&(r=0),new Promise(d=>{let f=new l.D("postprocess",e,null,null,1,null,a,s,!1,void 0,r,void 0,null,!1,i);f.externalTextureSamplerBinding=!0;let c=s.createRenderTargetTexture({width:o,height:u},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a,type:r,format:i});f.onEffectCreatedObservable.addOnce(e=>{e.executeWhenCompiled(()=>{f.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},n.postProcessManager.directRender([f],c,!0),s.restoreDefaultFramebuffer(),s._releaseTexture(t),f&&f.dispose(),c._swapAndDie(t),t.type=r,t.format=5,t.isReady=!0,d(t)})})})}function f(e){r||(a=new Int32Array((r=new Float32Array(1)).buffer)),r[0]=e;let t=a[0],n=t>>16&32768,i=t>>12&2047,o=t>>23&255;return o<103?n:o>142?(n|=31744,n|=+(255!=o)&&8388607&t):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1)):(n|=o-112<<10|i>>1,n+=1&i)}function c(e){let t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*6103515625e-14*(r/1024):31==n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/1024)}let p=async(e,t,r,a,u)=>{let s,d=e.getScene(),f=d.getEngine();f.isWebGPU?e.isCube?await n.e("3012").then(n.bind(n,61381)):await n.e("6876").then(n.bind(n,54548)):e.isCube?await n.e("2166").then(n.bind(n,15)):await n.e("6546").then(n.bind(n,60896)),s=e.isCube?new l.D("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:i.x.NEAREST_NEAREST_MIPNEAREST,engine:f,defines:["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"][a],shaderLanguage:+!!f.isWebGPU}):new l.D("lod","lod",{uniforms:["lod","gamma"],samplingMode:i.x.NEAREST_NEAREST_MIPNEAREST,engine:f,shaderLanguage:+!!f.isWebGPU}),await new Promise(e=>{s.onEffectCreatedObservable.addOnce(t=>{t.executeWhenCompiled(()=>{e(0)})})});let c=new o._("temp",{width:t,height:r},d,!1);s.onApply=function(t){t.setTexture("textureSampler",e),t.setFloat("lod",u),t.setInt("gamma",+!!e.gammaSpace)};let p=e.getInternalTexture();try{if(c.renderTarget&&p){let n=p.samplingMode;0!==u?e.updateSamplingMode(i.x.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(i.x.NEAREST_NEAREST),d.postProcessManager.directRender([s],c.renderTarget,!0),e.updateSamplingMode(n);let a=await f.readPixels(0,0,t,r),o=new Uint8Array(a.buffer,0,a.byteLength);return f.unBindFramebuffer(c.renderTarget),o}throw Error("Render to texture failed.")}finally{c.dispose(),s.dispose()}};async function g(e,t,n,r=0,a=0){return!e.isReady()&&e._texture&&await new Promise((t,n)=>{if(null===e._texture)return void n(0);e._texture.onLoadedObservable.addOnce(()=>{t(0)})}),await p(e,t,n,r,a)}let m={CreateResizedCopy:s,ApplyPostProcess:d,ToHalfFloat:f,FromHalfFloat:c,GetTextureDataAsync:g}}}]);